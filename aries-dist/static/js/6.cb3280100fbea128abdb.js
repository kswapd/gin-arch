webpackJsonp([6],{K4R9:function(e,t,i){i("NA/8"),e.exports=i("FeBl").Number.isNaN},MICi:function(e,t,i){e.exports={default:i("K4R9"),__esModule:!0}},"NA/8":function(e,t,i){var a=i("kM2E");a(a.S,"Number",{isNaN:function(e){return e!=e}})},QKE1:function(e,t){},ZpJy:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("mvHQ"),n=i.n(a),r=i("fZjL"),l=i.n(r),s=i("MICi"),o=i.n(s),c=i("woOf"),m=i.n(c),u=i("TQvf"),p=i.n(u),d=i("4ru3"),f=i("4CZg"),g=i("kt4z"),k=i("ZlkZ"),h={name:"findZipkin",data:function(){return{that:this,loading:!1,inputRules:{lookback:[{required:!0,message:"请选择时间期限",trigger:"blur"}],startTs:[{required:!0,message:"请选择开始日期",trigger:"blur"}],endTs:[{required:!0,message:"请选择结束日期",trigger:"blur"}],limit:[{required:!0,message:"请输入数量",trigger:"blur"},{pattern:/^\+?[1-9][0-9]*$/,message:"数量必须为数字值"}],minDuration:[{required:!1,message:"请输入",trigger:"change"},{pattern:/^\+?[1-9][0-9]*$/,message:"数量必须为数字值"}]},zipkinForm:{serviceName:"all",spanName:"all",lookback:"custom",minDuration:"",limit:10,sort:"Newest-First",startTs:(new Date).getTime()-864e5,endTs:(new Date).getTime(),annotationQuery:""},classify:{serviceName:[],spanName:[],sort:[{value:"Longest-First",label:"耗时最长"},{value:"Shortest-First",label:"耗时最短"},{value:"Newest-First",label:"时间顺序"},{value:"Oldest-First",label:"时间倒序"}]},searchTrace:"",zipkinData:[],zipkinTable:[],zipkinService:"",dialogVisible:!1}},computed:{ApiQuery:function(){var e=m()({},this.zipkinForm);return e.startTs=new Date(e.startTs).getTime(),e.endTs=new Date(e.endTs).getTime(),"custom"!==e.lookback&&(delete e.startTs,delete e.endTs),e.startTs&&(e.endTs>e.startTs&&(e.lookback=String(e.endTs-e.startTs)),delete e.startTs),"custom"===e.lookback&&delete e.lookback,"all"===e.serviceName&&delete e.serviceName,"all"===e.spanName&&delete e.spanName,e.minDuration&&!o()(Number(e.minDuration))?e.minDuration=1e3*Number(e.minDuration):delete e.minDuration,l()(e).forEach(function(t){""===e[t]&&delete e[t]}),delete e.sort,e},stringZip:function(){return n()(this.zipkinData)}},watch:{"zipkinForm.serviceName":function(e,t){this.classify.spanName=this.getData(k.a.zipkinSpans,{serviceName:this.zipkinForm.serviceName})},"zipkinForm.sort":function(e){this.sortHandle(this.zipkinTable,e)}},mounted:function(){this.classify.serviceName=this.getData(k.a.zipkinServices,{}),this.classify.spanName=this.getData(k.a.zipkinSpans,{serviceName:this.zipkinForm.serviceName})},methods:{getData:function(e,t){var i=[{value:"all",label:"all"}];return this.$axios.get(e,{params:t}).then(function(e){try{e.forEach(function(e){i.push({value:e,label:e})})}catch(e){console.log(e)}}),i},searchHandle:function(){var e=this;e.$refs.zipkinForm.validate(function(t){t?e.searchAxios(e.ApiQuery,e.zipkinForm.serviceName):e.$message({message:"格式不正确！",type:"warning"})})},searchAxios:function(e,t){var i=this;this.loading=!0,this.$axios.get(k.a.zipkintraces,{params:e}).then(function(e){if(!e.length>0||void 0===e||null===e)return i.zipkinData=[],i.zipkinTable=[],i.loading=!1,i.$message({type:"info",message:"暂无数据"}),!1;var a=e;i.zipkinData=JSON.parse(n()(a));var r=a.map(function(e){var t=e.map(d.a.convert),i=d.a.mergeById(t),a=f.a.correctForClockSkew(i);return Object(g.g)(a,["http.path"])});i.zipkinService=t,i.zipkinTable=Object(g.f)(t,r).filter(function(e){return!e.traceSeqNo["http.path"]||-1===e.traceSeqNo["http.path"].indexOf("actuator")}),i.sortHandle(i.zipkinTable,i.zipkinForm.sort),i.loading=!1}).catch(function(e){i.zipkinData=[],i.zipkinTable=[],i.loading=!1,i.$message.error(e&&e.data&&e.data.message||"ERROR")})},sortHandle:function(e,t){var i={"Service-Percentage:Longest-First":function(e,t){return t.percentage-e.percentage},"Service-Percentage:Shortest-First":function(e,t){return e.percentage-t.percentage},"Longest-First":function(e,t){return t.duration-e.duration},"Shortest-First":function(e,t){return e.duration-t.duration},"Newest-First":function(e,t){return t.timestamp-e.timestamp},"Oldest-First":function(e,t){return e.timestamp-t.timestamp}};i.hasOwnProperty(t)&&e.sort(i[t])},checkHandle:function(e){if(!e.length>0||void 0===e||null===e)return this.$message({type:"warning",message:"不能为空"}),!1;this.$router.push({name:"detailZipkin",query:{traceId:e},params:{id:e}})},handleJson:function(){this.dialogVisible=!0},copy:function(){var e=this,t=new p.a(".tag-read");t.on("success",function(i){e.$message({type:"success",message:"复制成功"}),t.destroy()}),t.on("error",function(i){e.$message({type:"warning",message:"浏览器不支持复制"}),t.destroy()})}},filters:{traceParameter:function(e,t){if(e)return e[t]?e[t]:""},zipkinTimeFilter:function(e,t){return t.$moment(e).format("YYYY-MM-DD HH:mm:ss")},combine:function(e){return e.name+" x"+e.count+" "+e.max+"ms"},zipkinNameFilter:function(e){if(e&&e.length>0){var t=e.lastIndexOf(".");return-1!==t?e.slice(0,t):e}return e}}},v={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"findZipkin"},[i("div",{staticClass:"button-group"},[i("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))])]),e._v(" "),i("el-form",{ref:"zipkinForm",attrs:{model:e.zipkinForm,"label-width":"110px","label-position":"right",size:"small",rules:e.inputRules}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:e.$t("zipkin.spanName")+"：","label-width":"68px"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("common.pleaseChoose")},model:{value:e.zipkinForm.serviceName,callback:function(t){e.$set(e.zipkinForm,"serviceName",t)},expression:"zipkinForm.serviceName"}},e._l(e.classify.serviceName,function(e){return i("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:"方法名：","label-width":"68px"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("common.pleaseChoose")},model:{value:e.zipkinForm.spanName,callback:function(t){e.$set(e.zipkinForm,"spanName",t)},expression:"zipkinForm.spanName"}},e._l(e.classify.spanName,function(e){return i("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:e.$t("common.startDate")+"：","label-width":"92px",prop:"startTs"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:e.$t("common.selectDate")},model:{value:e.zipkinForm.startTs,callback:function(t){e.$set(e.zipkinForm,"startTs",t)},expression:"zipkinForm.startTs"}})],1)],1),e._v(" "),i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:e.$t("common.endDate")+"：","label-width":"92px",prop:"endTs"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime"},model:{value:e.zipkinForm.endTs,callback:function(t){e.$set(e.zipkinForm,"endTs",t)},expression:"zipkinForm.endTs"}})],1)],1),e._v(" "),i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:e.$t("zipkin.limit")+"：","label-width":"92px",prop:"limit"}},[i("el-input",{attrs:{type:"text",clearable:"",maxlength:"25"},model:{value:e.zipkinForm.limit,callback:function(t){e.$set(e.zipkinForm,"limit","string"==typeof t?t.trim():t)},expression:"zipkinForm.limit"}})],1)],1),e._v(" "),i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:e.$t("zipkin.duration")+"(ms)：",prop:"minDuration"}},[i("el-input",{attrs:{type:"text",clearable:"",placeholder:"(ms)>=",maxlength:"25"},model:{value:e.zipkinForm.minDuration,callback:function(t){e.$set(e.zipkinForm,"minDuration","string"==typeof t?t.trim():t)},expression:"zipkinForm.minDuration"}})],1)],1),e._v(" "),i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:"查询注释：","label-width":"82px"}},[i("el-input",{attrs:{type:"text",clearable:"",placeholder:"eg: MT",maxlength:"50"},model:{value:e.zipkinForm.annotationQuery,callback:function(t){e.$set(e.zipkinForm,"annotationQuery","string"==typeof t?t.trim():t)},expression:"zipkinForm.annotationQuery"}})],1)],1),e._v(" "),i("el-col",{attrs:{xl:4,lg:6,align:"right"}},[i("el-form-item",{staticStyle:{"min-width":"176px"},attrs:{"label-width":"0px"}},[i("el-button",{attrs:{icon:"fa fa-eye",type:"primary",size:"small"},on:{click:e.handleJson}},[e._v("JSON")]),e._v(" "),i("el-button",{attrs:{icon:"el-icon-search",type:"primary",loading:e.loading,size:"small"},on:{click:function(t){e.searchHandle("search")}}},[e._v(e._s(e.$t("common.search")))])],1)],1)],1),e._v(" "),i("el-row",{staticClass:"label-first",attrs:{gutter:20}},[i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:e.$t("zipkin.sort")+"：","label-width":"56px"}},[i("el-select",{staticStyle:{width:"100%"},model:{value:e.zipkinForm.sort,callback:function(t){e.$set(e.zipkinForm,"sort",t)},expression:"zipkinForm.sort"}},e._l(e.classify.sort,function(e){return i("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),i("el-col",{attrs:{xl:4,lg:6}},[i("el-form-item",{attrs:{label:"","label-width":"0px"}},[i("el-input",{staticClass:"input-with-select",attrs:{placeholder:"精准搜索 trace",clearable:"",maxlength:"25",size:"small"},model:{value:e.searchTrace,callback:function(t){e.searchTrace="string"==typeof t?t.trim():t},expression:"searchTrace"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-arrow-right"},on:{click:function(t){e.checkHandle(e.searchTrace)}},slot:"append"})],1)],1)],1)],1)],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.zipkinTable,size:"small"}},[i("el-table-column",{attrs:{align:"center",width:"240","show-overflow-tooltip":"",prop:"name",label:"请求路径"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                   "+e._s(t.row.traceSeqNo["http.path"])+"\n               ")]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",width:"80",prop:"durationStr",label:e.$t("zipkin.duration")}}),e._v(" "),i("el-table-column",{attrs:{align:"center",width:"80",label:e.$t("zipkin.number")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                   "+e._s(t.row.totalSpans+" spans")+"\n               ")]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center","min-width":"150",label:e.$t("zipkin.serviceDurations")},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.serviceDurations,function(t){return i("el-tag",{key:t.id,staticClass:"zipList"},[e._v(e._s(e._f("combine")(t)))])})}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center","min-width":"90",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tag",{attrs:{type:t.row.traceSeqNo.isTraceStatus?"success":"danger"}},[e._v(e._s(t.row.traceSeqNo.isTraceStatus?"成功":"失败"))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",width:"140",label:e.$t("zipkin.lookback")},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e._f("zipkinTimeFilter")(t.row.startTs,e.that)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{width:"70",align:"center",label:e.$t("common.operation"),fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"mini",icon:"fa fa-sign-in"},on:{click:function(i){e.checkHandle(t.row.traceId)}}},[e._v(e._s(e.$t("common.view")))])]}}])})],1),e._v(" "),i("el-dialog",{attrs:{visible:e.dialogVisible,width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("span",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[i("span",[e._v(e._s(e.$t("zipkin.searchResults")))])]),e._v(" "),i("el-button",{staticClass:"tag-read",attrs:{type:"primary",size:"small","data-clipboard-text":e.stringZip},on:{click:e.copy}},[e._v("复制")]),e._v(" "),i("pre",{staticClass:"log-box",domProps:{innerHTML:e._s(e.zipkinData)}})],1)],1)},staticRenderFns:[]};var b=i("VU/8")(h,v,!1,function(e){i("QKE1")},"data-v-84dfe04e",null);t.default=b.exports}});