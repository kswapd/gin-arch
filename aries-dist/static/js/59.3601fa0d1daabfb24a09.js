webpackJsonp([59],{gCyo:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("INCx"),i=e.n(s),n=e("fZjL"),l=e.n(n),o=e("mvHQ"),r=e.n(o),c=e("TQvf"),d=e.n(c),p=e("4ru3"),u=e("4CZg"),m=e("hpoG"),v=e("ZlkZ"),h={name:"detailZipkin",data:function(){return{that:this,loading:!1,options:[],optionValue:"",detailForm:{lookback:"",seviceNum:"",depth:"",spanNum:""},originalData:{},detailData:{},mainData:{},dialogVisible:!1,diglogTitle:"",dialogTable:{serviceName:"",annotations:[],binaryAnnotations:[],spanId:"",parentId:""},jsonVisible:!1}},computed:{stringZip:function(){return r()(this.originalData)}},mounted:function(){this.$route.query&&(this.detailTraceId=this.$route.query.traceId,this.getData())},beforeDestroy:function(){this.options=[],this.optionValue="",this.detailForm={lookback:"",seviceNum:"",depth:"",spanNum:""},this.originalData={},this.detailData={},this.mainData={}},methods:{checkHandle:function(t){this.diglogTitle=t.spanName+":"+t.durationStr,this.dialogTable={serviceNames:t.serviceNames,annotations:t.annotations,binaryAnnotations:t.binaryAnnotations,spanId:t.spanId,parentId:t.parentId},this.dialogVisible=!0},getData:function(){var t=this;this.options=[],this.loading=!0,this.$axios.get(v.a.zipkinDetail+this.detailTraceId).then(function(a){t.loading=!1,t.originalData=JSON.parse(r()(a));var e=a.map(p.a.convert),s=p.a.mergeById(e),i=u.a.correctForClockSkew(s),n=Object(m.a)(i,"");t.detailForm={lookback:n.duration,seviceNum:n.services,depth:n.depth,spanNum:n.totalSpans},l()(n.spans).forEach(function(t){n.spans[t].spread=!0,n.spans[t].spreadStatus=!0,n.spans[t].spanStatus=!n.spans[t].binaryAnnotations.some(function(t){var a=!1;return"exception"===t.key?a=!0:"error"===t.key?a=!0:("RET_STATUS"===t.key&&"S"!==t.value&&(a=!0),"status"===t.key&&"success"!==t.value&&(a=!0)),a})}),t.detailData=JSON.parse(r()(n)),t.mainData=JSON.parse(r()(n.spans)),t.detailData.serviceCounts.forEach(function(a){t.options.push({value:a.name,label:a.name})})}).catch(function(a){t.loading=!1,t.$message.error(a&&a.data&&a.data.message||"ERROR")})},copy:function(){var t=this,a=new d.a(".tag-read");a.on("success",function(e){t.$message({type:"success",message:"复制成功"}),a.destroy()}),a.on("error",function(t){a.destroy()})},download:function(){var t=this;if(this.detailData.traceId){var a=this.detailData.traceId;this.$axios({method:"get",url:v.a.zipkinDownload+a,responseType:"blob"}).then(function(e){t.commonFunc.funDownload(e,a+".json")})}},handleItemChange:function(t){var a=JSON.parse(r()(this.detailData.spans));if(t.length<=0)this.mainData=a;else{var e=[];a.forEach(function(a){t.forEach(function(t){t===a.serviceName&&e.push(a)})}),this.mainData=e}},spreadHandle:function(t,a){t.stopPropagation();var e=this.mainData.indexOf(a);if(!1===a.spread){this.$set(this.mainData[e],"spread",!0);for(var s=e+1;s<this.mainData.length&&this.mainData[s].depthClass>this.mainData[e].depthClass;s++)this.mainData[s].spread=!0,this.mainData[s].spreadStatus=!0}else{this.$set(this.mainData[e],"spread",!1);for(var i=e+1;i<this.mainData.length&&this.mainData[i].depthClass>this.mainData[e].depthClass;i++)this.mainData[i].spreadStatus=!1}}},filters:{timeFilter:function(t,a){return a.$moment(i()(t/1e3)).format("YYYY-MM-DD HH:mm:ss")},shortWords:function(t){var a=t.serviceName;return a?a.length>16?a.slice(0,15)+"...":a:t.depthClass+"-"+a}}},_={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"detailZipkin"},[e("div",{staticClass:"detail-back"},[e("a",{on:{click:function(a){t.$router.push({name:"findZipkin"})}}},[e("i",{staticClass:"iconfont icon-fanhui"}),t._v("返回")]),t._v(" "),e("span",{domProps:{textContent:t._s(t.$route.meta.title+"-"+t.$route.query.traceId)}})]),t._v(" "),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("div",{staticClass:"header clearfix",staticStyle:{width:"100%",height:"100%"}},[e("el-row",{staticClass:"clearfix",attrs:{type:"flex",justify:"middle"}},[e("el-col",{staticClass:"header-lf",attrs:{span:2}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"调用链总耗时",placement:"top"}},[e("el-button",[t._v(t._s(t.$t("zipkin.duration")+"："))])],1)],1),t._v(" "),e("el-col",{staticClass:"header-rt",attrs:{span:2}},[e("el-tag",{staticClass:"button-new-tag",attrs:{size:"mini"}},[t._v(t._s(t.detailForm.lookback))])],1),t._v(" "),e("el-col",{staticClass:"header-lf",attrs:{span:2}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"涉及的服务总数",placement:"top"}},[e("el-button",[t._v(t._s(t.$t("zipkin.serviceNum")+"："))])],1)],1),t._v(" "),e("el-col",{staticClass:"header-rt",attrs:{span:2}},[e("el-tag",{staticClass:"button-new-tag",attrs:{size:"mini"}},[t._v(t._s(t.detailForm.seviceNum))])],1),t._v(" "),e("el-col",{staticClass:"header-lf",attrs:{span:2}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"调用的深度",placement:"top"}},[e("el-button",[t._v(t._s(t.$t("zipkin.depth")+"："))])],1)],1),t._v(" "),e("el-col",{staticClass:"header-rt",attrs:{span:2}},[e("el-tag",{staticClass:"button-new-tag",attrs:{size:"mini"}},[t._v(t._s(t.detailForm.depth))])],1),t._v(" "),e("el-col",{staticClass:"header-lf",staticStyle:{"min-width":"83px"},attrs:{span:2}},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"调用spans的总数量",placement:"top"}},[e("el-button",[t._v(t._s(t.$t("zipkin.spansNum")+"："))])],1)],1),t._v(" "),e("el-col",{staticClass:"header-rt",attrs:{span:2}},[e("el-tag",{staticClass:"button-new-tag",attrs:{size:"mini"}},[t._v(t._s(t.detailForm.spanNum))])],1),t._v(" "),e("el-col",{staticClass:"header-js",attrs:{span:3,offset:5,align:"right"}},[e("el-button",{attrs:{icon:"fa fa-download",type:"primary",size:"mini"},on:{click:function(a){t.jsonVisible=!0}}},[t._v("JSON")])],1)],1),t._v(" "),e("el-row",[e("el-col",{attrs:{span:4}},[e("div",{staticClass:"block"},[e("el-cascader",{attrs:{size:"mini",placeholder:"搜索",options:t.options,filterable:"",clearable:""},on:{change:t.handleItemChange}}),t._v("\n                        "+t._s(t.optionValue)+"\n                    ")],1)])],1),t._v(" "),e("el-row",[e("el-col",{attrs:{span:12}},[t.detailData.serviceCounts&&t.detailData.serviceCounts.length>0?e("div",t._l(t.detailData.serviceCounts,function(a){return e("span",{key:a.id,staticClass:"zipList",staticStyle:{"margin-right":"10px"}},[t._v("\n                            "+t._s(a.name+" x"+a.count)+"\n                        ")])})):t._e()])],1)],1),t._v(" "),e("div",{staticClass:"main"},[t.detailData.timeMarkers&&t.detailData.timeMarkers.length>0?e("el-row",[e("el-col",{attrs:{span:4}},[e("el-tag",{staticStyle:{"margin-left":"10px"},attrs:{size:"small"}},[t._v(t._s(t.$t("zipkin.serviceName")))])],1),t._v(" "),t._l(t.detailData.timeMarkers,function(a){return e("el-col",{key:a.id,attrs:{span:4,align:"right"}},[a.time?e("el-tag",{attrs:{size:"small"}},[t._v(t._s(a.time))]):t._e()],1)})],2):t._e(),t._v(" "),t._l(t.mainData,function(a,s){return e("div",{key:s},[a.spreadStatus?e("el-row",{staticClass:"main-box"},[e("div",{staticStyle:{width:"100%",height:"23px"},on:{click:function(e){t.checkHandle(a)}}},[e("el-col",{staticClass:"main-title",attrs:{span:4}},[e("div",{staticClass:"main-title-box",style:{"margin-left":a.depth+"px"}},[""!==a.children?e("el-button",{staticClass:"main-add",on:{click:function(e){t.spreadHandle(e,a)}}},[t._v(t._s(a.spread?"-":"+"))]):t._e(),t._v(" "),e("el-tooltip",{attrs:{content:a.serviceName,placement:"top"}},[e("el-button",{attrs:{size:"mini"}},[t._v(t._s(t._f("shortWords")(a)))])],1)],1)]),t._v(" "),e("el-col",{staticClass:"main-content",staticStyle:{position:"relative"},attrs:{span:20}},[e("el-button",{style:{position:"absolute",width:a.width+"%",left:a.left+"%",background:a.spanStatus?"#a9c9DE":"#f56c6c"},attrs:{size:"mini"}},[t._v(t._s(a.durationStr+" "+a.spanName))])],1)],1)]):t._e()],1)})],2)]),t._v(" "),e("el-dialog",{staticClass:"diglogBox",attrs:{visible:t.dialogVisible,width:"60%"},on:{"update:visible":function(a){t.dialogVisible=a}}},[e("span",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[e("span",[t._v(t._s(t.diglogTitle))])]),t._v(" "),e("span",{staticClass:"service"},[t._v(t._s(t.$t("zipkin.serviceName"))+" ： "+t._s(t.dialogTable.serviceNames))]),t._v(" "),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"24px"},attrs:{stripe:"",data:t.dialogTable.annotations}},[e("el-table-column",{attrs:{align:"center",label:t.$t("zipkin.dateTime")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"zipList"},[t._v(t._s(t._f("timeFilter")(a.row.timestamp,t.that)))])]}}])}),t._v(" "),e("el-table-column",{attrs:{align:"center",width:"150px",prop:"relativeTime",label:t.$t("zipkin.relativeTime")}}),t._v(" "),e("el-table-column",{attrs:{align:"center",width:"200px",prop:"value",label:t.$t("zipkin.annotation")}}),t._v(" "),e("el-table-column",{attrs:{align:"center",prop:"endpoint",label:t.$t("zipkin.address")}})],1),t._v(" "),e("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"24px"},attrs:{stripe:"",data:t.dialogTable.binaryAnnotations}},[e("el-table-column",{attrs:{align:"center",prop:"key",label:t.$t("zipkin.key")}}),t._v(" "),e("el-table-column",{attrs:{align:"center",prop:"value",label:t.$t("zipkin.value")}})],1),t._v(" "),e("el-collapse",{attrs:{accordion:""}},[e("el-collapse-item",{attrs:{title:t.$t("zipkin.moreInfo")}},[e("table",{staticClass:"table"},[e("tbody",[e("tr",[e("td",{staticClass:"key",attrs:{"data-key":"key"}},[t._v("traceId")]),t._v(" "),e("td",{staticClass:"value",attrs:{"data-key":"value"}},[t._v(t._s(t.detailData.traceId))])]),t._v(" "),e("tr",[e("td",{staticClass:"key",attrs:{"data-key":"key"}},[t._v("spanId")]),t._v(" "),e("td",{staticClass:"value",attrs:{"data-key":"value"}},[t._v(t._s(t.dialogTable.spanId))])]),t._v(" "),e("tr",[e("td",{staticClass:"key",attrs:{"data-key":"key"}},[t._v("parentId")]),t._v(" "),e("td",{staticClass:"value",attrs:{"data-key":"value"}},[t._v(t._s(t.dialogTable.parentId))])])])])])],1)],1),t._v(" "),e("el-dialog",{attrs:{title:"Search Results",visible:t.jsonVisible,width:"60%"},on:{"update:visible":function(a){t.jsonVisible=a}}},[e("span",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[e("span",[t._v(t._s(t.$t("zipkin.searchResults")))])]),t._v(" "),e("el-button",{staticClass:"tag-read",attrs:{type:"primary",size:"small","data-clipboard-text":t.stringZip},on:{click:t.copy}},[t._v("复制")]),t._v(" "),e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.download}},[t._v("下载")]),t._v(" "),e("pre",{staticClass:"log-box",domProps:{innerHTML:t._s(t.originalData)}})],1)],1)},staticRenderFns:[]};var f=e("VU/8")(h,_,!1,function(t){e("xSKN")},"data-v-06139dd8",null);a.default=f.exports},xSKN:function(t,a){}});