webpackJsonp([44],{pd7F:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("INCx"),n=a.n(r),s=a("mvHQ"),l=a.n(s),o=a("fZjL"),i=a.n(o),c=a("woOf"),m=a.n(c),u=a("4ru3"),d=a("4CZg"),p=a("kt4z"),f=a("ZlkZ"),g={name:"transactionDetails",data:function(){return{that:this,loading:!1,tableBoxParams:["SEQ_NO","SOURCE_TYPE","TRAN_TIMESTAMP","SERVICE_CODE","RET_CODE","RET_MSG"],inputRules:{startTs:[{required:!0,message:"请选择时间期限",trigger:"blur"}],endTs:[{required:!0,message:"请选择时间期限",trigger:"blur"}],serviceName:[{required:!0,message:"请输入服务名",trigger:"blur"}],sourceType:[{required:!0,message:"请输入渠道号",trigger:"blur"}],limit:[{required:!0,message:"请输入数量",trigger:"blur"},{pattern:/^\+?[1-9][0-9]*$/,message:"数量必须为数字值"}]},searchFrom:{startTs:(new Date).getTime()-864e5,endTs:(new Date).getTime(),limit:"10",lookback:"",serviceName:"",sourceType:""},zipkinData:[],zipkinTable:[]}},computed:{ApiQuery:function(){var e=m()({},this.searchFrom);return e.startTs=new Date(e.startTs).getTime(),e.endTs=new Date(e.endTs).getTime(),e.endTs>e.startTs&&(e.lookback=String(e.endTs-e.startTs)),delete e.startTs,i()(e).forEach(function(t){""===e[t]&&delete e[t]}),e}},mounted:function(){},methods:{searchHandle:function(){var e=this;e.$refs.searchFrom.validate(function(t){t?e.searchAxios(e.ApiQuery,e.tableBoxParams):e.$message({message:"格式不正确！",type:"warning"})})},searchAxios:function(e,t){var a=this;this.loading=!0,this.$axios.get(f.a.zipkinDetailtrace,{params:e}).then(function(e){if(!e||Array.isArray(e)&&!e.length>0)return a.zipkinData=[],a.zipkinTable=[],a.loading=!1,a.$message({type:"info",message:"暂无数据"}),!1;var r=e;a.zipkinData=JSON.parse(l()(r));var s=r.map(function(e){var a=e.map(u.a.convert),r=u.a.mergeById(a),n=d.a.correctForClockSkew(r);return Object(p.g)(n,t)}),o=Object(p.f)(null,s);function i(e,t){if(e)return e[t]?e[t]:""}function c(e,t,a){var r=null;return Array.isArray(e)&&e.length>0&&e.forEach(function(e){e.valueName===t&&(r=e.timestamp)}),r?a.$moment(n()(r/1e3)).format("YYYY-MM-DD HH:mm:ss"):""}a.sortHandle(o,"Newest-First"),a.zipkinTable=o.map(function(e){return{name:e.name,sourceType:i(e.traceSeqNo,"SOURCE_TYPE"),tranTimestamp:i(e.traceSeqNo,"TRAN_TIMESTAMP"),seqNo:i(e.traceSeqNo,"SEQ_NO"),serviceCode:i(e.traceSeqNo,"SERVICE_CODE"),retCode:i(e.traceSeqNo,"RET_CODE"),retMsg:i(e.traceSeqNo,"RET_MSG"),cs:c(e.traceSeqNo.annotations,"cs",a.that),ss:c(e.traceSeqNo.annotations,"ss",a.that)}}),a.loading=!1}).catch(function(e){a.zipkinData=[],a.zipkinTable=[],a.loading=!1,a.$message.error(e&&e.data&&e.data.message||"ERROR")})},sortHandle:function(e,t){var a={"Service-Percentage:Longest-First":function(e,t){return t.percentage-e.percentage},"Service-Percentage:Shortest-First":function(e,t){return e.percentage-t.percentage},"Longest-First":function(e,t){return t.duration-e.duration},"Shortest-First":function(e,t){return e.duration-t.duration},"Newest-First":function(e,t){return t.timestamp-e.timestamp},"Oldest-First":function(e,t){return e.timestamp-t.timestamp}};a.hasOwnProperty(t)&&e.sort(a[t])},handleDownload:function(){var e=this;this.downloadLoading=!0;var t=(new Date).getTime()+"-zipkin";a.e(72).then(a.bind(null,"p7ob")).then(function(a){var r=e.zipkinTable,n=e.formatJson(["name","sourceType","tranTimestamp","seqNo","serviceCode","cs","ss","retCode","retMsg"],r);a.export_json_to_excel({header:["服务名","渠道号","时间戳","主流水","服务码","请求时间","响应时间","返回码","返回信息"],data:n,filename:t,autoWidth:!0}),e.downloadLoading=!1})},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return t[e]})})}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"transactionDetails"},[a("div",{staticClass:"button-group"},[a("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))])]),e._v(" "),a("div",{staticClass:"header",staticStyle:{width:"100%",height:"100%"}},[a("el-form",{ref:"searchFrom",attrs:{model:e.searchFrom,"label-width":"82px",rules:e.inputRules,"label-position":"left",size:"small"}},[a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:e.$t("common.startDate")+"：","label-width":"92px",prop:"startTs"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:e.$t("common.selectDate")},model:{value:e.searchFrom.startTs,callback:function(t){e.$set(e.searchFrom,"startTs",t)},expression:"searchFrom.startTs"}})],1)],1),e._v(" "),a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:e.$t("common.endDate")+"：","label-width":"92px",prop:"endTs"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:e.$t("common.selectDate")},model:{value:e.searchFrom.endTs,callback:function(t){e.$set(e.searchFrom,"endTs",t)},expression:"searchFrom.endTs"}})],1)],1),e._v(" "),a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:"服务名：","label-width":"70px"}},[a("el-input",{attrs:{clearable:"",placeholder:"eg: MBSD_GA-1400-0101",type:"text",maxlength:"25"},model:{value:e.searchFrom.serviceName,callback:function(t){e.$set(e.searchFrom,"serviceName","string"==typeof t?t.trim():t)},expression:"searchFrom.serviceName"}})],1)],1),e._v(" "),a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:"渠道号：","label-width":"70px"}},[a("el-input",{attrs:{clearable:"",placeholder:"eg: MT",type:"text",maxlength:"25"},model:{value:e.searchFrom.sourceType,callback:function(t){e.$set(e.searchFrom,"sourceType","string"==typeof t?t.trim():t)},expression:"searchFrom.sourceType"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:12}},[a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:"查询数量：","label-width":"92px",prop:"limit"}},[a("el-input",{attrs:{clearable:"",type:"text",maxlength:"25"},model:{value:e.searchFrom.limit,callback:function(t){e.$set(e.searchFrom,"limit","string"==typeof t?t.trim():t)},expression:"searchFrom.limit"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{"min-width":"155px"},attrs:{xl:3,lg:3}},[a("el-form-item",{attrs:{label:"","label-width":"0px"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.searchHandle()}}},[e._v(e._s(e.$t("common.search")))]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.handleDownload()}}},[e._v("下载")])],1)],1)],1)],1)],1),e._v(" "),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.zipkinTable,size:"small"}},[a("el-table-column",{attrs:{align:"center","min-width":"70",prop:"sourceType",label:"渠道号"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","min-width":"200",prop:"name",label:"服务名"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"100",prop:"traceSeqNo",label:"时间戳"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(t.row.tranTimestamp)+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"100",prop:"traceSeqNo",label:"主流水"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(t.row.seqNo)+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","min-width":"150",prop:"traceSeqNo",label:"服务码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(t.row.serviceCode)+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"150",prop:"traceSeqNo",label:"请求时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(t.row.cs)+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"150",prop:"traceSeqNo",label:"响应时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(t.row.ss)+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"130",prop:"traceSeqNo",label:"返回码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(t.row.retCode)+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","min-width":"200",prop:"traceSeqNo",label:"返回信息"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                  "+e._s(t.row.retMsg)+"\n              ")]}}])})],1)],1)])},staticRenderFns:[]};var v=a("VU/8")(g,h,!1,function(e){a("qVM8")},"data-v-36388e72",null);t.default=v.exports},qVM8:function(e,t){}});