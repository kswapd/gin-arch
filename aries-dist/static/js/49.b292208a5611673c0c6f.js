webpackJsonp([49],{"1JIy":function(e,t){},ghbc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),l=a.n(n),r=a("NYxO"),i={data:function(){return{environment:{value:"",options:[]},jobTableData:[],isVisible:!1,isLoading:!1,currentPage:1,pageSize:10,ruleForm:{sql:"",analysisSql:""},searchValue:"",list:[],example:{label:"格式示例:",text:'select\n        <br>\n         <span style="color: green">[distinct]</span> internal_key <span style="color: red">key_field</span>\n         <br> \n         from xxx where ...<span style="color: blue">[注: key_field为关键字别名，必须填*SQL无需排序]</span>'}}},computed:l()({},Object(r.d)({envOptions:function(e){return e.processing.envOptions}})),methods:l()({},Object(r.b)("processing",["getJobList","findBatchEnvIpCombox"]),{sqlHelp:function(){this.isVisible=!0,this.ruleForm.sql="",this.ruleForm.analysisSql=""},sqlChange:function(){var e=this.ruleForm.sql||"";if(e.indexOf("key_field")>-1||e.indexOf("KEY_FIELD")>-1){var t='<if test="_databaseId == \'mysql\'">\nSELECT\nMIN(key_field) START_KEY,\nMAX(key_field) END_KEY,\ncount(1) ROW_COUNT\nFROM\n( SELECT\n\n        "key_field,\n@rownum:=@rownum + 1 AS rownum\nFROM\n(\n'+(e+'"\n")t1')+"\n(SELECT @rownum := - 1) t \nORDER BY\nt1.key_field \n) tt\nGROUP BY\nFLOOR(\ntt.rownum / #{maxPerCount} )\n</if>",a="<if test=\"_databaseId == 'oracle'\">\nSELECT   MIN (key_field) START_KEY, MAX (key_field) END_KEY ,count(1) ROW_COUNT FROM (\n"+e+" order by key_field \n)GROUP BY   TRUNC ((ROWNUM-1) / #{maxPerCount}) order by START_KEY\n</if>";this.ruleForm.analysisSql=a+"\n"+t}else this.$message({message:"SQL中缺少关键字别名 key_field ,请检查 ！",type:"warning"})},querySearch:function(e){var t=this,a=this.jobTableData;this.list=[],a.forEach(function(e){(e.BATCH_CLASS.indexOf(t.searchValue)>-1||e.BATCH_DESC.indexOf(t.searchValue)>-1||e.EOD_SOD.indexOf(t.searchValue)>-1)&&t.list.push(e)})},envChange:function(){var e=this;e.isLoading=!0,e.searchValue="";var t=e.environment.value;e.jobTableData=[],e.querySearch();try{t=JSON.parse(e.environment.value)}catch(e){}e.getJobList(t).then(function(t){e.jobTableData=t.data||[],e.querySearch(),e.isLoading=!1}).catch(function(t){e.$message.error(t&&t.data&&t.data.message||""),e.isLoading=!1})},handleCurrentChange:function(e){this.currentPage=e},handleSizeChange:function(e){this.pageSize=e},runBatch:function(e){var t=this.environment.value;try{t=JSON.parse(this.environment.value)}catch(e){}var a={batchClass:e.BATCH_CLASS,eodSod:e.EOD_SOD,batchDesc:e.BATCH_DESC,zkUrl:t.zkUrl||"",appGroup:t.appGroup||"",envId:this.envId||""};this.$router.push({name:"batchJob",params:{id:e.BATCH_CLASS},query:a})},change:function(){this.environment.value?this.envChange():this.list=[]}}),mounted:function(){this.findBatchEnvIpCombox(this)}},s={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"batch-main"},[a("div",{staticClass:"button-group"},[a("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))]),e._v(" "),a("el-button",{attrs:{type:"warning",size:"small"},on:{click:e.sqlHelp}},[e._v("分段sql帮助")])],1),e._v(" "),a("el-form",{attrs:{modal:e.envForm,"label-position":"right",size:"small"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{lg:12,xl:8}},[a("el-form-item",{attrs:{label:"选择批处理环境：",prop:"name"}},[a("el-select",{attrs:{disabled:e.isLoading,clearable:"",size:"small",placeholder:"选择批处理环境"},on:{change:e.change},model:{value:e.environment.value,callback:function(t){e.$set(e.environment,"value",t)},expression:"environment.value"}},e._l(e.environment.options,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-col",{staticStyle:{float:"right"},attrs:{lg:6,xl:4}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-input",{attrs:{type:"text",disabled:e.isLoading,placeholder:"检索内容..."},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search",loading:e.isLoading},on:{click:e.querySearch},slot:"append"})],1)],1)],1),e._v(" "),a("div",{staticStyle:{clear:"both"}})],1)],1),e._v(" "),a("el-form",{attrs:{modal:e.envForm,"label-position":"right",size:"small"}}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{data:e.list.slice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize),stripe:""}},[a("el-table-column",{attrs:{align:"center",prop:"BATCH_CLASS",label:"批处理"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"EOD_SOD",label:"EOD/SOD"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"BATCH_DESC",label:"批处理描述"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("common.operation"),align:"center",fixed:"right",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"fa fa-pencil-square-o"},on:{click:function(a){e.runBatch(t.row)}}},[e._v("批处理JOB配置修改")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.list.length},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange,"update:currentPage":function(t){e.currentPage=t}}}),e._v(" "),a("el-dialog",{attrs:{visible:e.isVisible,title:"分段sql帮助",center:"",width:"50%"},on:{close:function(t){e.isVisible=e.fasle}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{rules:e.rules,"label-width":"100px"}},[a("el-form-item",{staticClass:"redItem",attrs:{label:e.example.label}},[a("span",{domProps:{innerHTML:e._s(e.example.text)}})]),e._v(" "),a("el-form-item",{attrs:{label:"SQL:",required:""}},[a("el-input",{attrs:{type:"textarea",rows:5,placeholder:""},model:{value:e.ruleForm.sql,callback:function(t){e.$set(e.ruleForm,"sql",t)},expression:"ruleForm.sql"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分析SQL:"}},[a("el-input",{attrs:{type:"textarea",readonly:"",rows:12,placeholder:""},model:{value:e.ruleForm.analysisSql,callback:function(t){e.$set(e.ruleForm,"analysisSql",t)},expression:"ruleForm.analysisSql"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.sqlChange}},[e._v("转 换")]),e._v(" "),a("el-button",{on:{click:function(t){e.isVisible=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(i,s,!1,function(e){a("1JIy")},null,null);t.default=o.exports}});