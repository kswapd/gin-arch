webpackJsonp([40],{"8fJ1":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("ifoU"),l=a.n(o),r=a("mvHQ"),s=a.n(r),i=a("woOf"),n=a.n(i),c=a("Dd8w"),p=a.n(c),m=a("ZlkZ"),u=a("NYxO"),d={name:"tmconfig",data:function(){return{currentPage:1,totalPage:0,loading:!1,inputRules:{zkClusterId:[{required:!0,message:"请输入集群名称",trigger:"blur"}],serName:[{required:!0,message:"请输入服务名",trigger:"blur"}],ip:[{required:!0,message:"请输入应用IP",trigger:"blur"}],loadbalance:[{required:!0,message:"请选择负载均衡策略",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]},serviceForm:{},dataBox:[],routintList:[],tableVal:[],popBox:!1,popForm:{}}},computed:p()({},Object(u.d)({classify:function(e){return e.service.classify},clusterOption:function(e){return e.service.clusterOption}})),mounted:function(){var e=this;this.clusterOption.length<=0&&e.initializeData({vm:e});var t=e.$route.params.zkClusterId;t&&(e.serviceForm=n()({},{zkClusterId:t,serName:e.$route.params.name}),e.search())},methods:p()({},Object(u.b)("service",["initializeData"]),{chooseBox:function(e){this.tableVal=e},handleCurrentChange:function(e){this.currentPage=e,this.routintList=this.dataBox[e-1]},search:function(){var e=this,t=this.serviceForm.zkClusterId,a=n()({},this.serviceForm);if(!t)return this.$message({showClose:!0,message:"带*值不能为空",type:"warning"}),!1;this.loading=!0,this.$axios.post(m.a.serviceFindConfByInput,p()({},a)).then(function(t){t.data.forEach(function(t){t.zkClusterId||(t.zkClusterIdBackup=e.serviceForm.zkClusterId)});var a=JSON.parse(s()(t.data));e.totalPage=a.length,e.dataBox=e.conmmonMethods.arrayHandle(a),e.routintList=e.dataBox[e.currentPage-1],e.loading=!1}).catch(function(t){e.loading=!1,e.totalPage=0,e.dataBox=[],e.currentPage=1,e.routintList=[],e.$message.error(t&&t.data&&t.data.message||"ERROR")})},routingAdd:function(){this.popForm={},this.popBox=!0},popOk:function(){var e=this,t=this.popForm,a=t.zkClusterId,o=t.ip,l=t.serName,r=t.loadbalance;if(a&&o&&l&&r){var s=n()({},this.popForm);s.enable=!0,this.loading=!0,this.$axios.post(m.a.serviceAddConfig,p()({},s)).then(function(t){"0000"===t.code&&(e.$message({message:"新增成功",type:"success"}),e.serviceForm.zkClusterId=s.zkClusterId,e.popBox=!1,e.search())}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})}else this.$message({message:"带*不能为空",type:"warning"})},cancel:function(){this.$refs.popForm.resetFields(),this.popBox=!1},routingDelete:function(e){var t=this;this.conmmonMethods.makePopBox(this,"删除").then(function(){var a=[],o="";if(e){var l=e.row,r=l.serName,i=l.ip,n=l.zkClusterId,c=l.mock,p=l.weight,u=l.loadbalance,d=l.enable,f=l.appName,g=l.disabled;n||(n=e.row.zkClusterIdBackup),a.push({serName:r,ip:i,zkClusterId:n,mock:c,weight:p,loadbalance:u,enable:d,appName:f,disabled:g})}else Array.isArray(t.tableVal)&&t.tableVal.forEach(function(e,t){e.zkClusterId||(e.zkClusterId=e.zkClusterIdBackup);var l=e.serName,r=e.ip,s=e.zkClusterId,i=e.mock,n=e.weight,c=e.loadbalance,p=e.enable,m=e.appName,u=e.disabled;"true"===p?a.push({serName:l,ip:r,zkClusterId:s,mock:i,weight:n,loadbalance:c,enable:p,appName:m,disabled:u}):o+=l+"、"});if(o.length>0)return t.$message({message:"不允许删除失效数据",type:"warning"}),!1;a=s()(a),t.loading=!0,t.$axios.post(m.a.serviceDeleConfig,a).then(function(e){"0000"===e.code&&(t.$message({message:"删除成功",type:"success"}),t.search())}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})})},startEffect:function(e){var t=this,a=[];if(e){var o=e.row,l=o.serName,r=o.ip,i=o.zkClusterId,n=o.mock,c=o.weight,p=o.loadbalance,u=o.appName;i||(i=e.row.zkClusterIdBackup),a.push({serName:l,ip:r,zkClusterId:i,mock:n,weight:c,loadbalance:p,enable:"true",appName:u})}else Array.isArray(this.tableVal)&&this.tableVal.forEach(function(e,t){e.zkClusterId||(e.zkClusterId=e.zkClusterIdBackup);var o=e.serName,l=e.ip,r=e.zkClusterId,s=e.mock,i=e.weight,n=e.loadbalance,c=e.appName;a.push({serName:o,ip:l,zkClusterId:r,mock:s,weight:i,loadbalance:n,enable:"true",appName:c})});a=s()(a),this.conmmonMethods.makePopBox(this,"生效").then(function(){t.loading=!0,t.$axios.post(m.a.serviceEnabledConf,a).then(function(e){"0000"===e.code&&(t.$message({message:"生效成功",type:"success"}),t.search())}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})})},stopEffect:function(e){var t=this,a=[];if(e){var o=e.row,l=o.serName,r=o.ip,i=o.zkClusterId,n=o.mock,c=o.weight,p=o.loadbalance,u=o.appName;i||(i=e.row.zkClusterIdBackup),a.push({serName:l,ip:r,zkClusterId:i,mock:n,weight:c,loadbalance:p,enable:"false",appName:u})}else Array.isArray(this.tableVal)&&this.tableVal.forEach(function(e,t){e.zkClusterId||(e.zkClusterId=e.zkClusterIdBackup);var o=e.serName,l=e.ip,r=e.zkClusterId,s=e.mock,i=e.weight,n=e.loadbalance,c=e.appName;a.push({serName:o,ip:l,zkClusterId:r,mock:s,weight:i,loadbalance:n,enable:"false",appName:c})});a=s()(a),this.conmmonMethods.makePopBox(this,"失效").then(function(){t.loading=!0,t.$axios.post(m.a.serviceDisabledConf,a).then(function(e){"0000"===e.code&&(t.$message({message:"失效成功",type:"success"}),t.search())}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})})}}),filters:{loadbalanceChoose:function(e){var t=new l.a([["random","随机"],["roundrobin","轮询"],["leastactive","最少并发"]]);return t.get(e)?t.get(e):""},mockChoose:function(e){var t=new l.a([["force:return+null","屏蔽"],["fail:return+null","容错"]]);return t.get(e)?t.get(e):"未降级"}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tmconfig"},[a("div",{staticClass:"button-group"},[a("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"warning"},on:{click:function(t){e.routingAdd()}}},[e._v(e._s(e.$t("common.add")))]),e._v(" "),0!==e.tableVal.length?a("div",{staticClass:"inline-block ml-10"},[a("el-button",{attrs:{type:"danger",loading:e.loading,size:"small"},on:{click:function(t){e.routingDelete()}}},[e._v(e._s(e.$t("common.delete")))]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.loading,size:"small"},on:{click:function(t){e.startEffect()}}},[e._v(e._s(e.$t("common.takeEffect")))]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.loading,size:"small"},on:{click:function(t){e.stopEffect()}}},[e._v(e._s(e.$t("common.stopEffect")))])],1):e._e()],1),e._v(" "),a("el-form",{ref:"serviceForm",attrs:{model:e.serviceForm,"label-width":"94px","label-position":"right",size:"small",rules:e.inputRules}},[a("el-row",{staticClass:"label-first",attrs:{gutter:20}},[a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:e.$t("redis.redisCluster.clusterName")+"：",prop:"zkClusterId"}},[a("el-select",{attrs:{clearable:"",placeholder:e.$t("common.pleaseChoose")},model:{value:e.serviceForm.zkClusterId,callback:function(t){e.$set(e.serviceForm,"zkClusterId",t)},expression:"serviceForm.zkClusterId"}},e._l(e.clusterOption,function(e){return a("el-option",{key:e.id,attrs:{label:e.pkDesc,value:e.pkValue}})}))],1)],1),e._v(" "),a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:e.$t("service.serviceList.serviceName")+"：","label-width":"68px"}},[a("el-input",{attrs:{type:"text",clearable:""},model:{value:e.serviceForm.serName,callback:function(t){e.$set(e.serviceForm,"serName","string"==typeof t?t.trim():t)},expression:"serviceForm.serName"}})],1)],1),e._v(" "),a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:e.$t("service.provider.ip")+"：","label-width":"40px"}},[a("el-input",{attrs:{type:"text",clearable:""},model:{value:e.serviceForm.ip,callback:function(t){e.$set(e.serviceForm,"ip","string"==typeof t?t.trim():t)},expression:"serviceForm.ip"}})],1)],1),e._v(" "),a("el-col",{attrs:{xl:4,lg:6,align:"right"}},[a("el-form-item",{attrs:{"label-width":"0px"}},[a("el-button",{attrs:{size:"small",type:"primary",loading:e.loading,icon:"el-icon-search"},on:{click:function(t){e.search()}}},[e._v(e._s(e.$t("common.search")))])],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.routintList},on:{"selection-change":e.chooseBox}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"serName",label:e.$t("service.serviceList.serviceName")}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"ip",label:e.$t("service.provider.ip"),width:"130"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:e.$t("service.provider.demotion"),width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("mockChoose")(t.row.mock))+"\n          ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"weight",label:e.$t("service.provider.weight"),width:"70"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"loadbalance",label:e.$t("service.provider.loadbBalance"),width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("loadbalanceChoose")(t.row.loadbalance))+"\n          ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"enable",label:e.$t("service.provider.status"),width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return["true"===t.row.enable?a("el-tag",{attrs:{size:"mini"}},[e._v(e._s(e.$t("common.takeEffect")))]):a("el-tag",{attrs:{type:"danger",size:"mini"}},[e._v(e._s(e.$t("common.stopEffect")))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",width:"120",label:e.$t("common.operation"),fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-dropdown",{attrs:{trigger:"click"}},[a("el-button",{attrs:{type:"text",size:"mini"}},[e._v("\n                操作"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",["true"===t.row.enable?a("el-button",{key:"deleteHandle",attrs:{type:"text",size:"mini",icon:"fa fa-pencil-square-o"},on:{click:function(a){e.routingDelete(t)}}},[e._v("删除")]):e._e()],1),e._v(" "),a("el-dropdown-item",["true"!==t.row.enable?a("el-button",{staticStyle:{color:"#67c23a"},attrs:{type:"text",size:"mini",icon:"fa fa-play"},on:{click:function(a){e.startEffect(t)}}},[e._v(e._s(e.$t("common.takeEffect")))]):e._e()],1),e._v(" "),a("el-dropdown-item",["true"===t.row.enable?a("el-button",{staticStyle:{color:"#FF0000"},attrs:{type:"text",size:"mini",icon:"fa fa-stop"},on:{click:function(a){e.stopEffect(t)}}},[e._v(e._s(e.$t("common.stopEffect")))]):e._e()],1)],1)],1)]}}])})],1),e._v(" "),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":10,layout:"total, prev, pager, next, jumper",background:"",total:e.totalPage},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"添加动态配置",visible:e.popBox,width:"40%",center:""},on:{close:function(t){e.cancel()},"update:visible":function(t){e.popBox=t}}},[a("el-form",{ref:"popForm",attrs:{model:e.popForm,"label-width":"120px",size:"small","status-icon":"",rules:e.inputRules}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("redis.redisCluster.clusterName")+"：",prop:"zkClusterId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:e.$t("common.pleaseChoose")},model:{value:e.popForm.zkClusterId,callback:function(t){e.$set(e.popForm,"zkClusterId",t)},expression:"popForm.zkClusterId"}},e._l(e.clusterOption,function(e){return a("el-option",{key:e.id,attrs:{label:e.pkDesc,value:e.pkValue}})}))],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("service.serviceList.serviceName")+"：",prop:"serName"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入1-100位字符",maxlength:"100",clearable:""},model:{value:e.popForm.serName,callback:function(t){e.$set(e.popForm,"serName","string"==typeof t?t.trim():t)},expression:"popForm.serName"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("service.serviceList.applyName")+"："}},[a("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.appName,callback:function(t){e.$set(e.popForm,"appName","string"==typeof t?t.trim():t)},expression:"popForm.appName"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("service.tmconfig.applyNameIp")+"：",prop:"ip"}},[a("el-input",{attrs:{type:"text",placeholder:"请输入1-25位字符",maxlength:"25",clearable:""},model:{value:e.popForm.ip,callback:function(t){e.$set(e.popForm,"ip","string"==typeof t?t.trim():t)},expression:"popForm.ip"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("service.provider.loadbBalance")+"：",prop:"loadbalance"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:e.$t("common.pleaseChoose")},model:{value:e.popForm.loadbalance,callback:function(t){e.$set(e.popForm,"loadbalance",t)},expression:"popForm.loadbalance"}},e._l(e.classify.loadGroup,function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),"random"===e.popForm.loadbalance||"roundrobin"===e.popForm.loadbalance?a("el-row",{key:"popFormWeight"},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("service.provider.weight")+"："}},[a("el-input",{attrs:{type:"text",clearable:""},model:{value:e.popForm.weight,callback:function(t){e.$set(e.popForm,"weight","string"==typeof t?t.trim():t)},expression:"popForm.weight"}})],1)],1)],1):e._e(),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("service.provider.demotion")+"："}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:e.$t("common.pleaseChoose")},model:{value:e.popForm.mock,callback:function(t){e.$set(e.popForm,"mock",t)},expression:"popForm.mock"}},e._l(e.classify.demotionGroup,function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})}))],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{loading:e.loading,type:"primary",size:"small"},on:{click:function(t){e.popOk()}}},[e._v(e._s(e.$t("common.ok")))]),e._v(" "),a("el-button",{attrs:{disabled:e.loading,size:"small"},on:{click:function(t){e.cancel()}}},[e._v(e._s(e.$t("common.cancel")))])],1)],1)],1)},staticRenderFns:[]};var g=a("VU/8")(d,f,!1,function(e){a("rgXW")},"data-v-3d653224",null);t.default=g.exports},rgXW:function(e,t){}});