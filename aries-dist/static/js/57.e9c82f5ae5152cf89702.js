webpackJsonp([57],{"4tro":function(a,e){},mcif:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t("ifoU"),r=t.n(i),n=t("mvHQ"),s=t.n(n),o=t("Dd8w"),l=t.n(o),d=t("INCx"),c=t.n(d),h=t("ZlkZ"),m=t("NYxO");function u(a,e){var t={zipkinTime:function(a,e){return e.avgDuration-a.avgDuration},zipkinFailed:function(a,e){return e.failureRate-a.failureRate},coreModel:function(a,e){return e.duration-a.duration},corePerson:function(a,e){return a.duration-e.duration}};t.hasOwnProperty(e)&&a.sort(t[e])}var p={data:function(){return{coreChoose:1,zipkinChoose:1,loadingCore:!1,isCore:!0,coreBarData:[],loadingZipkin:!1,isZipkin:!0,zipkinOriginData:[],zipkinBarData:{},loadingServer:!1,isServer:!0,serverBarData:[],loadingAlarmType:!1,isAlarmType:!0,alarmPieData:[],loadingAlarmId:!1,isAlarmId:!0,LevelLogData:[]}},directives:{cardSmallResize:{inserted:function(a,e){var t=Number(e.value);a.style.height=c()(100*a.clientWidth/t)+"px",a.style.lineHeight=c()(100*a.clientWidth/t)+"px",window.addEventListener("resize",function(){a.style.lineHeight=c()(100*a.clientWidth/t)+"px",a.style.height=c()(100*a.clientWidth/t)+"px"},!1)}}},computed:l()({},Object(m.d)({isCollapse:function(a){return a.app.isCollapse},theme:function(a){return a.app.theme}})),watch:{coreBarData:function(a){var e=this;this.isCore&&a?setTimeout(function(){e.coreBarHandle(a)},1e3):this.isCore=!1},zipkinBarData:function(a){var e=this;this.isZipkin&&"{}"!==s()(a)?setTimeout(function(){e.zipkinBarHandle(a)},1e3):this.isZipkin=!1},serverBarData:function(a){var e=this;this.isServer&&"{}"!==s()(a)?setTimeout(function(){e.serverBarHandle(a)},1e3):this.isServer=!1},alarmPieData:function(a){var e=this;this.isAlarmType&&Array.isArray(a)&&a.length>0?setTimeout(function(){e.alarmPieHandle(a)},1e3):this.isAlarmType=!1},LevelLogData:function(a){var e=this;if(this.isAlarmId&&Array.isArray(a)&&a.length>0){var t={value:[],name:[],num:[],model:[]};a.forEach(function(a){a.value&&t.value.push(a.value),a.name&&t.name.push(a.name),t.num.push(a.num),t.model.push(1)}),setTimeout(function(){e.alarmBarHandle(t)},1e3)}else this.isAlarmId=!1}},mounted:function(){var a=this;this.coreDataHandle(),this.zipkinDataHandle(),this.serverDataHandle(),this.alarmTypeHandle(),this.alarmIdHandle(),this.$watch("theme",function(){a.coreDataHandle(),a.zipkinDataHandle(),a.serverDataHandle(),a.alarmTypeHandle(),a.alarmIdHandle()}),this.$watch("isCollapse",function(){a.coreDataHandle(),a.zipkinDataHandle(),a.serverDataHandle(),a.alarmTypeHandle(),a.alarmIdHandle()})},methods:{chooseCoreHandle:function(a){this.coreChoose=a,this.coreDataHandle()},choosezipkinHandle:function(a){if(this.zipkinChoose=a,s()(this.zipkinOriginData).length<3)return!1;var e={type:a,name:[],data:[]};u(this.zipkinOriginData,1===a?"zipkinTime":"zipkinFailed"),(this.zipkinOriginData.length>10?this.zipkinOriginData.slice(0,10):this.zipkinOriginData).forEach(function(t){e.name.push(t.spanName),1===a?e.data.push(c()(t.avgDuration/1e3)):e.data.push(t.failureRate)}),this.zipkinBarData=e},coreDataHandle:function(){var a=this;this.loadingCore=!1,this.isCore=!0,this.$axios.post(h.a.findAllCountGroupByColumn).then(function(e){a.isCore=!0,a.loadingCore=!1,a.coreBarData=e.data}).catch(function(e){a.loadingCore=!1,a.isCore=!1,a.coreBarData=[],a.$message.error(e&&e.data&&e.data.message||"ERROR")}),this.coreBarData=[{value:"1000",name:"核心应用实例"},{value:850,name:"Zookeeper应用"},{value:450,name:"Redis应用"},{value:750,name:"其他"}]},zipkinDataHandle:function(){var a=this;this.loadingZipkin=!0,this.isZipkin=!0,this.zipkinBarData={};var e=(new Date).getTime(),t=e-6048e5;this.$axios.get(h.a.spanDuration,{params:{startTime:t,endTime:e}}).then(function(e){if(Array.isArray(e)&&e.length<=0)return a.loadingZipkin=!1,a.isZipkin=!1,a.zipkinBarData={},!1;a.zipkinOriginData=e.map(function(a){return a.failureRate=100-c()(a.successNumber/a.callNumber*1e3)/10,a}),a.loadingZipkin=!1,a.isZipkin=!0,a.choosezipkinHandle(1)}).catch(function(e){a.loadingZipkin=!1,a.isZipkin=!1,a.zipkinBarData={},a.$message.error(e&&e.data&&e.data.message||"ERROR")})},serverDataHandle:function(){this.loadingServer=!1,this.isServer=!0,this.serverBarData={name:["CPU","GPU","IO","主板","硬盘","内存"],data:[{value:51},{value:34},{value:60},{value:78},{value:60},{value:90}]}},alarmTypeHandle:function(){var a=this;this.alarmPieData=[],this.loadingAlarmType=!0,this.isAlarmType=!0,this.$axios.get(h.a.getAlarmTypeLog).then(function(e){a.isAlarmType=!0,a.loadingAlarmType=!1,a.alarmPieData=e.data}).catch(function(e){a.loadingAlarmType=!1,a.isAlarmType=!1,a.alarmPieData=[],a.$message.error(e&&e.data&&e.data.message||"ERROR")})},alarmIdHandle:function(){var a=this,e=this;e.LevelLogData=[],e.loadingAlarmId=!0,e.isAlarmId=!0,e.$axios.get(h.a.alarmLevelLog).then(function(e){a.isAlarmId=!0,a.loadingAlarmId=!1,a.LevelLogData=e.data}).catch(function(t){a.isAlarmId=!1,a.loadingAlarmId=!1,a.LevelLogData=[],e.$message.error(t&&t.data&&t.data.message||"ERROR")})},initEcharts:function(a,e){var t=this,i=this.$refs[a];this.$echarts.init(i).setOption(e),this.$echarts.init(i).resize(),window.addEventListener("resize",function(){t.$echarts.init(i).resize()},!1)},coreBarHandle:function(a){var e={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"59%",y:"center",x:"center",icon:"rect",textStyle:{color:[],fontSize:12,width:200,height:20},itemWidth:10,itemHeight:10,itemGap:20,formatter:function(a){for(var t=e.series[0].data,i=0;i<t.length;i++)if(a===t[i].name)return a+"  "+t[i].value+"个 "}},color:["#218FF0","#FFCB3F","#FA7782","#31DAB3"],calculable:!1,series:[{name:"年龄",type:"pie",radius:["35%","55%"],center:["23%","50%"],roseType:"radius",width:"100%",max:100,itemStyle:{normal:{label:{show:!1},labelLine:{show:!1}},emphasis:{label:{show:!1},labelLine:{show:!1}}},data:a}]};this.initEcharts("coreBarEcharts",e)},zipkinBarHandle:function(a){var e={text:"dark"!==this.theme?"#000":"#fff",line:"dark"!==this.theme?new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#17C4FF"},{offset:1,color:"#218FF0"}]):"#3ABFA8"},t=1===a.type?"单位：ms":"单位：%",i=null;i=a.data[0];for(var r=1;r<a.data.length;r++)a.data[r]>i&&(i=a.data[r]);i=c()(12*i/10);var n=a.name,s=a.name.map(function(a){return a.slice(0,4)+"..."}),o=a.data,l={grid:{top:"35",left:21+8*(i+"").length+"",right:"1%",bottom:"50"},tooltip:{show:!0,trigger:"axis",formatter:function(e){var t=1===a.type?"ms":"%",i=e[0].value,r=o.indexOf(i);return n[r]+"："+i+t},showDelay:0,hideDelay:50,transitionDuration:0,showContent:!0,borderRadius:8,padding:10},legend:{data:["调用链"]},xAxis:[{type:"category",gridIndex:0,data:s,axisPointer:{type:"shadow"},axisTick:{length:"0"},axisLabel:{rotate:270,color:e.text},axisLine:{show:!1}}],yAxis:{type:"value",gridIndex:0,name:t,nameTextStyle:{color:e.text},offset:"10",min:0,max:i,axisLabel:{formatter:"{value}",color:e.text},axisTick:{length:"0"},axisLine:{show:!1},splitLine:{show:!0,lineStyle:{color:"#E6E6E6"}}},series:[{name:"调用链",type:"bar",barWidth:"20%",itemStyle:{normal:{color:e.line}},data:o}]};this.initEcharts("zipkinBarEcharts",l)},serverBarHandle:function(a){for(var e={background:"dark"!==this.theme?"#fff":"#17192D",text:"dark"!==this.theme?"#000":"#fff",line:"dark"!==this.theme?"#ecf0f4":"#282C50"},t=a.data,i=a.name,r=[],n=0;n<t.length;n++)r.push(100);t.map(function(a){return a.value>=90?a.itemStyle={normal:{color:{colorStops:[{offset:0,color:"#DB3F4C"},{offset:1,color:"#F5939F"}],globalCoord:!1}}}:a.itemStyle={normal:{color:{colorStops:[{offset:0,color:"#218FF0"},{offset:1,color:"#45C2F9"}],globalCoord:!1}}},a});var s={grid:{top:"3%",left:"40",right:"40",bottom:"0"},backgroundColor:e.background,xAxis:{show:!1},yAxis:[{type:"category",show:!0,data:i,inverse:!0,axisLine:{show:!1},splitLine:{show:!1},axisTick:{show:!1},axisLabel:{color:e.text,formatter:function(a,e){return[a].join("\n")}}},{show:!0,inverse:!0,data:t,axisLabel:{textStyle:{fontSize:12,color:e.text},formatter:function(a,e){return a+"%"}},axisLine:{show:!1},splitLine:{show:!1},axisTick:{show:!1}}],series:[{name:"条",type:"bar",yAxisIndex:0,data:t,barWidth:"15",label:{normal:{show:!1,position:"inside",formatter:"{c}%"}}},{show:!0,type:"bar",barGap:"-100%",barWidth:"15",itemStyle:{normal:{color:e.line}},z:1,data:r}]};this.initEcharts("serverBarEcharts",s)},alarmPieHandle:function(a){var e={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{x:"center",y:"top",top:"71%",itemWidth:10,itemHeight:10,textStyle:{color:"dark"!==this.theme?"#000":"#fff"}},color:["#218FF0","#FFCB3F","#FA7782","#31DAB3"],series:[{name:"比例",type:"pie",radius:["25%","41%"],center:["50%","40%"],label:{normal:{formatter:"{b|{b}} {c}个",borderRadius:4,rich:{b:{fontSize:12,lineHeight:20}}}},data:a}]};this.initEcharts("alarmPieEcharts",e)},alarmBarHandle:function(a){for(var e={background:"dark"!==this.theme?"#fff":"#17192D",text:"dark"!==this.theme?"#000":"#fff",line:"dark"!==this.theme?"#ecf0f4":"#282C50"},t=a.value,i=a.num,n=a.name,s=a.model,o=a.num[0],l=0;l<a.num.length;l++)a.num[l]>o&&(o=a.num[l]);o=12*o/10;var d=new r.a([["DEADLY",{begin:"#DB3F4C",end:"#F5939F"}],["ERROR",{begin:"#EC7537",end:"#FBC08C"}],["WARNING",{begin:"#FFBE38",end:"#FFE17A "}],["INFO",{begin:"#218FF0",end:"#5BCDFF"}]]),c=[];function h(a,e){return"begin"===e?d.get(t[a])&&d.get(t[a]).begin||"#218FF0":d.get(t[a])&&d.get(t[a]).end||"#5BCDFF"}i.forEach(function(a,e){c.push({name:n[e],value:a,itemStyle:{normal:{color:{colorStops:[{offset:0,color:h(e,"begin")},{offset:1,color:h(e,"end")}],globalCoord:!1}}}})});var m={grid:{left:"0",top:"10",right:"0",bottom:"0"},backgroundColor:e.background,color:["#559fef"],xAxis:[{show:!1},{show:!1,max:o}],yAxis:{type:"category",show:!1,axisLabel:{inside:!0},data:n},series:[{show:!0,type:"bar",barGap:"-100%",barWidth:15,xAxisIndex:1,itemStyle:{normal:{}},max:1,labelLine:{show:!1},z:100,data:c,formatter:function(a){return a.value}},{show:!0,type:"bar",barGap:"-100%",barWidth:15,itemStyle:{normal:{color:e.line}},label:{normal:{show:!0,position:["80%","-180%"],rich:{aa:{color:e.text,fontSize:12}},formatter:function(a){var e="";return e+="{aa| "+i[a.dataIndex]+"个}"}}},z:3,formatter:function(a){return""},data:s},{show:!0,type:"bar",barGap:"-100%",barWidth:15,itemStyle:{normal:{color:"#F2F2F2"}},label:{normal:{show:!1,position:["60%","-180%"],fontSize:12,textStyle:{color:"#000"}}},data:s},{show:!0,type:"bar",xAxisIndex:1,barGap:"-100%",barWidth:15,itemStyle:{normal:{color:"#ecf0f4"}},label:{normal:{show:!0,position:[0,"-180%"],fontSize:12,textStyle:{color:e.text},formatter:function(a){return n[a.dataIndex]}}},formatter:function(a){return"12"},data:s}]};this.initEcharts("alarmBarEcharts",m)}}},v={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{ref:"dashboard",staticClass:"dashboard",attrs:{id:"dashboard"}},[t("el-row",{staticClass:"main-content",attrs:{gutter:10}},[t("el-col",{attrs:{span:"12"}},[t("el-card",{staticClass:"todo-wrap",attrs:{shadow:"hover"}},[t("div",{staticClass:"todo-header",attrs:{slot:"header"},slot:"header"},[t("span",{class:{header_choose:1===a.coreChoose},on:{click:function(e){a.chooseCoreHandle(1)}}},[a._v("应用模块统计")]),a._v(" "),t("span",{staticClass:"header_gang"},[a._v("|")]),a._v(" "),t("span",{class:{header_choose:2===a.coreChoose},on:{click:function(e){a.chooseCoreHandle(2)}}},[a._v("应用实例指标统计")])]),a._v(" "),t("div",{staticClass:"todo-list"},[a.isCore?t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:162,expression:"162"}],key:"coreTrue",ref:"coreBarEcharts"}):t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:162,expression:"162"}],key:"coreFalse",staticClass:"no-data"},[a._v("暂无数据")])])])],1),a._v(" "),t("el-col",{attrs:{span:12}},[t("el-card",{staticClass:"todo-wrap",attrs:{shadow:"hover"}},[t("div",{staticClass:"todo-header",attrs:{slot:"header"},slot:"header"},[t("span",{class:{header_choose:1===a.zipkinChoose},on:{click:function(e){a.choosezipkinHandle(1)}}},[a._v("调用链耗时排序")]),a._v(" "),t("span",{staticClass:"header_gang"},[a._v("|")]),a._v(" "),t("span",{class:{header_choose:2===a.zipkinChoose},on:{click:function(e){a.choosezipkinHandle(2)}}},[a._v("调用链出错率排序")])]),a._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loadingZipkin,expression:"loadingZipkin"}],staticClass:"todo-list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[a.isZipkin?t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:162,expression:"162"}],key:"zipkinTrue",ref:"zipkinBarEcharts"}):t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:162,expression:"162"}],key:"zipkinFalse",staticClass:"no-data"},[a._v("暂无数据")])])])],1)],1),a._v(" "),t("el-row",{staticClass:"main-content",attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-card",{staticClass:"todo-wrap",attrs:{shadow:"hover"}},[t("div",{staticClass:"todo-header",attrs:{slot:"header"},slot:"header"},[t("span",[a._v("服务器指标排序")])]),a._v(" "),t("div",{staticClass:"todo-list"},[a.isServer?t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:115,expression:"115"}],key:"serverTrue",ref:"serverBarEcharts"}):t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:115,expression:"115"}],key:"serverFalse",staticClass:"no-data"},[a._v("暂无数据")])])])],1),a._v(" "),t("el-col",{attrs:{span:8}},[t("el-card",{staticClass:"todo-wrap",attrs:{shadow:"hover"}},[t("div",{staticClass:"todo-header",attrs:{slot:"header"},slot:"header"},[t("span",[a._v("告警类型统计")])]),a._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loadingAlarmType,expression:"loadingAlarmType"}],staticClass:"todo-list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[a.isAlarmType?t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:115,expression:"115"}],key:"alarmTypeTrue",ref:"alarmPieEcharts"}):t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:115,expression:"115"}],key:"alarmTypeFalse",staticClass:"no-data"},[a._v("暂无数据")])])])],1),a._v(" "),t("el-col",{attrs:{span:8}},[t("el-card",{staticClass:"todo-wrap",attrs:{shadow:"hover"}},[t("div",{staticClass:"todo-header",attrs:{slot:"header"},slot:"header"},[t("span",[a._v("告警级别统计")])]),a._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loadingAlarmId,expression:"loadingAlarmId"}],staticClass:"todo-list",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[a.isAlarmId?t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:115,expression:"115"}],key:"alarmIdTrue",ref:"alarmBarEcharts"}):t("div",{directives:[{name:"cardSmallResize",rawName:"v-cardSmallResize",value:115,expression:"115"}],key:"alarmIdFalse",staticClass:"no-data"},[a._v("暂无数据")])])])],1)],1)],1)},staticRenderFns:[]};var f=t("VU/8")(p,v,!1,function(a){t("4tro")},"data-v-0d1aa112",null);e.default=f.exports}});