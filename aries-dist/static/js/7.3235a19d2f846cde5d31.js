webpackJsonp([7],{He16:function(e,t){},Nz3l:function(e,t,a){"use strict";var i=a("Dd8w"),s=a.n(i),n=a("NYxO"),r={data:function(){return{activeNames:[],spliceForms:[{key:"",value:""}],scopeForm:[{key:"",value:"",scopeValue:""}]}},props:{limiterData:{type:Object,default:function(){}}},computed:s()({},Object(n.d)({limiterOptions:function(e){return e.gateway.limiterOptions},timePredicate:function(e){return e.gateway.timePredicate},headersData:function(e){return e.gateway.headersData}})),methods:{limiterChange:function(e,t){var a=this.limiterOptions.filter(function(t){return t.name===e});t.args=this.commonFunc.deepCopy(a[0].args)},limiterPredicateChange:function(e,t){var a=this.timePredicate.filter(function(t){return t.name===e});t.args=a[0].args},addBaseLimiter:function(){this.limiterData.baseLimiter.push({filter:{name:"",args:[]}})},addTempLimiter:function(){this.limiterData.tempLimiter.push({filter:{name:"",args:[]},predicate:{name:"",args:[]}})},deleteLimiter:function(e,t,a){e||"base"!==a?e||"temp"!==a?this.$emit("deleteLimiter",{id:e,index:t,type:a}):this.limiterData.tempLimiter.splice(t,1):this.limiterData.baseLimiter.splice(t,1)},addSpliceParam:function(){this.spliceForms.push({key:"",value:""})},deleteSpliceParam:function(e){this.spliceForms.splice(e,1)},closeSpliceStr:function(e){e.visible=!1,this.spliceForms=[{key:"",value:""}]},closeSpliceScopeStr:function(e){e.visible=!1,this.scopeForm=[{key:"",value:"",scopeValue:""}]},addSpliceScopeStr:function(e,t){var a=this.scopeForm.map(function(e){return e.key}).join("-"),i=this.scopeForm.map(function(e){return e.value+"-"+e.scopeValue})[0];t.forEach(function(e){e.name.includes(".key")&&(e.value=a),e.name.includes(".value")&&(e.value=i)}),this.closeSpliceScopeStr(e)},addSpliceStr:function(e,t){var a=this.spliceForms.map(function(e){return e.key}).join("-"),i=this.spliceForms.map(function(e){return e.value}).join("-");t.forEach(function(e){e.name.includes(".key")&&(e.value=a),e.name.includes(".value")&&(e.value=i)}),this.closeSpliceStr(e)},showScopeAlert:function(e){var t=this,a=e.filter(function(e){return e.name.includes(".key")})[0].value,i=e.filter(function(e){return e.name.includes(".value")})[0].value;if(a&&i){var s=a.split("-"),n=i.split("-");t.scopeForm=[],s.forEach(function(e,a){t.scopeForm.push({key:s[a],value:n[0],scopeValue:n[1]})})}},showAlert:function(e){var t=this,a=e.filter(function(e){return e.name.includes(".key")})[0].value,i=e.filter(function(e){return e.name.includes(".value")})[0].value;if(a&&i){var s=a.split("-"),n=i.split("-");t.spliceForms=[],s.forEach(function(e,a){t.spliceForms.push({key:s[a]})}),n.forEach(function(e,a){t.spliceForms[a].value=n[a]})}}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"limiter"},[a("div",{staticClass:"limiter-box"},[a("div",{staticClass:"route-box"},[a("h3",[e._v("基础限流")]),e._v(" "),e._l(e.limiterData.baseLimiter,function(t,i){return a("el-form",{key:i,ref:"limiterForm",refInFor:!0,attrs:{model:t,"label-width":"90px",size:"small"}},[a("el-form-item",{attrs:{label:"限流策略："}},[a("el-select",{staticClass:"mb-15",staticStyle:{width:"260px"},on:{change:function(a){e.limiterChange(a,t.filter)}},model:{value:t.filter.name,callback:function(a){e.$set(t.filter,"name",a)},expression:"base.filter.name"}},e._l(e.limiterOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.comment,value:e.name}})})),e._v(" "),a("el-button",{staticClass:"ml-10",attrs:{type:"danger"},on:{click:function(a){e.deleteLimiter(t.id,i,"base")}}},[e._v("删除")]),e._v(" "),e._l(t.filter.args,function(s,n){return a("div",{key:n},[a("el-row",{attrs:{gutter:15}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Key：","label-width":"60px"}},[a("el-input",{attrs:{disabled:""},model:{value:s.name,callback:function(t){e.$set(s,"name",t)},expression:"arg.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},["fixed_splice"===s.type?a("el-form-item",{attrs:{label:"Value：","label-width":"60px"}},[a("el-popover",{attrs:{placement:"top",width:"500"},on:{show:function(a){e.showAlert(t.filter.args)},hide:function(t){e.closeSpliceStr(s)}},model:{value:s.visible,callback:function(t){e.$set(s,"visible",t)},expression:"arg.visible"}},[e._l(e.spliceForms,function(t,i){return a("el-form",{key:i,attrs:{model:t,size:"small","label-width":"55px"}},[a("el-row",{staticClass:"mt-10",attrs:{gutter:10}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"Key: "}},[a("el-select",{model:{value:t.key,callback:function(a){e.$set(t,"key",a)},expression:"item.key"}},e._l(e.headersData,function(e){return a("el-option",{key:e.name,attrs:{label:e.desc,value:e.name}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"Value: "}},[a("el-input",{model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{size:"mini",type:"info",icon:"el-icon-plus",circle:""},on:{click:e.addSpliceParam}}),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0!==i,expression:"j !== 0"}],attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){e.deleteSpliceParam(i)}}})],1)],1)],1)}),e._v(" "),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.closeSpliceStr(s)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.addSpliceStr(s,t.filter.args)}}},[e._v("确定")])],1),e._v(" "),a("el-input",{attrs:{slot:"reference",placeholder:s.placeholder,readonly:""},slot:"reference",model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"arg.value"}})],2),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(s.eg))])],1):"splice"===s.type?a("el-form-item",{attrs:{label:"Value：","label-width":"60px"}},[a("el-popover",{attrs:{placement:"top",width:"500"},on:{show:function(a){e.showScopeAlert(t.filter.args)},hide:function(t){e.closeSpliceScopeStr(s)}},model:{value:s.visible,callback:function(t){e.$set(s,"visible",t)},expression:"arg.visible"}},[e._l(e.scopeForm,function(t,s){return a("el-form",{key:s,ref:e.spliceForm+i,refInFor:!0,attrs:{model:t,size:"small","label-width":"55px"}},[a("el-row",{staticClass:"mt-10",attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Key: "}},[a("el-select",{model:{value:t.key,callback:function(a){e.$set(t,"key",a)},expression:"item.key"}},e._l(e.headersData,function(e,t){return a("el-option",{key:t,attrs:{label:e.desc,value:e.name}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Value: "}},[a("el-input",{staticStyle:{width:"45%"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}}),e._v(" - \n                            "),a("el-input",{staticStyle:{width:"45%"},model:{value:t.scopeValue,callback:function(a){e.$set(t,"scopeValue",a)},expression:"item.scopeValue"}})],1)],1)],1)],1)}),e._v(" "),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.closeSpliceScopeStr(s)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.addSpliceScopeStr(s,t.filter.args)}}},[e._v("确定")])],1),e._v(" "),a("el-input",{attrs:{slot:"reference",placeholder:s.placeholder,readonly:""},slot:"reference",model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"arg.value"}})],2),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(s.eg))])],1):a("el-form-item",{attrs:{label:"Value：",prop:"filter.args."+n+".value","label-width":"60px",rules:{required:!0,message:"请输入Value",trigger:["blur","change"]}}},[a("el-input",{attrs:{placeholder:s.placeholder},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"arg.value"}}),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(s.eg))])],1)],1)],1)],1)})],2)],1)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:e.addBaseLimiter}},[e._v("添加基础限流")])],1)],2)])])},staticRenderFns:[]},o=a("VU/8")(r,l,!1,null,null,null);t.a=o.exports},XH8P:function(e,t){},avfd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("//Fk"),s=a.n(i),n=a("Xxa5"),r=a.n(n),l=a("exGp"),o=a.n(l),c=a("Dd8w"),u=a.n(c),d=a("NYxO"),m=a("Nz3l"),p=a("0uvK"),f={data:function(){return{visible:!1,fuseForm:{},btnLoading:!1}},methods:u()({},Object(d.b)("gateway",["addFuse"]),{close:function(){this.$parent.fuseVisible=!1,this.$refs.fuseForm.clearValidate(),this.fuseForm={}},confirm:function(){var e,t=this,a=this;a.$refs.fuseForm.validate((e=o()(r.a.mark(function e(i){var s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=13;break}return a.btnLoading=!0,s="",e.prev=3,e.next=6,a.addFuse(a.fuseForm);case 6:s=e.sent,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(3);case 11:a.btnLoading=!1,s&&s.code===p.d&&(a.$message.success("添加熔断策略成功"),a.close(),a.$emit("getFuse"));case 13:case"end":return e.stop()}},e,t,[[3,9]])})),function(t){return e.apply(this,arguments)}))}})},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-fuse"},[a("el-dialog",{attrs:{title:"添加熔断",visible:e.$parent.fuseVisible,width:"30%",center:""},on:{"update:visible":function(t){e.$set(e.$parent,"fuseVisible",t)},close:e.close}},[a("el-form",{ref:"fuseForm",attrs:{model:e.fuseForm,size:"small","label-width":"110px"}},[a("el-form-item",{attrs:{label:"名称：",prop:"name",rules:{required:!0,message:"熔断名称不能为空",trigger:"blur"}}},[a("el-input",{attrs:{placeholder:"配置的熔断策略名"},model:{value:e.fuseForm.name,callback:function(t){e.$set(e.fuseForm,"name",t)},expression:"fuseForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"超时时间：",prop:"timeout_in_milliseconds",rules:{required:!0,message:"超时时间不能为空",trigger:"blur"}}},[a("el-input",{attrs:{placeholder:"熔断判定的超时时间"},model:{value:e.fuseForm.timeout_in_milliseconds,callback:function(t){e.$set(e.fuseForm,"timeout_in_milliseconds",t)},expression:"fuseForm.timeout_in_milliseconds"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"最大请求数：",prop:"timeout_in_milliseconds",rules:{required:!0,message:"最大请求数不能为空",trigger:"blur"}}},[a("el-input",{attrs:{placeholder:"熔断判定的最大请求数"},model:{value:e.fuseForm.max_concurrent_requests,callback:function(t){e.$set(e.fuseForm,"max_concurrent_requests",t)},expression:"fuseForm.max_concurrent_requests"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.confirm}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{disabled:e.btnLoading,size:"small"},on:{click:e.close}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]},h=a("VU/8")(f,v,!1,null,null,null).exports,b=a("woOf"),g=a.n(b),_={data:function(){return{visible:!1,modifyForm:{},btnLoading:!1}},props:{options:Array},methods:u()({},Object(d.b)("gateway",["addFuse","deleteFuseStrategy"]),{deleteFuse:function(e){var t=this,a=this;a.$confirm("是否确认删除："+e+"？","删除",{confirmButtonText:a.$t("common.ok"),cancelButtonText:a.$t("common.cancel"),type:"warning",center:!0}).then(o()(r.a.mark(function i(){var s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.btnLoading=!0,t.next=3,a.deleteFuseStrategy(e);case 3:(s=t.sent)&&s.code===p.d&&(a.btnLoading=!1,a.close(),a.$message.success("删除熔断策略成功"),a.$emit("getFuse"));case 5:case"end":return t.stop()}},i,t)}))).catch(function(){})},close:function(){this.$parent.modifyFuseVisible=!1,this.$refs.modifyForm.resetFields()},optionChange:function(e){var t=this;this.options.map(function(a){if(a.name===e)for(var i in a)"name"!==i&&(t.modifyForm[i]=a[i])})},confirm:function(){var e,t=this,a=this,i=g()(a.modifyForm,{updateFlag:!0});a.$refs.modifyForm.validate((e=o()(r.a.mark(function e(s){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=13;break}return e.prev=1,a.btnLoading=!0,e.next=5,a.addFuse(i);case 5:n=e.sent,a.btnLoading=!1,n&&n.code===p.d&&(a.$message.success("修改熔断策略成功"),a.close(),a.$emit("getFuse")),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),a.btnLoading=!1;case 13:case"end":return e.stop()}},e,t,[[1,10]])})),function(t){return e.apply(this,arguments)}))}})},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"add-fuse"},[a("el-dialog",{attrs:{title:"修改熔断",visible:e.$parent.modifyFuseVisible,width:"30%",center:""},on:{"update:visible":function(t){e.$set(e.$parent,"modifyFuseVisible",t)},close:e.close}},[a("el-form",{ref:"modifyForm",attrs:{model:e.modifyForm,size:"small","label-width":"110px"}},[a("el-form-item",{attrs:{label:"名称：",prop:"name",rules:{required:!0,message:"请选择熔断名称",trigger:"change"}}},[a("el-select",{on:{change:e.optionChange},model:{value:e.modifyForm.name,callback:function(t){e.$set(e.modifyForm,"name",t)},expression:"modifyForm.name"}},e._l(e.options,function(t){return a("el-option",{key:t.name,attrs:{label:t.name,value:t.name}},[a("span",{staticClass:"pull-left"},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticClass:"pull-right el-icon-close",on:{click:function(a){e.deleteFuse(t.name)}}})])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"超时时间：",prop:"timeout_in_milliseconds",rules:{required:!0,message:"超时时间不能为空",trigger:"blur"}}},[a("el-input",{attrs:{placeholder:"熔断判定的超时时间"},model:{value:e.modifyForm.timeout_in_milliseconds,callback:function(t){e.$set(e.modifyForm,"timeout_in_milliseconds",t)},expression:"modifyForm.timeout_in_milliseconds"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"最大请求数：",prop:"max_concurrent_requests",rules:{required:!0,message:"最大请求数不能为空",trigger:"blur"}}},[a("el-input",{attrs:{placeholder:"熔断判定的最大请求数"},model:{value:e.modifyForm.max_concurrent_requests,callback:function(t){e.$set(e.modifyForm,"max_concurrent_requests",t)},expression:"modifyForm.max_concurrent_requests"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.confirm}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{disabled:e.btnLoading,size:"small"},on:{click:e.close}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]},x=a("VU/8")(_,y,!1,null,null,null).exports,k=a("BO1k"),w=a.n(k),F=a("mvHQ"),C=a.n(F),L={data:function(){return{visible:!1,sel:null,columns:[{prop:"ip",label:"IP",width:"auto",align:"center"}],activeName:"black",list:{black:"blackList",white:"whiteList"},blackList:[],whiteList:[],flag:!1}},computed:u()({},Object(d.d)({blackList:function(e){return e.gateway.blackList},whiteList:function(e){return e.gateway.whiteList}})),mounted:function(){this.getData("black"),this.status("black")},methods:u()({},Object(d.b)("gateway",["getList","addList","deleteBlack","getStatus","changeListStatus"]),{handleClick:function(e){this.activeName=e.name,this.getData(this.activeName),this.status(this.activeName)},getData:function(e){var t=this;this.getList(e).then(function(a){a.data.forEach(function(e){e.isSet=!1}),"black"===e?t.blackList=a.data:t.whiteList=a.data})},status:function(e){var t=this;this.getStatus(e).then(function(e){t.flag="enable"===e.data})},switchStatus:function(e){var t=this;this.changeListStatus({type:this.activeName,flag:e?"enable":"disable"}).then(function(a){t.$message.success(e?"启用成功":"禁用成功"),t.status(t.activeName)})},open:function(){this.visible=!0},add:function(){var e={ip:"",isSet:!0};if(this[this.list[this.activeName]].some(function(e){return!0===e.isSet}))return this.$message.warning("请先保存或取消当前编辑项");this[this.list[this.activeName]].unshift(e),this.sel=JSON.parse(C()(e))},editList:function(e,t){if(this[this.list[this.activeName]].some(function(e){return!0===e.isSet}))return this.$message.warning("请先保存或取消当前编辑项");this.sel=JSON.parse(C()(e)),e.isSet=!0},updateList:function(e,t){var a=this,i=!0,s=!1,n=void 0;try{for(var r,l=w()(this[this.list[this.activeName]]);!(i=(r=l.next()).done);i=!0){var o=r.value;if(o.isSet&&o.id!==e.id)return this.$message.warning("请先保存或取消当前编辑项"),!1}}catch(e){s=!0,n=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw n}}if(e.isSet&&!e.id){if(!this.sel.ip)return void this.$message.error("IP不能为空！");this.addList({ip:this.sel.ip,type:this.activeName}).then(function(i){a.$message.success("添加成功！"),e.isSet=!1,a.sel.id||a[a.list[a.activeName]].splice(t,1),a.getData(a.activeName)})}else{if(!this.sel.ip)return void this.$message.error("IP不能为空！");this.addList({id:this.sel.id,ip:this.sel.ip,type:this.activeName}).then(function(t){a.$message.success("修改成功！"),e.isSet=!1,a.getData(a.activeName)})}},cancel:function(e,t){this.sel.id||this[this.list[this.activeName]].splice(t,1),e.isSet=!e.isSet},deleteList:function(e,t){var a=this;this.$confirm("是否确认删除IP："+e.ip,"删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){a.deleteBlack(e.id).then(function(e){a.getData(a.activeName)})}).catch(function(){})}})},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"黑白名单",visible:e.visible,width:"40%"},on:{"update:visible":function(t){e.visible=t}}},[a("div",{staticClass:"clearfix"},[a("el-button",{staticClass:"mb-20 pull-left",attrs:{size:"small",icon:"el-icon-plus",type:"warning"},on:{click:e.add}},[e._v("添加")]),e._v(" "),a("el-switch",{staticClass:"pull-right mt-15",attrs:{"active-text":"启用","inactive-text":"禁用"},on:{change:e.switchStatus},model:{value:e.flag,callback:function(t){e.flag=t},expression:"flag"}})],1),e._v(" "),a("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"黑名单",name:"black"}},[a("el-table",{attrs:{stripe:"",data:e.blackList}},[e._l(e.columns,function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.label,width:t.width,align:t.align},scopedSlots:e._u([{key:"default",fn:function(i){return[i.row.isSet?a("span",[a("el-input",{attrs:{size:"mini",placeholder:"请输入内容"},model:{value:e.sel[t.prop],callback:function(a){e.$set(e.sel,t.prop,a)},expression:"sel[item.prop]"}})],1):a("span",[e._v(e._s(i.row[t.prop]))])]}}])})}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSet?a("span",[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.updateList(t.row,t.$index)}}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.cancel(t.row,t.$index)}}},[e._v("取消")])],1):a("span",[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.editList(t.row,t.$index)}}},[e._v("修改")]),e._v(" "),a("el-button",{staticClass:"btn-text-red",attrs:{type:"text",size:"mini"},on:{click:function(a){e.deleteList(t.row,t.$index)}}},[e._v("删除")])],1)]}}])})],2)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"白名单",name:"white"}},[a("el-table",{attrs:{stripe:"",data:e.whiteList}},[e._l(e.columns,function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.label,width:t.width,align:t.align},scopedSlots:e._u([{key:"default",fn:function(i){return[i.row.isSet?a("span",[a("el-input",{attrs:{size:"mini",placeholder:"请输入内容"},model:{value:e.sel[t.prop],callback:function(a){e.$set(e.sel,t.prop,a)},expression:"sel[item.prop]"}})],1):a("span",[e._v(e._s(i.row[t.prop]))])]}}])})}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isSet?a("span",[a("el-button",{attrs:{type:"text",size:"mini",disabled:!t.row.isSet},on:{click:function(a){e.updateList(t.row,t.$index)}}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.cancel(t.row,t.$index)}}},[e._v("取消")])],1):a("span",[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.editList(t.row,t.$index)}}},[e._v("修改")]),e._v(" "),a("el-button",{staticClass:"btn-text-red",attrs:{type:"text",size:"mini"},on:{click:function(a){e.deleteList(t.row,t.$index)}}},[e._v("删除")])],1)]}}])})],2)],1)],1)],1)},staticRenderFns:[]};var V=a("VU/8")(L,S,!1,function(e){a("He16")},null,null).exports,O={data:function(){return{scene:null,stage:null,serviceTitle:"",searchNodeText:"",serviceVisible:!1,instanceView:{},serviceRouteTitle:"",serviceRouteVisible:!1,serviceRoutes:[],activeNames:[],ordinaryVisible:!1,fuseVisible:!1,modifyFuseVisible:!1,addOrdinaryArr:[{strip_prefix:!0,hystrix_flag:!1,uriAfter:""}],methodOptions:["get","post","delete","put"],currentNode:null,activeTab:"router",limiterData:{baseLimiter:[],tempLimiter:[]},instanceId:"",statusMap:[{text:"上线",value:"UP"},{text:"停止",value:"OUT_OF_SERVICE"},{text:"下线",value:"DOWN"}],fuseOptions:[],loadBalancingOptions:[],balanceVisible:!1,loadForm:{},btnLoading:!1}},components:{limiter:m.a,addFuse:h,modifyFuse:x,blackWhite:V},computed:u()({},Object(d.d)({filterOptions:function(e){return e.gateway.filterOptions},predicateOptions:function(e){return e.gateway.predicateOptions}})),mounted:function(){var e=this;return o()(r.a.mark(function t(){var a,i,s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.setCanvasSize(),e.getFilters(),e.getPredicates(),e.getLimiters(),e.getFuse(),e.$store.dispatch("gateway/getHeaders"),e.getOptionsKey("ribbon").then(function(t){e.loadBalancingOptions=t.data}),a=e.$refs.myCanvas,i=new JTopo.Stage(a),e.stage=i,i.wheelZoom=1.05,i.click(function(e){0==e.button&&$(".contextmenu").hide()}),t.next=14,e.getServiceRoute();case 14:(s=t.sent)&&s.code===p.d&&e.drawCanvas(s.data,i);case 16:case"end":return t.stop()}},t,e)}))()},methods:u()({},Object(d.b)("gateway",["getServiceRoute","getFilters","getPredicates","deleteRouteData","batchAddRoute","addClassicRoute","getLimiters","addLimiter","deleteLimiterData","changeStatus","getOptionsKey","getServiceLoad","setServiceLoad","deleteInstanceData"]),{openBlack:function(){this.$refs.black.open()},setCanvasSize:function(){var e=this.$refs.myCanvas,t=document.getElementById("content");e.width=t.offsetWidth,e.height=document.documentElement.clientHeight-260},resetCanvasData:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.stage.clear(),t.next=3,e.getServiceRoute();case 3:a=t.sent,e.drawCanvas(a.data,e.stage),e.btnLoading=!1;case 6:case"end":return t.stop()}},t,e)}))()},drawCanvas:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],a=this;a.scene=new JTopo.Scene(t),a.scene.alpha=0;var i=[],s=[];e.map(function(e){s=s.concat(e.instance)});var n=140*s.length,r=a.addNode(n/2,0,"gateway.png","网关"),l=0;e.forEach(function(e,t){var s=l+140*(e.instance.length+1)/2;i.push({service:a.addNode(s,350,"server.png",e.service_name,e)}),e.route.length>0&&a.addLink(i[t].service,r,"beeline","64,158,255",e.route,e.limiter),i[t].instance=[],"[object Array]"===Object.prototype.toString.call(e.instance)&&e.instance.length>0&&e.instance.forEach(function(e,s){i[t].instance.push(a.addNode(140*(s+1)+l-1.5,650,"instance-up.png",e.host,e)),a.addLink(i[t].service,i[t].instance[s],"brokenLine","152,152,152"),Object.prototype.toString.call("[object Array]"===e.route)&&e.route.length>0&&a.addLink(i[t].instance[s],r,"dottedLine","241,178,56",e.route,e.limiter)}),l+=140*e.instance.length}),a.stage.centerAndZoom()},addNode:function(e,t,a,i,s){var n,l=this,c=new JTopo.Node;if(c.setImage("../../../static/images/img/"+a,!0),c.fillStyle="255,255,0",c.fontColor="0,0,0",c.font="16px 微软雅黑",c.textPosition="Bottom_Center",c.textOffsetY=0,c.setLocation(e,t),c._name=i,c.text=i.length>20?i.slice(0,16)+"...":i,c.dragable=!1,s&&s.uri){switch(s.status){case"DOWN":c.setImage("../../../static/images/img/instance-down.png",!0);break;case"OUT_OF_SERVICE":c.setImage("../../../static/images/img/instance-stop.png",!0);break;default:c.setImage("../../../static/images/img/instance-up.png",!0)}c.instance=s,c.click(function(e){l.instanceView=e.target.instance,l.serviceTitle=l.instanceView.hostName,l.serviceOpen()})}return s&&s.service_name&&c.click((n=o()(r.a.mark(function e(t){var a,i,n,o;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.commonFunc.deepCopy(s),i=a.service_name,n=a.ribbon_class,l.loadForm={service_name:i,ribbon_class:n},l.serviceTitle=s.service_name,e.next=5,l.getServiceLoad(l.loadForm.service_name);case 5:(o=e.sent)&&o.code===p.d&&o.data&&(l.loadForm.ribbon_class=o.data.ribbon_class),l.balanceVisible=!0;case 8:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})),s&&0===s.route.length&&c.addEventListener("mouseup",function(e){l.currentNode=this,l.handler(e)}),this.scene.add(c),c},addLink:function(e,t,a,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},r=this,l=void 0;return"dottedLine"===a?(l=e.x-2===t.x?new JTopo.Link(e,t):new JTopo.FoldLink(e,t)).dashedPattern=5:"brokenLine"===a?(l=new JTopo.FlexionalLink(e,t)).offsetGap=123.5:l=new JTopo.Link(e,t),l.direction="vertical",l.strokeColor=i,s.length>0&&(l.serviceRoute=s,l.limiter=n,l.click(function(t){r.serviceId=e.instance?e.instance.serviceId:e._name,r.serviceRouteTitle=e._name,r.instanceId=e.instance?e.instance.instanceId:"",r.serviceRoutes=r.commonFunc.deepCopy(s),r.limiterData=n?r.commonFunc.deepCopy(n):{baseLimiter:[],tempLimiter:[]},r.routeOpen()})),this.scene.add(l),l},handler:function(e){2===e.button&&$(".contextmenu").css({top:e.pageY-130,left:e.pageX-290}).show()},serviceOpen:function(){this.serviceVisible=!0},serviceClose:function(){this.serviceVisible=!1},routeOpen:function(){this.serviceRouteVisible=!0},routeClose:function(){if(this.activeNames=[],this.serviceRoutes&&this.serviceRoutes.length>0){for(var e=0;e<this.serviceRoutes.length;e++)this.$refs.routeForm[e].clearValidate();if(this.limiterData.baseLimiter&&this.limiterData.baseLimiter.length>0)for(var t=0;t<this.limiterData.baseLimiter.length;t++)this.$refs.limiter.$refs.limiterForm[t].clearValidate()}this.serviceRouteVisible=!1,this.activeTab="router",this.serviceRoutes=[],this.limiterData={baseLimiter:[],tempLimiter:[]},this.resetCanvasData()},deleteRoute:function(e,t){var a=this,i=this;e?i.$confirm("是否删除路由"+e,"删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(o()(r.a.mark(function s(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,i.deleteRouteData(e);case 3:a.sent,i.serviceRoutes.splice(t,1),i.$message.success("删除成功"),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),i.$message.error(a.t0&&a.t0.data&&a.t0.data.message||"删除失败");case 11:case"end":return a.stop()}},s,a,[[0,8]])}))).catch(function(){}):i.serviceRoutes.splice(t,1)},routeConfirm:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:"router"===(a=e).activeTab?new s.a(function(t,i){var s=!0;a.serviceRoutes.forEach(function(t,i){var n;a.$refs.routeForm[i].validate((n=o()(r.a.mark(function t(a){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a||(s=!1);case 1:case"end":return e.stop()}},t,e)})),function(e){return n.apply(this,arguments)}))}),s&&(a.btnLoading=!0,t(a.serviceRoutes))}).then(function(){var t=o()(r.a.mark(function t(i){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.batchAddRoute(i);case 3:e.sent,a.$message.success("更新成功"),a.routeClose(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),a.btnLoading=!1,a.$message.error(e.t0&&e.t0.data&&e.t0.data.message||"更新失败");case 12:case"end":return e.stop()}},t,e,[[0,8]])}));return function(e){return t.apply(this,arguments)}}()):new s.a(function(e,t){for(var i=!0,s=0;s<a.limiterData.baseLimiter.length;s++)a.$refs.limiter.$refs.limiterForm[s].validate(function(e){e||(i=!1)});i&&(a.btnLoading=!0,e())}).then(o()(r.a.mark(function t(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.addLimiter({params:{serviceId:a.serviceId,instanceId:a.instanceId,type:"base"},data:a.limiterData.baseLimiter});case 3:e.sent,a.$message.success("添加限流成功"),a.routeClose(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),a.btnLoading=!1,a.$message.error(e.t0&&e.t0.data&&e.t0.data.message||"添加限流失败");case 12:case"end":return e.stop()}},t,e,[[0,8]])})));case 2:case"end":return t.stop()}},t,e)}))()},addRoute:function(){this.serviceRoutes.push({id:"",uri:"",filterParam:[],predicateParam:[]})},addFilter:function(e){e.push({name:"",args:[]})},filterChange:function(e,t){var a=this;return o()(r.a.mark(function i(){var s;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:s=a.filterOptions.filter(function(t){return t.name===e}),t.args=s[0].args;case 2:case"end":return i.stop()}},i,a)}))()},addPredicate:function(e){e.push({name:"",args:[]})},predicateChange:function(e,t){var a=this.predicateOptions.filter(function(t){return t.name===e});t.args=a[0].args},addOrdinaryRoute:function(){var e=this;e.ordinaryVisible=!0;var t=e.currentNode.instance&&e.currentNode.instance.uri?e.currentNode.instance.uri:"lb://"+e.currentNode._name;e.addOrdinaryArr=[{strip_prefix:!0,hystrix_flag:!1,uri:t,uriAfter:""}],$(".contextmenu").hide()},ordinaryRouteClose:function(){var e=this;e.ordinaryVisible=!1,e.addOrdinaryArr.forEach(function(t,a){e.$refs.ordinaryForm[a].resetFields()})},addORdinaryData:function(){var e=this,t=e.currentNode.instance&&e.currentNode.instance.uri?e.currentNode.instance.uri:"lb://"+e.currentNode._name;e.addOrdinaryArr.push({strip_prefix:!0,hystrix_flag:!1,uri:t,uriAfter:""})},ordinaryRouteConfirm:function(){var e,t=this,a=this;new s.a(function(e){var i=!0;a.addOrdinaryArr.forEach(function(e,t){a.$refs.ordinaryForm[t].validate(function(e){e||(i=!1)})}),i&&(t.btnLoading=!0,a.addOrdinaryArr.forEach(function(e){e.uri="/"===e.uriAfter[0]?e.uri+e.uriAfter:e.uri+"/"+e.uriAfter,delete e.uriAfter}),e(a.addOrdinaryArr))}).then((e=o()(r.a.mark(function e(i){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.addClassicRoute(i);case 3:e.sent.code===p.d?(a.$message.success("添加普通路由成功"),a.ordinaryRouteClose(),a.resetCanvasData()):(t.btnLoading=!1,a.$message.error(error.message)),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),t.btnLoading=!1,a.$message.error(e.t0&&e.t0.data&&e.t0.data.message||"添加普通路由失败");case 11:case"end":return e.stop()}},e,t,[[0,7]])})),function(t){return e.apply(this,arguments)}))},deleteFilter:function(e,t,a){a&&1===e.length?this.$message.error("谓词至少添加一个"):e.splice(t,1)},addSeniorRoute:function(){this.serviceRoutes=[{id:"",uri:"",filterParam:[],predicateParam:[]}],this.routeOpen(),$(".contextmenu").hide()},apiManage:function(){if(this.instanceView.instanceId){var e=u()({},this.instanceView);this.$router.push({name:"mapping",query:{uri:e.uri},params:{id:e.instanceId}})}},deleteLimiter:function(e){var t=this,a=this;a.$confirm("是否删除限流"+e.id,"删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(o()(r.a.mark(function i(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.deleteLimiterData({serviceId:a.serviceId,instanceId:a.instanceId,limiterId:e.id});case 3:t.sent,"base"===e.type?a.limiterData.baseLimiter.splice(e.index,1):a.limiterData.tempLimiter.splice(e.index,1),a.$message.success("删除限流成功"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),a.$message.error(t.t0&&t.t0.data&&t.t0.data.message||"删除限流失败");case 11:case"end":return t.stop()}},i,t,[[0,8]])}))).catch(function(){})},statusChange:function(e){var t=this,a=this;a.$confirm("是否确定更改实例状态","状态",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(o()(r.a.mark(function i(){var s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.changeStatus({serviceId:a.instanceView.serviceId,instanceId:a.instanceView.instanceId,status:e});case 3:(s=t.sent).code===p.d?(a.serviceClose(),a.resetCanvasData()):a.$message.error(s.message||"更改实例状态失败"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a.$message.error(t.t0&&t.t0.data&&t.t0.data.message||"更改实例状态失败");case 10:case"end":return t.stop()}},i,t,[[0,7]])}))).catch(function(){})},balanceClose:function(){this.balanceVisible=!1},balanceConfirm:function(){var e=this;return o()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.btnLoading=!0,t.next=3,e.setServiceLoad(e.loadForm);case 3:(a=t.sent)&&a.code===p.d?e.$message.success("更新负载均衡策略成功"):e.$message.error("更新负载均衡策略失败"),e.btnLoading=!1,e.balanceClose();case 7:case"end":return t.stop()}},t,e)}))()},deleteInstance:function(){var e=this,t=this;t.$confirm("是否删除该实例","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(o()(r.a.mark(function a(){var i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.deleteInstanceData({serviceId:t.instanceView.serviceId,instanceId:t.instanceView.instanceId});case 2:(i=e.sent)&&i.code===p.d&&(t.$message.success("删除实例成功"),t.serviceClose(),t.resetCanvasData());case 4:case"end":return e.stop()}},a,e)}))).catch(function(){})},getFuse:function(){var e=this;this.getOptionsKey("hystrix").then(function(t){e.fuseOptions=t.data})},centerShow:function(){this.stage.centerAndZoom()},fullScreen:function(){this.commonFunc.runPrefixMethod(this.stage.canvas,"RequestFullScreen")},zoomOut:function(){this.stage.zoomOut()},zoomIn:function(){this.stage.zoomIn()},exportCanvas:function(){this.stage.saveImageInfo()},searchNode:function(){var e=this,t=this.searchNodeText,a=this.stage.childs[0].childs.filter(function(e){return e instanceof JTopo.Node});(a=a.filter(function(e){return null!=e.text&&-1!=e.text.indexOf(t)})).length>0&&a.forEach(function(t){t.selected=!0;var i=a[parseInt(a.length/2)].getCenterLocation();e.stage.setCenter(i.x,i.y),function e(t,a){if(0==a)return t.selected=!1,void(t.shadow=!1);t.shadow=!0,t.selected=!t.selected,setTimeout(function(){e(t,a-1)},500)}(t,8)})}})},N={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gateway",attrs:{id:"content"}},[a("div",{staticClass:"button-group"},[a("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"warning"},on:{click:function(t){e.fuseVisible=!0}}},[e._v("添加熔断")]),e._v(" "),a("el-button",{attrs:{size:"small",icon:"el-icon-edit",type:"warning"},on:{click:function(t){e.modifyFuseVisible=!0}}},[e._v("修改熔断")])],1),e._v(" "),a("div",{staticClass:"clearfix"},[a("span",{staticClass:"pull-left"},[a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.centerShow}},[e._v("居中显示")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.fullScreen}},[e._v("全屏显示")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.zoomOut}},[e._v("放大")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.zoomIn}},[e._v("缩小")])],1),e._v(" "),a("el-input",{staticClass:"ml-20",staticStyle:{width:"180px"},attrs:{id:"J_name",size:"small",placeholder:"服务或实例名称"},nativeOn:{keyup:function(t){return"button"in t||13===t.keyCode?e.searchNode(t):null}},model:{value:e.searchNodeText,callback:function(t){e.searchNodeText=t},expression:"searchNodeText"}}),e._v(" "),a("el-button",{staticClass:"ml-10",attrs:{id:"J_search",type:"warning",size:"small"},on:{click:e.searchNode}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.exportCanvas}},[e._v("导出PNG")])],1),e._v(" "),a("span",{staticClass:"pull-right"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.openBlack}},[e._v("黑白名单")]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新",placement:"top"}},[a("el-button",{staticClass:"icon-loading",attrs:{type:"primary",size:"small",loading:e.btnLoading,icon:"el-icon-refresh"},on:{click:function(t){e.btnLoading=!0,e.resetCanvasData()}}})],1)],1)]),e._v(" "),a("canvas",{ref:"myCanvas",staticClass:"my-canvas"}),e._v(" "),a("el-dialog",{attrs:{title:e.serviceTitle,visible:e.serviceVisible,width:"35%",center:""},on:{"update:visible":function(t){e.serviceVisible=t},close:e.serviceClose}},[a("el-form",{ref:"instanceView",attrs:{model:e.instanceView,"label-width":"80px",size:"small"}},[a("el-form-item",{attrs:{label:"服务名："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.appName,callback:function(t){e.$set(e.instanceView,"appName",t)},expression:"instanceView.appName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主机："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.host,callback:function(t){e.$set(e.instanceView,"host",t)},expression:"instanceView.host"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主机名："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.hostName,callback:function(t){e.$set(e.instanceView,"hostName",t)},expression:"instanceView.hostName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"端口："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.port,callback:function(t){e.$set(e.instanceView,"port",t)},expression:"instanceView.port"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"URI："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.uri,callback:function(t){e.$set(e.instanceView,"uri",t)},expression:"instanceView.uri"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态："}},[a("el-select",{attrs:{disabled:""},model:{value:e.instanceView.status,callback:function(t){e.$set(e.instanceView,"status",t)},expression:"instanceView.status"}},e._l(e.statusMap,function(e){return a("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),e._v(" "),a("el-dropdown",{staticClass:"ml-20",attrs:{trigger:"click"},on:{command:e.statusChange}},[a("el-button",{attrs:{type:"text",size:"mini"}},[e._v("\n            更改状态\n            "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"UP"}},[e._v("上线")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"OUT_OF_SERVICE"}},[e._v("停止")])],1)],1),e._v(" "),a("el-button",{staticClass:"ml-10",attrs:{type:"text",size:"mini"},on:{click:e.apiManage}},[e._v("接口管理")])],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["DOWN"===e.instanceView.status?a("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.deleteInstance}},[e._v("删除")]):e._e(),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.serviceClose}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.serviceRouteTitle,visible:e.serviceRouteVisible,top:"5vh",width:"50%",center:""},on:{"update:visible":function(t){e.serviceRouteVisible=t}}},[a("el-tabs",{attrs:{"tab-position":"top",type:"card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"路由信息",name:"router"}},[e._l(e.serviceRoutes,function(t,i){return a("el-form",{key:i,ref:"routeForm",refInFor:!0,staticClass:"route-box",attrs:{model:t,"label-width":"100px",size:"small"}},[a("el-form-item",{attrs:{label:"路由名称：",prop:"id",rules:{required:!0,message:"请输入路由名称",trigger:["blur","change"]}}},[a("el-input",{staticStyle:{width:"85%"},attrs:{disabled:t.order},model:{value:t.id,callback:function(a){e.$set(t,"id",a)},expression:"route.id"}}),e._v(" "),a("el-button",{staticClass:"pull-right",attrs:{type:"danger"},on:{click:function(a){e.deleteRoute(t.id,i)}}},[e._v("删除")])],1),e._v(" "),a("el-form-item",{attrs:{label:"URI：",prop:"uri",rules:{required:!0,message:"请输入URI",trigger:["blur","change"]}}},[a("el-input",{model:{value:t.uri,callback:function(a){e.$set(t,"uri",a)},expression:"route.uri"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"排序："}},[a("el-input",{attrs:{placeholder:"请输入大于等于零的正整数"},model:{value:t.order,callback:function(a){e.$set(t,"order",a)},expression:"route.order"}}),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* 路由执行顺序,越小的越靠前执行,")])],1),e._v(" "),a("el-collapse",{staticClass:"mb-20 ml-10",model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"过滤器",name:2*i}},[e._l(t.filterParam,function(i,s){return a("el-form-item",{key:s,attrs:{"label-width":"0"}},[a("el-select",{staticClass:"mb-15",on:{change:function(t){e.filterChange(t,i)}},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"filter.name"}},e._l(e.filterOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.comment,value:e.name}})})),e._v(" "),a("el-button",{staticClass:"btn-text-red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){e.deleteFilter(t.filterParam,s)}}},[e._v("删除")]),e._v(" "),e._l(i.args,function(t,i){return a("div",{key:i},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Key：","label-width":"60px"}},[a("el-input",{attrs:{disabled:""},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"arg.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Value：",prop:"filterParam."+s+".args."+i+".value","label-width":"60px",rules:{required:!0,message:"请输入Value",trigger:["blur","change"]}}},["select"!==t.type?a("el-input",{attrs:{placeholder:t.placeholder},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"arg.value"}}):a("el-select",{attrs:{placeholder:t.placeholder},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"arg.value"}},e._l(e.fuseOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(t.eg))])],1)],1)],1)],1)})],2)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:function(a){e.addFilter(t.filterParam)}}},[e._v("添加过滤器")])],1)],2),e._v(" "),a("el-collapse-item",{attrs:{title:"谓词",name:2*i+1}},[e._l(t.predicateParam,function(i,s){return a("el-form-item",{key:s,attrs:{"label-width":"0"}},[a("el-select",{staticClass:"mb-15",on:{change:function(t){e.predicateChange(t,i)}},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"predicate.name"}},e._l(e.predicateOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.comment,value:e.name}})})),e._v(" "),a("el-button",{staticClass:"btn-text-red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){e.deleteFilter(t.predicateParam,s,"predicate")}}},[e._v("删除")]),e._v(" "),e._l(i.args,function(t,i){return a("div",{key:i},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Key：","label-width":"60px"}},[a("el-input",{attrs:{disabled:""},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"arg.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Value：",prop:"predicateParam."+s+".args."+i+".value","label-width":"60px",rules:{required:!0,message:"请输入Value",trigger:["blur","change"]}}},["date"===t.type?a("el-date-picker",{attrs:{type:"datetime",placeholder:t.placeholder,"value-format":"timestamp","default-time":"12:00:00"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"arg.value"}}):a("el-input",{attrs:{placeholder:t.placeholder},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"arg.value"}}),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(t.eg))])],1)],1)],1)],1)})],2)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:function(a){e.addPredicate(t.predicateParam)}}},[e._v("添加谓词")])],1)],2)],1),e._v(" "),a("div",{staticClass:"text-left"},[t.limiter?a("el-button",{attrs:{type:"text",size:"small",icon:"fa fa-eye"},on:{click:e.viewLimiter}},[e._v("查看限流")]):e._e()],1)],1)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:e.addRoute}},[e._v("添加路由")])],1)],2),e._v(" "),e.serviceRoutes.length>0&&e.serviceRoutes[0].order?a("el-tab-pane",{attrs:{label:"限流信息",name:"limiter"}},[a("limiter",{ref:"limiter",attrs:{"limiter-data":e.limiterData},on:{deleteLimiter:e.deleteLimiter}})],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.routeConfirm}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{disabled:e.btnLoading,size:"small"},on:{click:e.routeClose}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"添加路由",visible:e.ordinaryVisible,width:"35%",center:""},on:{"update:visible":function(t){e.ordinaryVisible=t},close:e.ordinaryRouteClose}},[e._l(e.addOrdinaryArr,function(t,i){return a("el-form",{key:i,ref:"ordinaryForm",refInFor:!0,staticClass:"route-box",attrs:{model:t,size:"small","label-width":"126px"}},[a("el-form-item",{attrs:{label:"路由名称：",prop:"id",rules:{required:!0,message:"路由名称不能为空",trigger:"blur"}}},[a("el-input",{model:{value:t.id,callback:function(a){e.$set(t,"id",a)},expression:"route.id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"匹配路径：",prop:"path",rules:{required:!0,message:"路径不能为空",trigger:"blur"}}},[a("el-input",{model:{value:t.path,callback:function(a){e.$set(t,"path",a)},expression:"route.path"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"URI："}},[a("el-input",{staticStyle:{width:"60%"},attrs:{disabled:""},model:{value:t.uri,callback:function(a){e.$set(t,"uri",a)},expression:"route.uri"}}),e._v(" "),a("el-input",{staticStyle:{width:"38%"},model:{value:t.uriAfter,callback:function(a){e.$set(t,"uriAfter",a)},expression:"route.uriAfter"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否隐藏uri前缀："}},[a("el-switch",{model:{value:t.strip_prefix,callback:function(a){e.$set(t,"strip_prefix",a)},expression:"route.strip_prefix"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启用熔断："}},[a("el-switch",{model:{value:t.hystrix_flag,callback:function(a){e.$set(t,"hystrix_flag",a)},expression:"route.hystrix_flag"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"熔断降级uri："}},[a("el-input",{attrs:{disabled:!t.hystrix_flag},model:{value:t.fallback_uri,callback:function(a){e.$set(t,"fallback_uri",a)},expression:"route.fallback_uri"}})],1)],1)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:e.addORdinaryData}},[e._v("添加路由")])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.ordinaryRouteConfirm}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{disabled:e.btnLoading,size:"small"},on:{click:e.ordinaryRouteClose}},[e._v("取消")])],1)],2),e._v(" "),a("add-fuse",{attrs:{"btn-loading":e.btnLoading},on:{getFuse:e.getFuse}}),e._v(" "),a("modify-fuse",{attrs:{options:e.fuseOptions},on:{getFuse:e.getFuse}}),e._v(" "),a("el-dialog",{attrs:{title:e.serviceTitle,visible:e.balanceVisible,width:"30%",center:""},on:{"update:visible":function(t){e.balanceVisible=t},close:e.balanceClose}},[a("el-form",{ref:"loadForm",attrs:{model:e.loadForm,size:"small","label-width":"110px"}},[a("el-form-item",{attrs:{label:"服务名称："}},[a("el-input",{attrs:{disabled:""},model:{value:e.loadForm.service_name,callback:function(t){e.$set(e.loadForm,"service_name",t)},expression:"loadForm.service_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"负载均衡策略：",prop:"class_name"}},[a("el-select",{attrs:{placeholder:"请设置"},model:{value:e.loadForm.ribbon_class,callback:function(t){e.$set(e.loadForm,"ribbon_class",t)},expression:"loadForm.ribbon_class"}},e._l(e.loadBalancingOptions,function(e){return a("el-option",{key:e.ribbon_class,attrs:{label:e.ribbon_name,value:e.ribbon_class}})}))],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.balanceConfirm}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.balanceClose}},[e._v("取消")])],1)],1),e._v(" "),a("black-white",{ref:"black"}),e._v(" "),a("ul",{staticClass:"contextmenu"},[a("li",[a("a",{on:{click:e.addOrdinaryRoute}},[e._v("添加路由（普通模式）")])]),e._v(" "),a("li",[a("a",{on:{click:e.addSeniorRoute}},[e._v("添加路由（高级模式）")])])])],1)},staticRenderFns:[]};var z=a("VU/8")(O,N,!1,function(e){a("XH8P")},null,null);t.default=z.exports}});