webpackJsonp([3],{"0Bs/":function(e,t){},CMRi:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("mvHQ"),i=o.n(n),a=o("hi7O"),r=o("Xxa5"),l=o.n(r),s=o("gRE1"),d=o.n(s),c=o("exGp"),u=o.n(c),p=o("DzCA"),f={props:{node:Object}},h={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",{attrs:{id:"view-section"}},[o("span",{staticClass:"view"},[e._v("JOB_ID： ")]),e._v(e._s(e.node.JOB_ID)),o("br"),e._v(" "),o("span",{staticClass:"view"},[e._v("JOB NAME(*)： ")]),e._v(e._s(e.node.JOB_NAME||"")+"\n")])},staticRenderFns:[]};var m=o("VU/8")(f,h,!1,function(e){o("JhtQ")},null,null).exports,g={mixins:[p.a],data:function(){return{minHeight:document.documentElement.clientHeight-190,mouseX:"",mouseY:"",currentNode:"",clickTimeId:null,stage:null,jobId:"",tenantId:"",chartForm:"",lineOptions:[{name:"直线",type:"line",direction:""},{name:"折线(横)",type:"foldLine",direction:"horizontal"},{name:"折线(纵)",type:"foldLine",direction:"vertical"},{name:"二次折线(横)",type:"flexLine",direction:"horizontal"},{name:"二次折线(纵)",type:"flexLine",direction:"vertical"},{name:"曲线",type:"curveLine",direction:""}],lineSelect:"line-0",loadCanvas:!0}},props:{jobData:Object},components:{viewSection:m},mounted:function(){var e=this;return u()(l.a.mark(function t(){var o,n,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=void 0,!e.$route.query.jobGroupId){t.next=7;break}return t.next=4,e.getJobGroupData();case 4:o=t.sent,t.next=10;break;case 7:return t.next=9,e.getData();case 9:o=t.sent;case 10:e.loadCanvas=!1,n=d()(o.nodes),i=d()(o.lines),e.initTopology(n,i),e.$nextTick(function(){a.a.nodeMenu=$("#node-menu"),a.a.lineMenu=$("#line-menu"),a.a.mainMenu=$("#main-menu"),a.a.groupMangeMenu=$("#group-mange-menu"),a.a.groupAlignMenu=$("#group-align-menu"),a.a.alignGroup=$("#align-group"),a.a.initMenus(),e.bindEvents()});case 15:case"end":return t.stop()}},t,e)}))()},methods:{selectLineHandler:function(e){this.lineSelect="line-"+e,a.a.lineType=this.lineOptions[e].type,a.a.config.linkDirection=this.lineOptions[e].direction},headerAction:function(e){switch(e){case"fullScreen":a.a.utils.showInFullScreen(a.a.stage.canvas,"RequestFullScreen");break;case"center":a.a.utils.showInCenter();break;case"show":a.a.utils.showPic();break;case"clone":a.a.utils.cloneSelectedNodes();break;case"clear":a.a.utils.clearTopology();break;case"big":a.a.utils.scalingBig();break;case"small":a.a.utils.scalingSmall()}},setDrag:function(){for(var e=document.getElementsByClassName("draggable-node"),t=e.length,o=0;o<t;o++){var n=e[o].textContent;a.a.drag(e[o],document.getElementById("define-canvas"),n)}},getData:function(){return this.$axios({method:"post",url:"/batch/showNodesAndLines",params:{batchClass:this.$route.query.batchClass,appGroup:this.$route.query.appGroup,zkUrl:this.$route.query.zkUrl}}).then(function(e){return e.body})},getJobGroupData:function(){return this.$axios({method:"post",url:"/batch/showJobGroup",params:{batchClass:this.$route.query.batchClass,appGroup:this.$route.query.appGroup,jobGroupId:this.$route.query.jobGroupId,zkUrl:this.$route.query.zkUrl}}).then(function(e){return e.body})},delLineHandler:function(){var e=a.a.currentLink,t=e.nodeA,o=e.nodeZ,n={PREDECESSOR:t.JOB_ID,DESCENDENT:o.JOB_ID,DEPENDENCY_TYPE:"P"};this.$axios({method:"post",url:"/batch/deleteLine",params:{lineJson:i()(n),appGroup:this.$route.query.appGroup,zkUrl:this.$route.query.zkUrl}}).then(function(e){})},delNodeHandler:function(){var e=this,t={OLD_JOB_ID:a.a.currentNode.JOB_ID};this.$axios({method:"post",url:"/batch/deleteJob",params:{jobJson:i()(t),appGroup:this.$route.query.appGroup,zkUrl:this.$route.query.zkUrl}}).then(function(t){"S"===t.retStatus&&e.$message.success("更新成功")})},openDialog:function(e){this.$emit("openInfoDialog",e)},paintJobGroup:function(){var e=a.a.currentNode,t=e.nodeType,o=e.JOB_ID;if("GP"!==t)return this.$message.warning("该节点无法绘制子流程"),!1;var n=this.$route.query,i=n.batchClass,r=n.eodSod,l=n.batchDesc,s=n.zkUrl,d=n.appGroup,c=n.envId,u={batchClass:i,eodSod:r,batchDesc:l,zkUrl:s||"",appGroup:d||"",envId:c||"",jobGroupId:o};this.$router.push({name:"batchJob",params:{id:i},query:u})},bindEvents:function(){var e=this;a.a.utils.setNodeCreateListener=function(){e.openDialog("add")},a.a.scene.mouseover(function(t){e.$refs.viewer.style.display="none",clearTimeout(e.clickTimeId),null!=t.target&&t.target instanceof JTopo.Node&&(e.clickTimeId=setTimeout(function(){e.currentNode=t.target,e.$refs.viewer.style.display="block",e.$refs.viewer.style.left=t.clientX+10+"px",e.$refs.viewer.style.top=t.clientY+10+"px"},2e3))}),a.a.scene.mouseout(function(t){e.$refs.viewer.style.display="none",clearTimeout(e.clickTimeId),e.clickTimeId=null}),a.a.scene.mouseup(function(t){if(null!=t.target&&t.target instanceof JTopo.Node)if(e.mouseX===t.target.cx&&e.mouseY===t.target.cy)clearTimeout(e.clickTimeId),e.clickTimeId=null;else{clearTimeout(e.clickTimeId),e.clickTimeId=null;var o=t.target,n=o.JOB_ID,i=o.x,r=o.y,l=o.width,s=o.height;e.saveMovedJob(n,i,r,l,s)}null!==a.a.newLink&&e.saveLine(a.a.newLink)}),a.a.scene.mousedown(function(t){null!=t.target&&t.target instanceof JTopo.Node&&(e.mouseX=t.target.cx,e.mouseY=t.target.cy)})},saveLine:function(e){var t=this,o=e.nodeA,n=e.nodeZ,a=e.lineType,r=e.direction,l=void 0;"line"===a&&(l="sl"),"foldLine"===a&&(l="horizontal"===r?"foh":"fov"),"flexLine"===a&&(l="horizontal"===r?"flh":"flv"),"curveLine"===a&&(l="cu");var s={PREDECESSOR:o.JOB_ID,DESCENDENT:n.JOB_ID,LINE_TYPE:l,DEPENDENCY_TYPE:"P"};this.$axios({method:"post",url:"batch/saveLine",params:{lineJson:i()(s),appGroup:this.$route.query.appGroup,zkUrl:this.$route.query.zkUrl}}).then(function(e){"S"===e.retStatus&&t.$message.success("更新成功")})},saveMovedJob:function(e,t,o,n,a){var r=this;this.$axios({method:"post",url:"/batch/getJob",params:{JOB_ID:e,appGroup:this.$route.query.appGroup,zkUrl:this.$route.query.zkUrl}}).then(function(l){l.OLD_JOB_ID=e,l.LEFT_POS=t,l.TOP_POS=o,l.WIDTH=n,l.HEIGHT=a,r.$axios({method:"post",url:"batch/saveJob",params:{jobJson:i()(l),appGroup:r.$route.query.appGroup,zkUrl:r.$route.query.zkUrl}}).then(function(e){})})}},beforeDestroy:function(){a.a.stage.clear()}},v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadCanvas,expression:"loadCanvas"}],style:"min-height:"+e.minHeight+"px",attrs:{id:"content"}},[o("el-row",{staticStyle:{"font-size":"14px",float:"left"}},[o("span",{staticClass:"bacth-title",staticStyle:{color:"#a7a7a7"}},[e._v("批处理： ")]),e._v(e._s(e.$route.query.batchClass)+"\n      "),o("span",{staticClass:"bacth-title",staticStyle:{color:"#a7a7a7","margin-left":"8px"}},[e._v("EOS/SOD： ")]),e._v(e._s(e.$route.query.eodSod)+"\n      "),o("span",{staticClass:"bacth-title",staticStyle:{color:"#a7a7a7","margin-left":"8px"}},[e._v("批处理描述： ")]),e._v(e._s(e.$route.query.batchDesc)+"\n    ")]),e._v(" "),o("div",{staticStyle:{float:"right","margin-right":"-50px"}},[o("el-dropdown",{staticStyle:{"margin-right":"20px"},on:{command:e.selectLineHandler}},[o("div",{staticClass:"line-logo",class:e.lineSelect}),e._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.lineOptions,function(t,n){return o("el-dropdown-item",{key:n,attrs:{command:n}},[o("div",{staticClass:"line-logo",class:"line-"+n}),e._v(e._s(t.name)+"\n          ")])}))],1),e._v(" "),o("i",{staticClass:"fa fa-arrows toolbar-icon",attrs:{"aria-hidden":"true",title:"全屏查看"},on:{click:function(t){e.headerAction("fullScreen")}}}),e._v(" "),o("i",{staticClass:"fa fa-align-center toolbar-icon",attrs:{"aria-hidden":"true",title:"居中显示"},on:{click:function(t){e.headerAction("center")}}}),e._v(" "),o("i",{staticClass:"fa fa-eye toolbar-icon",attrs:{"aria-hidden":"true",title:"预览"},on:{click:function(t){e.headerAction("show")}}}),e._v(" "),o("i",{staticClass:"fa fa-search-plus toolbar-icon",attrs:{"aria-hidden":"true",title:"放大"},on:{click:function(t){e.headerAction("big")}}}),e._v(" "),o("i",{staticClass:"fa fa-search-minus toolbar-icon",attrs:{"aria-hidden":"true",title:"缩小"},on:{click:function(t){e.headerAction("small")}}})],1),e._v(" "),o("div",{staticClass:"topology-context",attrs:{id:"topology-body"}},[o("div",{staticClass:"right-click-menu",staticStyle:{"z-index":"9"},attrs:{id:"node-menu"}},[o("div",{staticClass:"fa fa-edit menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:function(t){e.openDialog("edit")}}},[o("span",[e._v("信息修改")])]),e._v(" "),o("div",{staticClass:"fa fa-paint-brush menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:e.paintJobGroup}},[o("span",[e._v("绘制流程")])]),e._v(" "),o("div",{staticClass:"fa fa-close menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:e.delNodeHandler}},[o("span",[e._v("删除节点")])])]),e._v(" "),o("div",{staticClass:"right-click-menu",staticStyle:{"z-index":"9"},attrs:{id:"line-menu"}},[o("div",{staticClass:"fa fa-times menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:e.delLineHandler}},[o("span",[e._v("删除连线")])])]),e._v(" "),o("div",{staticClass:"right-click-menu",staticStyle:{"z-index":"9"},attrs:{id:"main-menu"}},[o("div",{staticClass:"fa fa-search-plus menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:function(t){e.headerAction("big")}}},[o("span",[e._v("放大(Shift+)")])]),e._v(" "),o("div",{staticClass:"fa fa-search-minus menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:function(t){e.headerAction("small")}}},[o("span",[e._v("缩小(Shift-)")])]),e._v(" "),o("div",{staticClass:"fa fa-trash-o menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:function(t){e.headerAction("clear")}}},[o("span",[e._v("清空(Shift+Y)")])]),e._v(" "),o("div",{staticClass:"fa fa-align-center menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:function(t){e.headerAction("center")}}},[o("span",[e._v("居中(Shift+G)")])]),e._v(" "),o("div",{staticClass:"fa fa-eye menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:function(t){e.headerAction("show")}}},[o("span",[e._v("预览")])]),e._v(" "),o("div",{staticClass:"fa fa-arrows menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"},on:{click:function(t){e.headerAction("fullScreen")}}},[o("span",[e._v("全屏查看")])])]),e._v(" "),e._m(0)]),e._v(" "),o("canvas",{ref:e.id,staticClass:"job-step-canvas",attrs:{id:"define-canvas"}}),e._v(" "),o("div",{ref:"viewer",staticStyle:{display:"none",position:"fixed"}},[o("view-section",{attrs:{node:e.currentNode}})],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"right-click-menu",staticStyle:{"z-index":"9"},attrs:{id:"group-mange-menu"}},[t("div",{staticClass:"menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"}},[t("span",[this._v("水平对齐")])]),this._v(" "),t("div",{staticClass:"menu-item",attrs:{onMouseMove:"this.style.backgroundColor='#c5e7f6'",onMouseOut:"this.style.backgroundColor=''"}},[t("span",[this._v("垂直对齐")])])])}]};var N=o("VU/8")(g,v,!1,function(e){o("Mf+Q")},null,null).exports,_=o("woOf"),y=o.n(_),k={data:function(){return{addForm:{OLD_JOB_ID:"",JOB_ID:"",JOB_NAME:"",JOB_TYPE:"GX",MODULE_ID:"",SYSTEM_ID:"",JOB_DESC:"",DAY_END:"Y",WEEK_END:"Y",MTH_END:"Y",YR_END:"Y",IS_SKIP:"N",GX_CLASS_NAME:"",GX_METHOD:"",STATIC_PARAM:"",IS_SPLIT:"N",BY_SCHEMA:"N",STATUS:"Y",BATCH_SIZE:"",SPLIT_CLASS:"",SPLIT_TYPE:"",SPLIT_CNT:"",MAX_PER_SPLIT:"",NAMESPACE:"",SQL_ID:"",FILE_PATH:"",FILE_NAME:"",FILE_FORMAT:"",FILE_ROW_NAME:"",SHARD_MANAGER_ID:"",DTP_FLAG:"N",TOP_POS:"",LEFT_POS:"",WIDTH:"",HEIGHT:"",BATCH_CLASS:"",BATCH_DESC:""},isGroup:!1}},props:{nodeInfo:String},created:function(){var e=this;return u()(l.a.mark(function t(){var o,n,i,r,s,d,c;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=a.a.currentNode,n=o.x,i=o.y,r=o.width,s=o.height,d=o.JOB_ID,"GP"===o.nodeType?(e.isGroup=!0,e.addForm.JOB_TYPE="GP",e.addForm.MODULE_ID="GP",e.addForm.SYSTEM_ID="GP"):e.isGroup=!1,t.next=4,e.init(d);case 4:c=t.sent,e.addForm=y()(e.addForm,c),e.addForm.OLD_JOB_ID=d,e.addForm.TOP_POS=i,e.addForm.LEFT_POS=n,e.addForm.WIDTH=r,e.addForm.HEIGHT=s,e.addForm.BATCH_CLASS=e.$route.query.batchClass,e.addForm.BATCH_DESC=e.$route.query.batchDesc,e.addForm.JOB_GROUP_ID=e.$route.query.jobGroupId;case 14:case"end":return t.stop()}},t,e)}))()},methods:{init:function(e){return this.$axios({method:"post",url:"/batch/getJob",params:{JOB_ID:e,appGroup:this.$route.query.appGroup,zkUrl:this.$route.query.zkUrl}}).then(function(e){return e})}}},b={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-form",{ref:"centerForm",attrs:{rules:e.rules,model:e.addForm,"status-icon":"","label-width":"120px",size:"small"}},[e.isGroup?e._e():o("el-row",{staticStyle:{height:"400px","overflow-y":"auto"}},[o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"JOB ID(*)",prop:"JOB_ID"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.JOB_ID,callback:function(t){e.$set(e.addForm,"JOB_ID",t)},expression:"addForm.JOB_ID"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"静态参数",prop:"STATIC_PARAM"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.STATIC_PARAM,callback:function(t){e.$set(e.addForm,"STATIC_PARAM",t)},expression:"addForm.STATIC_PARAM"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"JOB 描述",prop:"JOB_DESC"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.JOB_DESC,callback:function(t){e.$set(e.addForm,"JOB_DESC",t)},expression:"addForm.JOB_DESC"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"SYSTEM ID(*)",prop:"SYSTEM_ID"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.SYSTEM_ID,callback:function(t){e.$set(e.addForm,"SYSTEM_ID",t)},expression:"addForm.SYSTEM_ID"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"ShardManger",prop:"SHARD_MANAGER_ID"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.SHARD_MANAGER_ID,callback:function(t){e.$set(e.addForm,"SHARD_MANAGER_ID",t)},expression:"addForm.SHARD_MANAGER_ID"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"方法名(*)",prop:"GX_METHOD"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.GX_METHOD,callback:function(t){e.$set(e.addForm,"GX_METHOD",t)},expression:"addForm.GX_METHOD"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"周末跑",prop:"WEEK_END"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.WEEK_END,callback:function(t){e.$set(e.addForm,"WEEK_END",t)},expression:"addForm.WEEK_END"}},[o("el-option",{attrs:{label:"是",value:"Y"}}),e._v(" "),o("el-option",{attrs:{label:"否",value:"N"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"年末跑",prop:"YR_END"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.YR_END,callback:function(t){e.$set(e.addForm,"YR_END",t)},expression:"addForm.YR_END"}},[o("el-option",{attrs:{label:"是",value:"Y"}}),e._v(" "),o("el-option",{attrs:{label:"否",value:"N"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"是否分库执行",prop:"BY_SCHEMA"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.BY_SCHEMA,callback:function(t){e.$set(e.addForm,"BY_SCHEMA",t)},expression:"addForm.BY_SCHEMA"}},[o("el-option",{attrs:{label:"是",value:"Y"}}),e._v(" "),o("el-option",{attrs:{label:"否",value:"N"}}),e._v(" "),o("el-option",{attrs:{label:"所有",value:"A"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"是否可用",prop:"STATUS"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.STATUS,callback:function(t){e.$set(e.addForm,"STATUS",t)},expression:"addForm.STATUS"}},[o("el-option",{attrs:{label:"是",value:"Y"}}),e._v(" "),o("el-option",{attrs:{label:"否",value:"N"}})],1)],1)],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-form-item",{attrs:{label:"JOB NAME(*)",prop:"JOB_NAME"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.JOB_NAME,callback:function(t){e.$set(e.addForm,"JOB_NAME",t)},expression:"addForm.JOB_NAME"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"JOB 类型(*)",prop:"JOB_TYPE"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.JOB_TYPE,callback:function(t){e.$set(e.addForm,"JOB_TYPE",t)},expression:"addForm.JOB_TYPE"}},[o("el-option",{attrs:{label:"Galaxy JOB",value:"GX"}}),e._v(" "),o("el-option",{attrs:{label:"mr JOB",value:"MR"}}),e._v(" "),o("el-option",{attrs:{label:"hbase JOB",value:"HB"}}),e._v(" "),o("el-option",{attrs:{label:"sqoop JOB",value:"DX"}}),e._v(" "),o("el-option",{attrs:{label:"导入数据 JOB",value:"IM"}}),e._v(" "),o("el-option",{attrs:{label:"导出数据 JOB",value:"EX"}}),e._v(" "),o("el-option",{attrs:{label:"导入参数数据 JOB",value:"PI"}}),e._v(" "),o("el-option",{attrs:{label:"导出参数数据 JOB",value:"PM"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"MODULE ID(*)",prop:"MODULE_ID"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.MODULE_ID,callback:function(t){e.$set(e.addForm,"MODULE_ID",t)},expression:"addForm.MODULE_ID"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"类名(*)",prop:"GX_CLASS_NAME"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.GX_CLASS_NAME,callback:function(t){e.$set(e.addForm,"GX_CLASS_NAME",t)},expression:"addForm.GX_CLASS_NAME"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"批量提交数量",prop:"BATCH_SIZE"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.BATCH_SIZE,callback:function(t){e.$set(e.addForm,"BATCH_SIZE",t)},expression:"addForm.BATCH_SIZE"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"日末跑",prop:"DAY_END"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.DAY_END,callback:function(t){e.$set(e.addForm,"DAY_END",t)},expression:"addForm.DAY_END"}},[o("el-option",{attrs:{label:"是",value:"Y"}}),e._v(" "),o("el-option",{attrs:{label:"否",value:"N"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"月末跑",prop:"MTH_END"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.MTH_END,callback:function(t){e.$set(e.addForm,"MTH_END",t)},expression:"addForm.MTH_END"}},[o("el-option",{attrs:{label:"是",value:"Y"}}),e._v(" "),o("el-option",{attrs:{label:"否",value:"N"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"出错能否跳过",prop:"IS_SKIP"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.IS_SKIP,callback:function(t){e.$set(e.addForm,"IS_SKIP",t)},expression:"addForm.IS_SKIP"}},[o("el-option",{attrs:{label:"不能",value:"N"}}),e._v(" "),o("el-option",{attrs:{label:"自动跳过",value:"A"}}),e._v(" "),o("el-option",{attrs:{label:"手动跳过",value:"M"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"是否分段",prop:"IS_SPLIT"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.IS_SPLIT,callback:function(t){e.$set(e.addForm,"IS_SPLIT",t)},expression:"addForm.IS_SPLIT"}},[o("el-option",{attrs:{label:"是",value:"Y"}}),e._v(" "),o("el-option",{attrs:{label:"否",value:"N"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"是否开启DTP",prop:"DTP_FLAG"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.addForm.DTP_FLAG,callback:function(t){e.$set(e.addForm,"DTP_FLAG",t)},expression:"addForm.DTP_FLAG"}},[o("el-option",{attrs:{label:"是",value:"Y"}}),e._v(" "),o("el-option",{attrs:{label:"否",value:"N"}})],1)],1)],1)],1),e._v(" "),e.isGroup?o("el-row",[o("el-form-item",{attrs:{label:"JOB ID(*)",prop:"JOB_ID"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.JOB_ID,callback:function(t){e.$set(e.addForm,"JOB_ID",t)},expression:"addForm.JOB_ID"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"JOB NAME(*)",prop:"JOB_NAME"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.JOB_NAME,callback:function(t){e.$set(e.addForm,"JOB_NAME",t)},expression:"addForm.JOB_NAME"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"静态参数",prop:"STATIC_PARAM"}},[o("el-input",{attrs:{type:"text"},model:{value:e.addForm.STATIC_PARAM,callback:function(t){e.$set(e.addForm,"STATIC_PARAM",t)},expression:"addForm.STATIC_PARAM"}})],1)],1):e._e()],1)},staticRenderFns:[]},S=o("VU/8")(k,b,!1,null,null,null).exports,T={data:function(){return{treeData:[{label:"J",img:"unknow.png",name:"Job"},{label:"GP",img:"unknow-cite.png",name:"Job组"}],loadCanvas:!1,addDialogShow:!1,nodeInfo:"",addTitle:"添加"}},props:{data:Object},components:{flowCanvas:N,addForm:S},mounted:function(){var e=this;this.$route.query.jobGroupId&&(this.treeData=this.treeData.slice(0,-1)),setTimeout(function(){e.$refs.defineCanvas.setDrag()},500)},methods:{handleConfirm:function(){var e=this,t=this.$refs.addForm.addForm.JOB_ID,o=i()(this.$refs.addForm.addForm);this.$axios({method:"post",url:"batch/saveJob",params:{jobJson:o,appGroup:this.$route.query.appGroup,zkUrl:this.$route.query.zkUrl,envId:""}}).then(function(o){if("S"===o.retStatus){var n=a.a.currentNode;n.text=t,n.JOB_ID=t,n.info=e.$refs.addForm.addForm,e.addDialogShow=!1,e.$message.success("更新成功")}})},openDialog:function(e){this.addTitle="edit"===e?"修改":"添加",this.nodeInfo=a.a.currentNode,this.addDialogShow=!0},closeDialog:function(){"添加"===this.addTitle&&a.a.utils.deleteNode(a.a.currentNode),this.addDialogShow=!1}}},M={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("section",[o("el-row",{attrs:{id:"flow-tree"}},[o("el-col",{attrs:{span:1}},[o("ul",{staticStyle:{"margin-top":"8px","padding-right":"10px"}},e._l(e.treeData,function(t){return o("li",{key:t.id,staticStyle:{cursor:"pointer","text-align":"center"}},[o("div",{staticClass:"draggable-node",attrs:{"node-type":t.label,draggable:"true",align:"center"}},[o("img",{attrs:{src:"/static/images/batchRun/"+t.img}})]),e._v(" "),o("div",[e._v(e._s(t.name))])])}))]),e._v(" "),o("el-col",{attrs:{span:23}},[o("flow-canvas",{ref:"defineCanvas",attrs:{jobData:e.data},on:{openInfoDialog:e.openDialog}})],1)],1),e._v(" "),o("el-dialog",{attrs:{"before-close":e.closeDialog,visible:e.addDialogShow,title:e.addTitle,center:"",width:"60%"},on:{"update:visible":function(t){e.addDialogShow=t}}},[e.addDialogShow?o("add-form",{ref:"addForm",attrs:{"node-info":e.nodeInfo}}):e._e(),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small",type:"warning"},on:{click:e.handleConfirm}},[e._v("保存")]),e._v(" "),o("el-button",{attrs:{size:"small"},on:{click:e.closeDialog}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var w=o("VU/8")(T,M,!1,function(e){o("0Bs/")},null,null);t.default=w.exports},DzCA:function(e,t,o){"use strict";o.d(t,"a",function(){return c});var n=o("pFYg"),i=o.n(n),a=o("BO1k"),r=o.n(a),l=o("woOf"),s=o.n(l),d=o("hi7O"),c={data:function(){return{wholeConfig:{drag:!1,nodeWidth:250,nodeHeight:40,nodeFont:"13px 微软雅黑"},defaultScene:{version:"0.4.8",frames:500,wheelZoom:.95,childs:[{elementType:"scene",backgroundColor:"255,255,255",mode:"edit",paintAll:!1,areaSelect:!0,translate:!0,translateX:0,translateY:0,lastTranslatedX:"undefined",lastTranslatedY:"undefined",alpha:0,visible:!0,scaleX:1,scaleY:1,childs:[]}]},defaultNode:{elementType:"node",visible:!0,alpha:1,rotate:0,scaleX:1,scaleY:1,strokeColor:"22,124,255",fillColor:"22,124,255",shadow:!1,shadowColor:"rgba(0,0,0,0.5)",shadowOffsetX:3,shadowOffsetY:6,transformAble:!0,zIndex:3,dragable:!0,selected:!1,showSelected:!0,isMouseOver:!1,font:"12px Consolas",fontColor:"black",textPosition:"Middle_Center",textOffsetX:0,textOffsetY:-2,borderRadius:null}}},methods:{initTopology:function(e,t){var o=this;if(e.forEach(function(e){var t=s()({},o.defaultNode);t.JOB_ID=e.JOB_ID,t.nodeType=e.JOB_TYPE,t.JOB_NAME=e.JOB_NAME,t._id=e.JOB_ID,t.y=e.top,t.x=e.left,t.width=e.width,t.height=e.height,t.text=e.JOB_ID,t.info=e,o.defaultScene.childs[0].childs.push(t)}),e){d.a.loadTopology(this.defaultScene,1,t);var n={};d.a.scene.childs.filter(function(e){return e instanceof JTopo.Node}).forEach(function(e){var t="GP"===e.nodeType?"/static/images/batchRun/init-group.png":"/static/images/batchRun/init.png";e.setImage(t),n[e._id]=e});var i=!0,a=!1,l=void 0;try{for(var c,u=r()(t);!(i=(c=u.next()).done);i=!0){var p=c.value,f=void 0;"sl"===p.type?(f=new JTopo.Link(n[p.from],n[p.to])).type="line":"foh"===p.type||"fov"===p.type?((f=new JTopo.FoldLink(n[p.from],n[p.to])).lineType="foldLine",f.direction="foh"===p.type?"horizontal":"vertiacl"):"flh"===p.type||"flv"===p.type?((f=new JTopo.FlexionalLink(n[p.from],n[p.to])).lineType="flexLine",f.direction="flh"===p.type?"horizontal":"vertiacl"):"cu"===p.type?(f=new JTopo.CurveLink(n[p.from],n[p.to])).lineType="curveLine":"lr"===p.type&&((f=new JTopo.FlexionalLink(n[p.from],n[p.to])).lineType="flexLine",f.direction="horizontal",f.offsetGap=(Math.abs(n[p.from].x-n[p.to].x)-n[p.from].width)/2),f.arrowsRadius=5,f._id=p.lineId,d.a.scene.add(f)}}catch(e){a=!0,l=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw l}}}else d.a.loadTopology()},setCanvasSize:function(){var e=this.$refs[this.domId];e.width="canvas-wrapper"===this.domId?document.getElementById("content").offsetWidth:.82*document.documentElement.clientWidth,e.height="canvas-wrapper"===this.domId?document.documentElement.clientHeight-255:document.documentElement.clientHeight-260},centerShow:function(){this.stage.centerAndZoom()},fullScreen:function(){this.runPrefixMethod(this.stage.canvas,"RequestFullScreen")},runPrefixMethod:function(e,t){var o=null;["webkit","moz","ms","o",""].forEach(function(n){if(!o){""===n&&(t=t.slice(0,1).toLowerCase()+t.slice(1));var a=i()(e[n+t]);a+""!="undefined"&&(o="function"===a?e[n+t]():e[n+t])}})},zoomOut:function(){this.stage.zoomOut()},zoomIn:function(){this.stage.zoomIn()},exportCanvas:function(){this.stage.saveImageInfo()},searchNode:function(){var e=this.searchNodeText,t=this.stage.childs[0].childs.filter(function(e){return e instanceof JTopo.Node});if((t=t.filter(function(t){return void 0!==t.stepinfo&&void 0!==t.stepinfo.name&&-1!=t.stepinfo.name.indexOf(e)})).length>0){var o=t[0];o.selected=!0;!function e(t,o){0!=o?(t.selected=!t.selected,setTimeout(function(){e(t,o-1)},300)):t.selected=!1}(o,10)}}}}},JhtQ:function(e,t){},"Mf+Q":function(e,t){},TmV0:function(e,t,o){o("fZOM"),e.exports=o("FeBl").Object.values},fZOM:function(e,t,o){var n=o("kM2E"),i=o("mbce")(!1);n(n.S,"Object",{values:function(e){return i(e)}})},gRE1:function(e,t,o){e.exports={default:o("TmV0"),__esModule:!0}},hi7O:function(e,t,o){"use strict";var n=o("pFYg"),i=o.n(n);function a(){}function r(){this.config={stageFrames:500,defaultScal:.95,eagleEyeVsibleDefault:!1,nodeAlpha:1,nodeStrokeColor:"22,124,255",nodeFillColor:"22,124,255",nodeShadow:!1,nodeShadowColor:"rgba(0,0,0,0.5)",nodeFont:"12px Consolas",nodeFontColor:"black",nodeDefaultWidth:125,nodeDefaultHeight:20,nodeBorderColor:"black",nodeBorderRadius:30,nodeRotateValue:.5,nodeScale:.2,linkAlpha:1,linkStrokeColor:"22,124,255",linkFillColor:"22,124,255",linkShadow:!1,linkShadowColor:"rgba(0,0,0,0.5)",linkFont:"12px Consolas",linkFontColor:"black",linkArrowsRadius:8,linkDefaultWidth:2,linkOffsetGap:40,linkDirection:"horizontal",containerAlpha:1,containerStrokeColor:"22,124,255",containerFillColor:"22,124,255",containerShadow:!1,containerShadowColor:"rgba(0,0,0,0.5)",containerFont:"12px Consolas",containerFontColor:"black",containerBorderColor:"black",containerBorderRadius:30},this.layout={},this.stage=null,this.scene=null,this.stageMode="normal",this.lineType="line",this.currentNode=null,this.currentLink=null,this.nodeMenu=$("#node-menu"),this.lineMenu=$("#line-menu"),this.mainMenu=$("#main-menu"),this.layoutMenu=$("#layout-menu"),this.nodeTextPosMenu=$("#node-text-pos-menu"),this.groupMangeMenu=$("#group-mange-menu"),this.groupAlignMenu=$("#group-align-menu"),this.alignGroup=$("#align-group"),this.containerMangeMenu=$("#container-mange-menu"),this.clickNode=null,a.call(this)}a.prototype.saveTopology=function(e){l.mainMenu.hide();for(var t=l.utils.getContainers(),o=0;o<t.length;o++){for(var n=[],i=t[o].childs,a=0;a<i.length;a++)i[a]instanceof JTopo.Node&&n.push(i[a].nodeId);t[o].childNodes=n.join(",")}this.scene=l.scene;var r=this.scene.childs.filter(function(e){return e instanceof JTopo.Node}),s=this.scene.childs.filter(function(e){return e instanceof JTopo.Link});return{steps:r.map(function(e){return{stepId:e.stepId,appId:e.appId,nodePosType:e.nodeType,nodeId:e._id,topPos:e.y.toFixed(1),leftPos:e.x.toFixed(1),width:e.width.toFixed(1),height:e.height.toFixed(1)}}),lines:s.map(function(e){return{lineId:e._id,fromNodeId:e.nodeA._id,toNodeId:e.nodeZ._id}})}},a.prototype.resetTopology=function(e){l.stageMode="edit",this.replaceStage(e)},a.prototype.loadTopology=function(e,t,o,n){if(t){var i=e;l.init(t,n,i,"",o)}else{l.init(t,n,"-1","",o)}},a.prototype.loadTopologyByJson=function(e,t){try{JTopo.replaceStageWithJson(e),l.stage&&l.scene&&l.scene.childs&&l.scene.childs.length>0&&l.stage.centerAndZoom()}catch(e){JTopo.replaceStageWithJson({version:"0.4.8",wheelZoom:.95,width:972,height:569,id:"ST172.19.105.52015100809430700001",childs:[{elementType:"scene",id:"S172.19.105.52015100809430700002",translateX:-121.82,translateY:306.72,scaleX:1.26,scaleY:1.26,childs:[]}]}),l.stage&&l.scene&&l.scene.childs&&l.scene.childs.length>0&&l.stage.centerAndZoom()}},a.prototype.deleteAllNodes=function(){l.stage.childs.forEach(function(e){e.clear()}),l.beginNode=null,l.link=null},r.prototype=new a,r.prototype.initMenus=function(){var e=this;e.nodeMenu.on("click",function(t){var o=$.trim($(t.target).text());switch("删除节点"===o?l.utils.deleteSelectedNodes():"复制节点(Shift+C)"===o?e.utils.cloneSelectedNodes():"撤销(Shift+Z)"===o?e.utils.cancleNodeAction():"重做(Shift+R)"===o?e.utils.reMakeNodeAction():l.utils.saveNodeInitState(),o){case"放大(Shift+)":e.utils.scalingBig(),e.utils.saveNodeNewState();break;case"缩小(Shift-)":e.utils.scalingSmall(),e.utils.saveNodeNewState();break;case"顺时针旋转(Shift+U)":e.utils.rotateAdd(),e.utils.saveNodeNewState();break;case"逆时针旋转(Shift+I)":e.utils.rotateSub(),e.utils.saveNodeNewState();break;case"节点文字":return}$(this).hide()}),e.nodeMenu.on("mouseover",function(t){var o=$.trim($(t.target).text()),n=parseInt(this.style.left)+$(document.getElementById("change-node-text-pos")).width();n+2*e.nodeTextPosMenu.width()>=e.stage.width&&(n-=e.nodeTextPosMenu.width()+e.nodeMenu.width()),"文字位置"===o?(e.layoutMenu.hide(),e.nodeTextPosMenu.css({top:parseInt(this.style.top)+$(document.getElementById("change-node-text-pos")).height(),left:n}).show()):"应用布局"===o?(e.nodeTextPosMenu.hide(),e.layoutMenu.css({top:parseInt(this.style.top),left:n}).show()):(e.layoutMenu.hide(),e.nodeTextPosMenu.hide())}),e.nodeTextPosMenu.on("click",function(t){var o=$.trim($(t.target).text());if(e.currentNode&&e.currentNode instanceof JTopo.Node){switch(e.utils.saveNodeInitState(),o){case"顶部居左":e.currentNode.textPosition="Top_Left",e.utils.saveNodeNewState();break;case"顶部居中":e.currentNode.textPosition="Top_Center",e.utils.saveNodeNewState();break;case"顶部居右":e.currentNode.textPosition="Top_Right",e.utils.saveNodeNewState();break;case"中间居左":e.currentNode.textPosition="Middle_Left",e.utils.saveNodeNewState();break;case"居中":e.currentNode.textPosition="Middle_Center",e.utils.saveNodeNewState();break;case"中间居右":e.currentNode.textPosition="Middle_Right",e.utils.saveNodeNewState();break;case"底部居左":e.currentNode.textPosition="Bottom_Left",e.utils.saveNodeNewState();break;case"底部居中":e.currentNode.textPosition="Bottom_Center",e.utils.saveNodeNewState();break;case"底部居右":e.currentNode.textPosition="Bottom_Right",e.utils.saveNodeNewState()}$("div[id$='-menu']").hide()}}),e.lineMenu.on("click",function(e){switch($(this).hide(),$.trim($(e.target).text())){case"连线设置":break;case"删除连线":l.utils.deleteLine()}}),e.mainMenu.on("click",function(e){$(this).hide()}),e.groupMangeMenu.on("click",function(t){var o=e.currentNode,n=e.utils.getSelectedNodes();if(o&&n&&0!==n.length){$(this).hide();var i=$.trim($(t.target).text());n.forEach(function(e){if(e._id===o._id)return!0;"水平对齐"===i?e.y=o.y:"垂直对齐"===i&&(e.x=o.x)})}}),e.groupMangeMenu.on("mouseover",function(t){if("对齐方式"===$.trim($(t.target).text())){var o=parseInt(this.style.left)+$(document.getElementById("align-group")).width();o+2*e.alignGroup.width()>=e.stage.width&&(o-=e.alignGroup.width()+e.groupMangeMenu.width()),e.groupAlignMenu.css({top:parseInt(this.style.top)+$(document.getElementById("align-group")).height(),left:o}).show()}else e.groupAlignMenu.hide()}),e.containerMangeMenu.on("click",function(t){var o=l.currentNode;o instanceof JTopo.Container&&($(this).hide(),"拆分"===$.trim($(t.target).text())&&(e.utils.toSplit(),e.utils.deleteNode(o)))}),e.layoutMenu.on("click",function(t){l.currentNode.layout={},$("div[id$='-menu']").hide();var o=$.trim($(t.target).text());"取消布局"===o?l.currentNode.layout.on=!1:"分组布局"===o?(l.currentNode.layout.on=!0,l.currentNode.layout.type="auto"):"树形布局"===o?(l.currentNode.layout.on=!0,l.currentNode.layout.type="tree",l.currentNode.layout.direction="bottom",l.currentNode.layout.width=80,l.currentNode.layout.height=100,JTopo.layout.layoutNode(e.scene,e.currentNode,!0)):"圆形布局"===o&&(l.currentNode.layout.on=!0,l.currentNode.layout.type="circle",l.currentNode.layout.radius=200,JTopo.layout.layoutNode(e.scene,e.currentNode,!0))})},r.prototype.replaceStage=function(e){},r.prototype.init=function(e,t,o,n){if(o){this.topologyGuid=e;var i=document.getElementById("define-canvas");i.width=.95*(document.documentElement.clientWidth-305),i.height=document.documentElement.clientHeight-190,"-1"===o?(this.stage=new JTopo.Stage(i),this.scene=new JTopo.Scene(this.stage)):(this.stage=JTopo.createStageFromJson(o,i),this.scene=this.stage.childs[0]),this.stage.frames=this.config.stageFrames,this.stage.wheelZoom=this.config.defaultScal,this.stage.eagleEye.visible=this.config.eagleEyeVsibleDefault,this.stage.mode=this.stageMode,this.scene.background="/static/images/batchRun/bg_edit.png",this.tempNodeA=new JTopo.Node("tempA"),this.tempNodeA.setSize(1,1),this.tempNodeZ=new JTopo.Node("tempZ"),this.tempNodeZ.setSize(1,1),this.tempNodeL=new JTopo.Node,this.tempNodeL.setSize(1,1),this.oldLink=null,this.beginNode=null,this.link=null,this.mousex=null,this.mousey=null,this.newLink=null;var a=this;this.initMenus(),this.scene.mouseover(function(e){if(null!=e.target&&e.target instanceof JTopo.Node)$("#node-name").html(e.target.text),$("#current-time").html((new Date).toLocaleString()),$(".link-tooltip").css("display","none"),$(".node-tooltip").css({display:"block",cursor:"pointer"});else if(null!=e.target&&e.target instanceof JTopo.Link&&e.target.linkTooltip&&"edit"!==l.stageMode){$(".link-tooltip span").html(e.target.linkTooltip);var t=e.layerY?e.layerY:e.offsetY,o=e.layerX?e.layerX:e.offsetX;o+$(".link-tooltip").width()>=a.stage.width&&(o-=$(".link-tooltip").width()),t+$(".link-tooltip").height()>=a.stage.height&&(t-=$(".link-tooltip").height()),$(".node-tooltip").css("display","none"),$(".link-tooltip").css({display:"block","margin-top":t,"margin-left":o,cursor:"pointer"})}else $("#node-name").html("（鼠标悬浮节点查看）"),$("#current-time").html("（鼠标悬浮节点查看）")}),this.scene.mouseout(function(e){}),this.scene.click(function(e){if(e.target)if(a.currentNode=e.target,null!=e.target&&e.target instanceof JTopo.Node&&e.target.nodeTooltip&&"edit"!==l.stageMode){var t=a.currentNode.nodeParams;t&&t.jumpRoute&&window.open(t.jumpRoute)}else $(".node-tooltip").css("display","none");else $(".node-tooltip").css("display","none")}),this.scene.dbclick(function(e){e.target&&(a.currentNode=e.target,null!=e.target&&(e.target,JTopo.Node))}),this.scene.mousedown(function(e){e.target&&e.target instanceof JTopo.Node&&(a.mousex=e.target.x,a.mousey=e.target.y),!a.link||a.isSelectedMode||null!=e.target&&e.target!==a.beginNode&&e.target!==a.link||this.remove(a.link)}),this.scene.mouseup(function(e){if(e.target&&e.target instanceof JTopo.Node?a.currentNode=e.target:e.target&&e.target instanceof JTopo.Link&&(a.currentLink=e.target),e.target&&e.target instanceof JTopo.Node&&e.target.layout&&e.target.layout.on&&e.target.layout.type&&"auto"!==e.target.layout.type&&JTopo.layout.layoutNode(this,e.target,!0,e),2===e.button){$("div[id$='-menu']").hide();var t=e.layerY?e.layerY:e.offsetY,o=e.layerX?e.layerX:e.offsetX;if(a.xInCanvas=o,a.yInCanvas=t,e.target)if(e.target instanceof JTopo.Node){var n=a.utils.getSelectedNodes();n&&n.length>1?(o+a.groupMangeMenu.width()>=a.stage.width&&(o-=a.groupMangeMenu.width()),t+a.groupMangeMenu.height()>=a.stage.height&&(t-=a.groupMangeMenu.height()),$("#group-mange-menu").css({top:t,left:o}).show()):(o+a.nodeMenu.width()>=a.stage.width&&(o-=a.nodeMenu.width()),t+a.nodeMenu.height()>=a.stage.height&&(t-=a.nodeMenu.height()),a.nodeMenu.css({top:t+40,left:o+100}).show())}else e.target instanceof JTopo.Link?a.lineMenu.css({top:(e.layerY?e.layerY:e.offsetY)+30,left:(e.layerX?e.layerX:e.offsetX)+100}).show():e.target instanceof JTopo.Container&&a.containerMangeMenu.css({top:e.layerY?e.layerY:e.offsetY,left:e.layerX?e.layerX:e.offsetX}).show();else o+a.mainMenu.width()>=a.stage.width&&(o-=a.mainMenu.width()),t+a.mainMenu.height()>=a.stage.height&&(t-=a.mainMenu.height()),a.mainMenu.css({top:t+40,left:o+100}).show()}else if(1===e.button);else if(0===e.button)if(a.newLink=null,null!=e.target&&e.target instanceof JTopo.Node&&!a.isSelectedMode&&"edit"!==l.stageMode&&"linkShadow"!==e.target.type){if(Math.sqrt((a.mousex-e.target.x)*(a.mousex-e.target.x)+(a.mousey-e.target.y)*(a.mousey-e.target.y))>7)return;if(null==a.beginNode)a.beginNode=e.target,"line"===a.lineType?(a.link=new JTopo.Link(a.tempNodeA,a.tempNodeZ),a.link.lineType="line"):"foldLine"===a.lineType?(a.link=new JTopo.FoldLink(a.tempNodeA,a.tempNodeZ),a.link.lineType="foldLine",a.link.direction=a.config.linkDirection):"flexLine"===a.lineType?(a.link=new JTopo.FlexionalLink(a.tempNodeA,a.tempNodeZ),a.link.direction=a.config.linkDirection,a.link.lineType="flexLine"):"curveLine"===a.lineType&&(a.link=new JTopo.CurveLink(a.tempNodeA,a.tempNodeZ),a.link.lineType="curveLine"),a.link.dashedPattern=2,a.link.lineWidth=a.config.linkDefaultWidth,a.link.arrowsRadius=a.config.linkArrowsRadius,a.link.shadow=a.config.linkShadow,this.add(a.link),a.tempNodeA.setLocation(e.x,e.y),a.tempNodeZ.setLocation(e.x+20,e.y+20);else if(e.target&&e.target instanceof JTopo.Node&&a.beginNode!==e.target&&"linkShadow"!==e.target.type){var i=e.target;if(null!==i.outLinks)for(var r=0;r<i.outLinks.length;r++)if(i.outLinks[r].nodeZ===a.beginNode||i.outLinks[r].nodeA===a.beginNode)return a.link&&this.remove(a.link),void(a.beginNode=null);if(null!==a.beginNode.outLinks)for(var s=0;s<a.beginNode.outLinks.length;s++)if(a.beginNode.outLinks[s].nodeZ===i)return a.link&&this.remove(a.link),void(a.beginNode=null);var d=[];!function e(t){if(null===t.inLinks)return!1;for(var o=0;o<t.inLinks.length;o++)d.push(t.inLinks[o].nodeA),e(t.inLinks[o].nodeA)}(a.beginNode);for(var c=0;c<d.length;c++)if(d[c]===i)return a.link&&this.remove(a.link),void(a.beginNode=null);var u=void 0;"line"===a.lineType?(u=new JTopo.Link(a.beginNode,i)).lineType="line":"foldLine"===a.lineType?((u=new JTopo.FoldLink(a.beginNode,i)).direction=a.config.linkDirection,u.bundleOffset=a.config.linkOffsetGap,u.lineType="foldLine"):"flexLine"===a.lineType?((u=new JTopo.FlexionalLink(a.beginNode,i)).direction=a.config.linkDirection,u.lineType="flexLine",u.offsetGap=a.config.linkOffsetGap):"curveLine"===a.lineType&&((u=new JTopo.CurveLink(a.beginNode,i)).lineType="curveLine"),u.nodeSrc=a.beginNode.nodeId,u.nodeDst=i.nodeId,"curveLine"!==a.lineType&&(u.arrowsRadius=a.config.arrowsRadius),u.strokeColor=a.config.linkStrokeColor,u.lineWidth=a.config.linkDefaultWidth,u.arrowsRadius=a.config.linkArrowsRadius,this.add(u),a.newLink=u,a.beginNode=null,this.remove(a.link),a.link=null}else a.beginNode=null}else a.link&&this.remove(a.link),a.beginNode=null}),this.scene.mousemove(function(e){!a.isSelectedMode&&a.beginNode&&a.tempNodeZ.setLocation(e.x,e.y),a.tempNodeL.setLocation(e.x,a.tempNodeL.y)}),this.scene.mousedrag(function(e){!a.isSelectedMode&&a.beginNode&&a.tempNodeZ.setLocation(e.x,e.y),a.tempNodeL.setLocation(e.x,a.tempNodeL.y)}),this.stage.click(function(e){0===e.button&&$("div[id$='-menu']").hide()}),this.stage.mouseout(function(e){!a.link||a.isSelectedMode||null!=e.target&&e.target!==a.beginNode&&e.target!==a.link||a.scene.remove(a.link)}),$(document).keydown(function(e){if(e.shiftKey)switch(e.which){case 187:l.utils.scalingBig();break;case 61:l.currentNode instanceof JTopo.Node?(l.utils.saveNodeInitState(),l.utils.scalingBig(),l.utils.saveNodeNewState()):l.utils.scalingBig();break;case 229:l.utils.scalingSmall();break;case 173:l.currentNode instanceof JTopo.Node?(l.utils.saveNodeInitState(),l.utils.scalingSmall(),l.utils.saveNodeNewState()):l.utils.scalingSmall();break;case 70:l.utils.showInFullScreen(l.stage.canvas,"RequestFullScreen");break;case 72:break;case 71:l.utils.showInCenter();break;case 73:l.currentNode instanceof JTopo.Node&&(l.utils.saveNodeInitState(),l.utils.rotateSub(),l.utils.saveNodeNewState());break;case 67:l.utils.cloneSelectedNodes();break;case 80:l.utils.showPic();break;case 82:l.currentNode instanceof JTopo.Node&&l.utils.reMakeNodeAction();break;case 83:l.saveTopology(!0);break;case 85:l.currentNode instanceof JTopo.Node&&(l.utils.saveNodeInitState(),l.utils.rotateAdd(),l.utils.saveNodeNewState());break;case 87:break;case 89:l.utils.clearTopology();break;case 90:l.currentNode instanceof JTopo.Node&&l.utils.cancleNodeAction()}else 46===e.which?l.utils.deleteSelectedNodes():17===e.which&&(a.isSelectedMode=!0)}),$(document).keyup(function(e){if(17===e.which)return a.isSelectedMode=!1,!1})}},r.prototype.drag=function(e,t,o){o||(o="");var n=this;e.ondragstart=function(e){e=e||window.event;var t=$(this).attr("node-type"),n=$(this).attr("node-id"),i=$(this).attr("app-id"),a=($(this).attr("app-name"),"GP"===t?"/static/images/batchRun/init-group.png":"/static/images/init.png");try{e.dataTransfer.setData("text",a+";"+o+";"+t),e.dataTransfer.setData("stepId",n),e.dataTransfer.setData("appId",i)}catch(e){}},t.ondragover=function(e){return e.preventDefault(),!1},t.ondrop=function(e){var t=(e=e||window.event).dataTransfer.getData("text"),o=e.dataTransfer.getData("stepId"),i=e.dataTransfer.getData("appId"),a=void 0,r=void 0;if(t){var l=t.split(";");if(l&&3===l.length){a=l[0],r=l[2];var s=new JTopo.Node;s.fontColor=n.config.nodeFontColor,s.setBound((e.layerX?e.layerX:e.offsetX)-n.scene.translateX-n.config.nodeDefaultWidth/2,(e.layerY?e.layerY:e.offsetY)-n.scene.translateY-n.config.nodeDefaultHeight/2,n.config.nodeDefaultWidth,n.config.nodeDefaultHeight);var d="GP"===r?"/static/images/batchRun/init-group.png":"/static/images/batchRun/init.png";s.setImage(d),s.nodeType=r,s.stepId=o,s.appId=i,s.nodeImage=a,s.textPosition="Middle_Center",s.textOffsetY=-2,n.scene.add(s),n.currentNode=s,n.utils.setNodeCreateListener()}}}};var l=new r("mainControl");l.utils={setNodeCreateListener:function(e){e()},getAllContainers:function(){return l.stage.find("container")},getAllNodes:function(){return l.stage.find("node")},getAllLinks:function(){return l.stage.find("link")},getSelectedNodes:function(){var e=[];return l.scene.selectedElements.forEach(function(t){"node"===t.elementType&&e.push(t)}),e},toMerge:function(){var e=this.getSelectedNodes(),t=new JTopo.Container;t.textPosition="Top_Center",t.fontColor=l.config.nodeFontColor,t.borderColor=l.config.nodeBorderColor,t.borderRadius=l.config.nodeBorderRadius,l.scene.add(t),e.forEach(function(e){t.add(e)})},toSplit:function(){l.currentNode instanceof JTopo.Container&&(l.currentNode.removeAll(),l.scene.remove(l.currentNode))},deleteLine:function(){l.currentLink instanceof JTopo.Link&&(l.scene.remove(l.currentLink),l.currentLink=null,l.lineMenu.hide())},deleteNode:function(e){l.scene.remove(e),l.currentNode=null,l.beginNode=null,l.link&&l.scene.remove(l.link),l.link=null},deleteSelectedNodes:function(){var e=l.scene.selectedElements;if(e&&e.length>0)for(var t=0;t<e.length;t++)this.deleteNode(e[t])},scalingBig:function(){l.stage.zoomOut(l.stage.wheelZoom)},scalingSmall:function(){l.stage.zoomIn(l.stage.wheelZoom)},rotateAdd:function(){l.currentNode instanceof JTopo.Node&&(l.currentNode.rotate+=l.config.nodeRotateValue)},rotateSub:function(){l.currentNode instanceof JTopo.Node&&(l.currentNode.rotate-=l.config.nodeRotateValue)},clearTopology:function(){l.deleteAllNodes()},showPic:function(){l.stage.saveImageInfo()},exportAsImage:function(){l.stage.exportAsImage()},setEditMode:function(){l.stageMode="edit"},setNormalMode:function(){l.stageMode="normal"},cloneNode:function(e){if(e instanceof JTopo.Node){var t=new JTopo.Node;e.serializedProperties.forEach(function(o){t[o]=e[o]}),t.nodeId=generateUUID(),t.alpha=l.config.nodeAlpha,t.strokeColor=l.config.nodeStrokeColor,t.fillColor=l.config.nodeFillColor,t.shadow=l.config.nodeShadow,t.shadowColor=l.config.nodeShadowColor,t.font=l.config.nodeFont,t.fontColor=l.config.nodeFontColor,t.borderRadius=null,t.layout=e.layout,t.selected=!1,t.setLocation(e.x+e.width,e.y+e.height),t.text=e.text,t.setImage(e.image),l.scene.add(t)}},cloneSelectedNodes:function(){var e=this;l.scene.selectedElements.forEach(function(t){"node"===t.elementType&&e.cloneNode(t)})},showInFullScreen:function(e,t){var o=void 0;return["webkit","moz","ms","o",""].forEach(function(n){if(!o){var a=i()(e[n+t]);a+""!="undefined"&&(o="function"===a?e[n+t]():e[n+t])}}),o},showInCenter:function(){l.stage.centerAndZoom()},getContainers:function(){var e=[];return l.stage.childs.forEach(function(t){t.childs.forEach(function(t){"container"===t.elementType&&e.push(t)})}),e},getNodeByKey:function(e,t){var o=null;return l.stage.childs.forEach(function(n){n.childs.forEach(function(n){if("node"===n.elementType&&n[e]===t)return o=n})}),o},cancleNodeAction:function(){if(!(l.currentNode.currStep<=0))for(var e in--l.currentNode.currStep,l.currentNode)"currStep"!==e&&(l.currentNode[e]=l.currentNode.historyStack[l.currentNode.currStep][e])},reMakeNodeAction:function(){if(!(l.currentNode.currStep>=l.currentNode.maxHistoryStep||l.currentNode.currStep>=l.currentNode.historyStack.length-1))for(var e in l.currentNode.currStep++,l.currentNode)"currStep"!==e&&(l.currentNode[e]=l.currentNode.historyStack[l.currentNode.currStep][e])},saveNodeNewState:function(){l.currentNode.historyStack.length>=l.currentNode.maxHistoryStep+1&&l.currentNode.historyStack.shift(),l.currentNode.historyStack.push(JTopo.util.clone(l.currentNode)),l.currentNode.currStep=l.currentNode.historyStack.length-1},saveNodeInitState:function(){l.currentNode.hasInitStateSaved||(l.currentNode.historyStack.push(JTopo.util.clone(l.currentNode)),l.currentNode.hasInitStateSaved=!0)},findNodeAndFlash:function(e){if(e){e=e.trim();var t=l.stage.find('node[text="'+e+'"]');if(t.length>0){var o=t[0];this.unSelectAllNodeExcept(o),o.selected=!0;var n=o.getCenterLocation();l.stage.setCenter(n.x,n.y);!function e(t,o){0!==o?(t.selected=!t.selected,setTimeout(function(){e(t,o-1)},300)):l.utils.unSelectAllNodeExcept(t)}(o,10)}}},unSelectAllNodeExcept:function(e){l.stage.childs.forEach(function(t){t.childs.forEach(function(t){t.nodeId!==e.nodeId&&(t.selected=!1)})})}},t.a=l},mbce:function(e,t,o){var n=o("lktj"),i=o("TcQ7"),a=o("NpIQ").f;e.exports=function(e){return function(t){for(var o,r=i(t),l=n(r),s=l.length,d=0,c=[];s>d;)a.call(r,o=l[d++])&&c.push(e?[o,r[o]]:r[o]);return c}}}});