webpackJsonp([38],{"3Fbo":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("mvHQ"),l=r.n(o),s=r("woOf"),a=r.n(s),i=r("Dd8w"),n=r.n(i),c=r("NYxO"),p=r("ZlkZ"),u={name:"routingRole",data:function(){return{currentPage:1,totalPage:0,loading:!1,inputRules:{zkClusterId:[{required:!0,message:"请输入集群名称",trigger:"blur"}],serviceName:[{required:!0,message:"请输入服务名",trigger:"blur"}],routerName:[{required:!0,message:"请输入路由名称",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"blur"}],method:[{required:!0,message:"请输入方法名",trigger:"blur"}]},serviceForm:{},dataBox:[],routintList:[],tableVal:[],popBox:!1,popForm:{}}},computed:n()({},Object(c.d)({classify:function(e){return e.service.classify},clusterOption:function(e){return e.service.clusterOption}})),mounted:function(){var e=this;this.clusterOption.length<=0&&this.initializeData({vm:e});var t=e.$route.params.zkClusterId;t&&(e.serviceForm=a()({},{zkClusterId:t,serviceName:e.$route.params.name}),e.search())},methods:n()({},Object(c.b)("service",["initializeData"]),{chooseBox:function(e){this.tableVal=e},handleCurrentChange:function(e){this.currentPage=e,this.routintList=this.dataBox[e-1]},search:function(){var e=this,t=this.serviceForm.zkClusterId,r=a()({},this.serviceForm);if(!t)return this.$message({showClose:!0,message:"带* 值不能为空",type:"warning"}),!1;this.loading=!0,this.$axios.post(p.a.serviceFindRouter,n()({},r)).then(function(t){t.data.forEach(function(t){t.zkClusterId||(t.zkClusterIdBackup=e.serviceForm.zkClusterId)});var r=JSON.parse(l()(t.data));e.totalPage=r.length,e.dataBox=e.conmmonMethods.arrayHandle(r),e.routintList=e.dataBox[e.currentPage-1],e.loading=!1}).catch(function(t){e.loading=!1,e.totalPage=0,e.dataBox=[],e.currentPage=1,e.routintList=[],e.$message.error(t&&t.data&&t.data.message||"ERROR")})},routingAdd:function(){this.popForm={},this.popBox=!0},popOk:function(){var e=this,t=this.popForm,r=t.zkClusterId,o=t.routerName,l=t.priority,s=t.serviceName;if(r&&o&&l&&s){var i=a()({},this.popForm);i.enable=!0,this.loading=!0,this.$axios.post(p.a.serviceAddRoute,n()({},i)).then(function(t){"0000"===t.code&&(e.$message({message:"新增成功",type:"success"}),e.serviceForm.zkClusterId=i.zkClusterId,e.popBox=!1,e.search())}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})}else this.$message({showClose:!0,message:"带*不能为空",type:"warning"})},cancel:function(){this.$refs.popForm.resetFields(),this.popBox=!1},routingDelete:function(e){var t=this,r=[];if(e){var o=e.row,s=o.zkClusterId,a=o.serviceName,i=o.routerName;s||(s=e.row.zkClusterIdBackup),r.push({zkClusterId:s,serviceName:a,routerName:i})}else Array.isArray(this.tableVal)&&this.tableVal.forEach(function(e,t){e.zkClusterId||(e.zkClusterId=e.zkClusterIdBackup);var o=e.zkClusterId,l=e.serviceName,s=e.routerName;r.push({zkClusterId:o,serviceName:l,routerName:s})});r=l()(r),this.conmmonMethods.makePopBox(this,"删除").then(function(){t.loading=!0,t.$axios.post(p.a.serviceDeleRoute,r).then(function(e){"0000"===e.code&&(t.$message({message:"删除成功",type:"success"}),t.search())}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})})},startEffect:function(e){var t=this,r=[];if(e){var o=e.row,s=o.zkClusterId,a=o.serviceName,i=o.routerName;s||(s=e.row.zkClusterIdBackup),r.push({zkClusterId:s,serviceName:a,routerName:i})}else Array.isArray(this.tableVal)&&this.tableVal.forEach(function(e,t){e.zkClusterId||(e.zkClusterId=e.zkClusterIdBackup);var o=e.zkClusterId,l=e.serviceName,s=e.routerName;r.push({zkClusterId:o,serviceName:l,routerName:s})});r=l()(r),this.conmmonMethods.makePopBox(this,"启动").then(function(){t.loading=!0,t.$axios.post(p.a.serviceEnableRoute,r).then(function(e){"0000"===e.code&&(t.$message({message:"启用成功",type:"success"}),t.search())}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})})},stopEffect:function(e){var t=this,r=[];if(e){var o=e.row,s=o.zkClusterId,a=o.serviceName,i=o.routerName;s||(s=e.row.zkClusterIdBackup),r.push({zkClusterId:s,serviceName:a,routerName:i})}else Array.isArray(this.tableVal)&&this.tableVal.forEach(function(e,t){e.zkClusterId||(e.zkClusterId=e.zkClusterIdBackup);var o=e.zkClusterId,l=e.serviceName,s=e.routerName;r.push({zkClusterId:o,serviceName:l,routerName:s})});r=l()(r),this.conmmonMethods.makePopBox(this,"停用").then(function(){t.loading=!0,t.$axios.post(p.a.serviceDisableRoute,r).then(function(e){"0000"===e.code&&(t.$message({message:"禁用成功",type:"success"}),t.search())}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})})}})},m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"routingRole"},[r("div",{staticClass:"button-group"},[r("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))]),e._v(" "),r("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-plus"},on:{click:function(t){e.routingAdd()}}},[e._v(e._s(e.$t("common.add")))]),e._v(" "),0!==e.tableVal.length?r("div",{staticClass:"inline-block ml-10"},[r("el-button",{attrs:{loading:e.loading,type:"danger",size:"small"},on:{click:function(t){e.routingDelete()}}},[e._v(e._s(e.$t("common.delete")))]),e._v(" "),r("el-button",{attrs:{loading:e.loading,type:"primary",size:"small"},on:{click:function(t){e.startEffect()}}},[e._v(e._s(e.$t("common.start")))]),e._v(" "),r("el-button",{attrs:{loading:e.loading,type:"primary",size:"small"},on:{click:function(t){e.stopEffect()}}},[e._v(e._s(e.$t("common.stop")))])],1):e._e()],1),e._v(" "),r("el-form",{ref:"serviceForm",attrs:{model:e.serviceForm,"label-width":"94px","label-position":"right",size:"small",rules:e.inputRules}},[r("el-row",{staticClass:"label-first",attrs:{gutter:20}},[r("el-col",{attrs:{xl:4,lg:6}},[r("el-form-item",{attrs:{label:e.$t("redis.redisCluster.clusterName")+"：",prop:"zkClusterId"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:e.$t("common.pleaseChoose")},model:{value:e.serviceForm.zkClusterId,callback:function(t){e.$set(e.serviceForm,"zkClusterId",t)},expression:"serviceForm.zkClusterId"}},e._l(e.clusterOption,function(e){return r("el-option",{key:e.id,attrs:{label:e.pkDesc,value:e.pkValue}})}))],1)],1),e._v(" "),r("el-col",{attrs:{xl:4,lg:6}},[r("el-form-item",{attrs:{label:e.$t("service.serviceList.serviceName")+"：","label-width":"68px"}},[r("el-input",{attrs:{type:"text",clearable:""},model:{value:e.serviceForm.serviceName,callback:function(t){e.$set(e.serviceForm,"serviceName","string"==typeof t?t.trim():t)},expression:"serviceForm.serviceName"}})],1)],1),e._v(" "),r("el-col",{attrs:{xl:4,lg:6}},[r("el-button",{attrs:{size:"small",type:"primary",loading:e.loading,icon:"el-icon-search"},on:{click:function(t){e.search()}}},[e._v(e._s(e.$t("common.search")))])],1)],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.routintList},on:{"selection-change":e.chooseBox}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"serviceName",label:e.$t("service.serviceList.serviceName")}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"routerName",label:e.$t("service.routingRole.routingName"),width:"110"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"priority",label:e.$t("service.routingRole.priority"),width:"110"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"method",label:e.$t("service.routingRole.methodName"),width:"110"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"routerStatus",label:e.$t("service.provider.status"),width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return["true"===t.row.routerStatus?r("el-tag",{attrs:{size:"mini"}},[e._v("已启用")]):r("el-tag",{attrs:{type:"danger",size:"mini"}},[e._v("已停止")])]}}])}),e._v(" "),r("el-table-column",{attrs:{width:"120",label:e.$t("common.operation"),fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-dropdown",{attrs:{trigger:"click"}},[r("el-button",{attrs:{type:"text",size:"mini"}},[e._v("\n                操作"),r("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",[r("el-button",{attrs:{type:"text",size:"mini",icon:"fa fa-pencil-square-o"},on:{click:function(r){e.routingDelete(t)}}},[e._v(e._s(e.$t("common.delete")))])],1),e._v(" "),r("el-dropdown-item",["false"===t.row.routerStatus?r("el-button",{staticStyle:{color:"#67c23a"},attrs:{type:"text",size:"mini",icon:"fa fa-play"},on:{click:function(r){e.startEffect(t)}}},[e._v(e._s(e.$t("common.start")))]):e._e()],1),e._v(" "),r("el-dropdown-item",["true"===t.row.routerStatus?r("el-button",{staticStyle:{color:"#FF0000"},attrs:{type:"text",size:"mini",icon:"fa fa-stop"},on:{click:function(r){e.stopEffect(t)}}},[e._v(e._s(e.$t("common.stop")))]):e._e()],1)],1)],1)]}}])})],1),e._v(" "),r("div",{staticClass:"block"},[r("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":10,layout:"total, prev, pager, next, jumper",background:"",total:e.totalPage},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),r("el-dialog",{attrs:{title:"添加路由配置",visible:e.popBox,width:"45%",center:""},on:{close:function(t){e.cancel()},"update:visible":function(t){e.popBox=t}}},[r("el-form",{ref:"popForm",attrs:{model:e.popForm,"label-width":"110px",size:"small","status-icon":"",rules:e.inputRules}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("redis.redisCluster.clusterName")+"：",prop:"zkClusterId"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:e.$t("common.pleaseChoose")},model:{value:e.popForm.zkClusterId,callback:function(t){e.$set(e.popForm,"zkClusterId",t)},expression:"popForm.zkClusterId"}},e._l(e.clusterOption,function(e){return r("el-option",{key:e.id,attrs:{label:e.pkDesc,value:e.pkValue}})}))],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.serviceList.serviceName")+"：",prop:"serviceName"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-100位字符",maxlength:"100",clearable:""},model:{value:e.popForm.serviceName,callback:function(t){e.$set(e.popForm,"serviceName","string"==typeof t?t.trim():t)},expression:"popForm.serviceName"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.routingName")+"：",prop:"routerName"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.routerName,callback:function(t){e.$set(e.popForm,"routerName","string"==typeof t?t.trim():t)},expression:"popForm.routerName"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.priority")+"：",prop:"priority"}},[r("el-select",{attrs:{clearable:"",placeholder:e.$t("common.pleaseChoose")},model:{value:e.popForm.priority,callback:function(t){e.$set(e.popForm,"priority",t)},expression:"popForm.priority"}},e._l(e.classify.priorityGroup,function(e){return r("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.methodName")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.method,callback:function(t){e.$set(e.popForm,"method","string"==typeof t?t.trim():t)},expression:"popForm.method"}})],1)],1)],1),e._v(" "),r("el-row",{staticStyle:{"margin-bottom":"16px"}},[r("el-col",{attrs:{span:5,offset:7}},[r("el-tag",{staticClass:"align",attrs:{type:"success"}},[e._v(e._s(e.$t("service.routingRole.mate")))])],1),e._v(" "),r("el-col",{attrs:{span:5,offset:7}},[r("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.$t("service.routingRole.misMate")))])],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.consumerHost")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-25位字符",maxlength:"25",clearable:""},model:{value:e.popForm.consumerHost,callback:function(t){e.$set(e.popForm,"consumerHost","string"==typeof t?t.trim():t)},expression:"popForm.consumerHost"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.unconsumerHost,callback:function(t){e.$set(e.popForm,"unconsumerHost","string"==typeof t?t.trim():t)},expression:"popForm.unconsumerHost"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.consumerApplication")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.consumerApplication,callback:function(t){e.$set(e.popForm,"consumerApplication","string"==typeof t?t.trim():t)},expression:"popForm.consumerApplication"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.unconsumerApplication,callback:function(t){e.$set(e.popForm,"unconsumerApplication","string"==typeof t?t.trim():t)},expression:"popForm.unconsumerApplication"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.consumerCluster")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.consumerCluster,callback:function(t){e.$set(e.popForm,"consumerCluster","string"==typeof t?t.trim():t)},expression:"popForm.consumerCluster"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.unconsumerCluster,callback:function(t){e.$set(e.popForm,"unconsumerCluster","string"==typeof t?t.trim():t)},expression:"popForm.unconsumerCluster"}})],1)],1)],1),e._v(" "),r("el-row",{staticStyle:{"margin-bottom":"16px"}},[r("el-col",{attrs:{span:5,offset:7}},[r("el-tag",{staticClass:"align",attrs:{type:"success"}},[e._v(e._s(e.$t("service.routingRole.mate")))])],1),e._v(" "),r("el-col",{attrs:{span:5,offset:7}},[r("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.$t("service.routingRole.misMate")))])],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.providerHost")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-25位字符",maxlength:"25",clearable:""},model:{value:e.popForm.providerHost,callback:function(t){e.$set(e.popForm,"providerHost","string"==typeof t?t.trim():t)},expression:"popForm.providerHost"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.unproviderHost,callback:function(t){e.$set(e.popForm,"unproviderHost","string"==typeof t?t.trim():t)},expression:"popForm.unproviderHost"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.providerCluster")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.providerCluster,callback:function(t){e.$set(e.popForm,"providerCluster","string"==typeof t?t.trim():t)},expression:"popForm.providerCluster"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.unproviderCluster,callback:function(t){e.$set(e.popForm,"unproviderCluster","string"==typeof t?t.trim():t)},expression:"popForm.unproviderCluster"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.providerProtocol")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.providerProtocol,callback:function(t){e.$set(e.popForm,"providerProtocol","string"==typeof t?t.trim():t)},expression:"popForm.providerProtocol"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.unproviderProtocol,callback:function(t){e.$set(e.popForm,"unproviderProtocol","string"==typeof t?t.trim():t)},expression:"popForm.unproviderProtocol"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:e.$t("service.routingRole.providerPort")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.providerPort,callback:function(t){e.$set(e.popForm,"providerPort","string"==typeof t?t.trim():t)},expression:"popForm.providerPort"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",[r("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.popForm.unproviderPort,callback:function(t){e.$set(e.popForm,"unproviderPort","string"==typeof t?t.trim():t)},expression:"popForm.unproviderPort"}})],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{loading:e.loading,type:"primary",size:"small"},on:{click:function(t){e.popOk()}}},[e._v(e._s(e.$t("common.ok")))]),e._v(" "),r("el-button",{attrs:{disabled:e.loading,size:"small"},on:{click:function(t){e.cancel()}}},[e._v(e._s(e.$t("common.cancel")))])],1)],1)],1)},staticRenderFns:[]};var d=r("VU/8")(u,m,!1,function(e){r("8CmI")},"data-v-3fe6769c",null);t.default=d.exports},"8CmI":function(e,t){}});