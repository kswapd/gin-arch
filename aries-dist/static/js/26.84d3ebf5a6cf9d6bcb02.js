webpackJsonp([26],{"4mLf":function(t,e){},j2Tc:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("mvHQ"),l=a.n(s),i=a("woOf"),o=a.n(i),n=a("ZlkZ"),r={data:function(){var t=this,e=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return{pageNo:1,limit:10,total:0,versionOptions:[],ipOptions:[],coreForm:{},tableList:[],idx:-1,addVisible:!1,radio:"1",ifShow:!1,inputRules:{name:[{required:!0,message:"请输入版本名称"}],installName:[{required:!0,message:"请输入安装名"}],installPath:[{required:!0,message:"请输入安装路径"}],ip:[{required:!0,validator:function(a,s,l){console.log(a),e.test(t.listForm[a.field])?l():l(new Error("ip格式不对"))}}],ipList:[{required:!0,message:"请选择ip(多选)",trigger:"change"}],versionNo:[{required:!0,message:"请输入版本号"}]},loading:!1,listForm:{},listTitle:"",isStatus:!1,tableVal:[]}},computed:{},created:function(){this.getData()},methods:{getData:function(){var t=this;this.$axios.all([this.$axios.post(n.a.coreVersionNoCombox,{moType:"Agent",fileType:"FULL"}),this.$axios.post(n.a.hostSearchIpList,{moType:"Agent"})]).then(this.$axios.spread(function(e,a){var s=e.data.map(function(t){return{value:t.pkValue,label:t.pkDesc}});t.versionOptions=s;var l=a.data.map(function(t){return{value:t.pkValue,label:t.pkDesc}});t.ipOptions=l})),this.pageNo=1,this.limit=10,this.search()},handleCurrentChange:function(t){this.pageNo=t,this.search()},search:function(t){var e=this;this.loading=!0;var a=this.coreForm,s=a.name,i=a.ip,r=o()({},{pageNo:this.pageNo,limit:this.limit,baseParam:{moType:"Agent",name:s,ip:i}});this.$axios.post(n.a.coreNodeFind,r).then(function(a){"search"===t&&e.$message.success("查询成功");var s=JSON.parse(l()(a.data));e.tableList=s.data,Array.isArray(s.data)&&s.data.length>0&&e.refresh(s.data),e.total=s.recordsTotal,e.loading=!1}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})},refresh:function(t,e){var a=this,s=JSON.parse(l()(t)),i=void 0,o=[];if(Array.isArray(t))i=JSON.parse(l()(t)),s.forEach(function(t){var e=t.deployId;o.push({deployId:e})});else{i=JSON.parse(l()(this.tableList));var r=s.deployId;o.push({deployId:r})}this.loading=!0,this.$axios.post(n.a.coreAppStatus,o).then(function(t){"0000"===t.code&&(i.map(function(e){t.data.forEach(function(t){return t.deployId===e.deployId?(e.status=t.status,e):e})}),a.loading=!1,a.tableList=i,"search"===e&&a.$message.success("刷新成功"))}).catch(function(t){a.loading=!1,a.$message.error(t&&t.data&&t.data.message||"ERROR")})},handleAddEdit:function(t,e){"添加代理实例"===t&&(this.listTitle=t,this.isStatus=!1,this.listForm={status:"UNINSTALL",ipStatus:"single"}),"修改代理实例"===t&&(this.listTitle=t,"UNINSTALL"===e.status?this.isStatus=!1:this.isStatus=!0,this.listForm=JSON.parse(l()(e))),this.addVisible=!0},saveAddEdit:function(){var t=this;this.$refs.listForm.validate(function(e){if(e){var a=o()({},JSON.parse(l()(t.listForm)));a.moType="Agent",t.loading=!0,"添加代理实例"===t.listTitle&&("single"===a.ipStatus&&delete a.ipList,"more"===a.ipStatus&&delete a.ip,delete a.deployId,t.$axios.post(n.a.coreNodeAdd,a).then(function(e){"0000"===e.code&&(t.search(),t.$message.success("新增成功"),t.addVisible=!1)})),"修改代理实例"===t.listTitle&&(delete a.status,t.$axios.post(n.a.coreNodeModify,a).then(function(e){"0000"===e.code&&(t.search(),t.$message.success("编辑成功"),t.addVisible=!1)}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")}))}})},cancel:function(){this.addVisible=!1,this.$refs.listForm.resetFields()},handleInstall:function(t){var e=this;this.conmmonMethods.makePopBox(this,"部署节点").then(function(){var a=void 0,s=void 0,i="";if(t){a={};var r=JSON.parse(l()(t)),c=r.deployId,p=r.moType,d=r.ip,m=r.installName,u=r.installPath,h=r.versionNo;a=o()({},{deployId:c,moType:p,ip:d,installName:m,installPath:u,versionNo:h}),s=n.a.coreAppInstall}else Array.isArray(e.tableVal)&&(a=[],s=n.a.coreAppBatchInstall,e.tableVal.forEach(function(t){var e=t.name,s=t.deployId,l=t.moType,o=t.ip,n=t.installName,r=t.installPath,c=t.versionNo;"UNINSTALL"===t.status?a.push({deployId:s,moType:l,ip:o,installName:n,installPath:r,versionNo:c}):i+=e+"、"}));if(i.length>0)return e.$message({message:"节点名称："+i.slice(0,i.length-1)+"不符合该操作，请重新选择",type:"warning"}),!1;e.loading=!0,e.$axios.post(s,a).then(function(t){"0000"===t.code&&(e.$message({message:"部署成功",type:"success"}),e.search())}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})})},handleUninstall:function(t){var e=this;this.conmmonMethods.makePopBox(this,"卸载节点").then(function(){var a=void 0,s=void 0,i="";if(t){a={};var r=JSON.parse(l()(t)),c=r.deployId,p=r.ip,d=r.installName,m=r.installPath,u=r.versionNo,h=r.moType;a=o()({},{deployId:c,ip:p,installName:d,installPath:m,versionNo:u,moType:h}),s=n.a.coreAppUninstall}else Array.isArray(e.tableVal)&&(a=[],s=n.a.coreAppBatchUninstall,e.tableVal.forEach(function(t){var e=t.name,s=t.deployId,l=t.ip,o=t.installName,n=t.installPath,r=t.status,c=t.versionNo,p=t.moType;"INSTALL"===r||"STOPPED"===r?a.push({deployId:s,ip:l,installName:o,installPath:n,versionNo:c,moType:p}):i+=e+"、"}));if(i.length>0)return e.$message({message:"节点名称："+i.slice(0,i.length-1)+"不符合该操作，请重新选择",type:"warning"}),!1;e.loading=!0,e.$axios.post(s,a).then(function(t){"0000"===t.code&&(e.$message({message:"卸载成功",type:"success"}),e.search())}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})})},handleStart:function(t){var e=this;this.conmmonMethods.makePopBox(this,"启动节点").then(function(){var a=void 0,s=void 0,i="";if(t){a={};var r=JSON.parse(l()(t)),c=r.moType,p=r.ip,d=r.installName,m=r.installPath;a=o()({},{moType:c,ip:p,installName:d,installPath:m}),s=n.a.coreAppStart}else Array.isArray(e.tableVal)&&(a=[],s=n.a.coreAppBatchStart,e.tableVal.forEach(function(t){var e=t.moType,s=t.name,l=t.ip,o=t.installName,n=t.installPath,r=t.status;"INSTALL"===r||"STOPPED"===r?a.push({moType:e,ip:l,installName:o,installPath:n}):i+=s+"、"}));if(i.length>0)return e.$message({message:"节点名称："+i.slice(0,i.length-1)+"不符合该操作，请重新选择",type:"warning"}),!1;e.loading=!0,e.$axios.post(s,a).then(function(t){"0000"===t.code&&(e.$message({message:"启动成功",type:"success"}),e.search())}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})})},handleStop:function(t){var e=this;this.conmmonMethods.makePopBox(this,"停止节点").then(function(){var a=void 0,s=void 0,i="";if(t){var r=JSON.parse(l()(t)),c=r.moType,p=r.ip,d=r.installName,m=r.installPath;a=o()({},{moType:c,ip:p,installName:d,installPath:m}),s=n.a.coreAppStop}else Array.isArray(e.tableVal)&&(a=[],s=n.a.coreAppBatchStop,e.tableVal.forEach(function(t){var e=t.moType,s=t.name,l=t.ip,o=t.installName,n=t.installPath;"RUNNING"===t.status?a.push({moType:e,ip:l,installName:o,installPath:n}):i+=s+"、"}));if(i.length>0)return e.$message({message:"节点名称："+i.slice(0,i.length-1)+"不符合该操作，请重新选择",type:"warning"}),!1;e.loading=!0,e.$axios.post(s,a).then(function(t){"0000"===t.code&&(e.$message({message:"停止成功",type:"success"}),e.search())}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})})},deleteRow:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.conmmonMethods.makePopBox(this,"删除").then(function(){if(e){var a=e.deployId;"UNINSTALL"===e.status?(t.loading=!0,t.$axios.delete(n.a.coreNodeDelete+a).then(function(e){"0000"===e.code&&(t.search(),t.$message.success("删除成功"))}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})):t.$message({message:"未部署的节点才能被删除",type:"warning"})}else{var s=[],l="";if(t.tableVal.forEach(function(t){var e=t.name,a=t.deployId;"UNINSTALL"===t.status?s.push({deployId:a}):l+=e+"、"}),l.length>0)return t.$message({message:"节点名称："+l.slice(0,l.length-1)+"不符合该操作，请重新选择",type:"warning"}),!1;t.loading=!0,t.$axios.post(n.a.coreNodeBatchDelete,s).then(function(e){t.$message.success("删除成功"),t.search()}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})}})},handleSelectionChange:function(t){this.tableVal=t},radioChange:function(t){this.listForm.status=t},ipSearch:function(t,e){var a=this.ipOptions;e(t?a.filter(function(e){return 0===e.value.toLowerCase().indexOf(t.toLowerCase())}):a)},versionSearch:function(t,e){var a=this.versionOptions;e(t?a.filter(function(e){return 0===e.value.toLowerCase().indexOf(t.toLowerCase())}):a)}}},c={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"button-group"},[a("span",{staticClass:"route-name"},[t._v(t._s(t.$route.meta.title))]),t._v(" "),a("el-button",{attrs:{icon:"el-icon-plus",size:"small",type:"warning"},on:{click:function(e){t.handleAddEdit("添加代理实例")}}},[t._v(t._s(t.$t("common.add")))]),t._v(" "),0!==t.tableVal.length?a("div",{staticClass:"inline-block ml-10"},[a("el-button",{attrs:{type:"primary",size:"small",loading:t.loading,icon:"fa fa-plane"},on:{click:function(e){t.handleInstall()}}},[t._v(t._s(t.$t("common.deploy")))]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"small",loading:t.loading,icon:"fa fa-link"},on:{click:function(e){t.handleUninstall()}}},[t._v(t._s(t.$t("common.unload")))]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small",loading:t.loading,icon:"fa fa-play"},on:{click:function(e){t.handleStart()}}},[t._v(t._s(t.$t("common.start")))]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"small",loading:t.loading,icon:"fa fa-stop"},on:{click:function(e){t.handleStop()}}},[t._v(t._s(t.$t("common.stop")))]),t._v(" "),a("el-button",{attrs:{type:"danger",size:"small",loading:t.loading,icon:"el-icon-delete"},on:{click:function(e){t.deleteRow()}}},[t._v(t._s(t.$t("common.delete")))])],1):t._e()],1),t._v(" "),a("el-form",{ref:"listForm",attrs:{model:t.listForm,rules:t.inputRules,"label-position":"right","status-icon":"","label-width":"86px",size:"small"}},[a("el-row",{staticClass:"label-first",attrs:{gutter:20}},[a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:t.$t("coreApp.tableList.nodeName")+"："}},[a("el-input",{attrs:{type:"text",maxlength:"100",clearable:""},model:{value:t.coreForm.name,callback:function(e){t.$set(t.coreForm,"name","string"==typeof e?e.trim():e)},expression:"coreForm.name"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:4,lg:6}},[a("el-form-item",{attrs:{label:t.$t("coreApp.tableList.ip")+"："}},[a("el-autocomplete",{staticClass:"inline-input",attrs:{placeholder:"请输入1-15位字符",maxlength:"15","fetch-suggestions":t.ipSearch},model:{value:t.coreForm.ip,callback:function(e){t.$set(t.coreForm,"ip","string"==typeof e?e.trim():e)},expression:"coreForm.ip"}})],1)],1),t._v(" "),a("el-col",{attrs:{xl:4,lg:6}},[a("el-button",{attrs:{size:"small",type:"primary",loading:t.loading,icon:"el-icon-search"},on:{click:function(e){t.search("search")}}},[t._v(t._s(t.$t("common.search")))])],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{stripe:"",data:t.tableList},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"name",label:t.$t("coreApp.tableList.nodeName"),width:"120"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"name",label:t.$t("service.provider.status"),width:"135"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{style:t._f("filterAppStatusColor")(e.row.status)},["UNINSTALL"!==e.row.status?a("i",{staticClass:"fa fa-lightbulb-o name-state"}):t._e(),t._v(t._s(t._f("filterAppStatus")(e.row.status)))]),t._v(" "),a("el-button",{attrs:{type:"text",size:"small",icon:"fa fa-refresh"},on:{click:function(a){t.refresh(e.row,"search")}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"ip",label:t.$t("coreApp.tableList.ip"),width:"130"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"installName",label:t.$t("coreApp.tableList.installName"),width:"150"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"installPath",label:t.$t("coreApp.tableList.path"),width:"160"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"versionNo",label:t.$t("coreApp.tableList.versionNum"),width:"120"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"remark",label:t.$t("coreApp.tableVersion.desc"),"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{label:t.$t("common.operation"),fixed:"right",width:"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-dropdown",{attrs:{trigger:"click"}},[a("el-button",{attrs:{type:"text",size:"mini"}},[t._v("\n            操作"),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(a){t.handleAddEdit("修改代理实例",e.row)}}},[t._v(t._s(t.$t("common.edit")))])],1),t._v(" "),a("el-dropdown-item",["UNINSTALL"===e.row.status?a("el-button",{staticClass:"btn-text-red",attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(a){t.deleteRow(e.row)}}},[t._v(t._s(t.$t("common.delete")))]):t._e()],1),t._v(" "),a("el-dropdown-item",["UNINSTALL"===e.row.status?a("el-button",{attrs:{type:"text",icon:"fa fa-plane",size:"mini"},on:{click:function(a){t.handleInstall(e.row)}}},[t._v(t._s(t.$t("common.deploy")))]):t._e()],1),t._v(" "),a("el-dropdown-item",["INSTALL"===e.row.status||"STOPPED"===e.row.status?a("el-button",{attrs:{icon:"fa fa-link",type:"text",size:"mini"},on:{click:function(a){t.handleUninstall(e.row)}}},[t._v(t._s(t.$t("common.unload")))]):t._e()],1),t._v(" "),a("el-dropdown-item",["INSTALL"===e.row.status||"STOPPED"===e.row.status?a("el-button",{attrs:{icon:"fa fa-play",type:"text",size:"mini"},on:{click:function(a){t.handleStart(e.row)}}},[t._v(t._s(t.$t("common.start")))]):t._e()],1),t._v(" "),a("el-dropdown-item",["RUNNING"===e.row.status?a("el-button",{staticClass:"btn-text-red",attrs:{type:"text",icon:"fa fa-stop",size:"mini"},on:{click:function(a){t.handleStop(e.row)}}},[t._v(t._s(t.$t("common.stop")))]):t._e()],1)],1)],1)]}}])})],1),t._v(" "),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{"current-page":t.pageNo,"page-size":10,layout:"total, prev, pager, next, jumper",background:"",total:t.total},on:{"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:t.listTitle,visible:t.addVisible,width:"40%",center:""},on:{close:t.cancel,"update:visible":function(e){t.addVisible=e}}},[a("el-form",{ref:"listForm",attrs:{model:t.listForm,rules:t.inputRules,"status-icon":"","label-width":"100px",size:"small"}},["添加代理实例"===t.listTitle?a("el-form-item",[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-radio-group",{on:{change:t.radioChange},model:{value:t.listForm.status,callback:function(e){t.$set(t.listForm,"status",e)},expression:"listForm.status"}},[a("el-radio",{attrs:{label:"UNINSTALL"}},[t._v("未部署")]),t._v(" "),a("el-radio",{attrs:{label:"INSTALL"}},[t._v("已部署")])],1)],1)],1)],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:t.$t("coreApp.tableList.nodeName"),prop:"name"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{type:"text",placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:t.listForm.name,callback:function(e){t.$set(t.listForm,"name","string"==typeof e?e.trim():e)},expression:"listForm.name"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("coreApp.tableList.installName"),prop:"installName"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{disabled:t.isStatus,type:"text",placeholder:"请输入1-100位字符",maxlength:"100",clearable:""},model:{value:t.listForm.installName,callback:function(e){t.$set(t.listForm,"installName","string"==typeof e?e.trim():e)},expression:"listForm.installName"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("coreApp.tableList.path"),prop:"installPath"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{disabled:t.isStatus,clearable:"",type:"text",placeholder:"请输入1-200位字符",maxlength:"200"},model:{value:t.listForm.installPath,callback:function(e){t.$set(t.listForm,"installPath","string"==typeof e?e.trim():e)},expression:"listForm.installPath"}})],1)],1)],1),t._v(" "),"添加代理实例"===t.listTitle?a("el-form-item",[a("el-radio-group",{model:{value:t.listForm.ipStatus,callback:function(e){t.$set(t.listForm,"ipStatus",e)},expression:"listForm.ipStatus"}},[a("el-radio",{attrs:{label:"single"}},[t._v("单个添加")]),t._v(" "),a("el-radio",{attrs:{label:"more"}},[t._v("批量添加")])],1)],1):t._e(),t._v(" "),"修改代理实例"===t.listTitle||"single"===t.listForm.ipStatus?a("el-form-item",{key:"ip",attrs:{prop:"ip",label:t.$t("coreApp.tableList.ip")}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"100%"},attrs:{placeholder:"请输入1-15位字符",maxlength:"15","fetch-suggestions":t.ipSearch,disabled:t.isStatus},model:{value:t.listForm.ip,callback:function(e){t.$set(t.listForm,"ip","string"==typeof e?e.trim():e)},expression:"listForm.ip"}})],1)],1)],1):a("el-form-item",{key:"ipList",attrs:{label:"ip",prop:"ipList"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:t.$t("common.select")},model:{value:t.listForm.ipList,callback:function(e){t.$set(t.listForm,"ipList",e)},expression:"listForm.ipList"}},t._l(t.ipOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("el-form-item",{attrs:{prop:"versionNo",label:t.$t("coreApp.tableList.versionNum")}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-autocomplete",{staticClass:"inline-input",staticStyle:{width:"100%"},attrs:{placeholder:"请输入1-15位字符",maxlength:"15","fetch-suggestions":t.versionSearch,disabled:t.isStatus},model:{value:t.listForm.versionNo,callback:function(e){t.$set(t.listForm,"versionNo","string"==typeof e?e.trim():e)},expression:"listForm.versionNo"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:t.$t("coreApp.tableVersion.desc")}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入1-100位字符",maxlength:"100"},model:{value:t.listForm.remark,callback:function(e){t.$set(t.listForm,"remark","string"==typeof e?e.trim():e)},expression:"listForm.remark"}})],1)],1)],1)],1),t._v(" "),a("sub-template",{attrs:{"handle-flag":!0}}),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{loading:t.loading,type:"primary",size:"small"},on:{click:t.saveAddEdit}},[t._v(t._s(t.$t("common.ok")))]),t._v(" "),a("el-button",{attrs:{disabled:t.loading,size:"small"},on:{click:function(e){t.cancel()}}},[t._v(t._s(t.$t("common.cancel")))])],1)],1)],1)},staticRenderFns:[]};var p=a("VU/8")(r,c,!1,function(t){a("4mLf")},"data-v-731672d8",null);e.default=p.exports}});