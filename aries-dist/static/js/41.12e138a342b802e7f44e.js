webpackJsonp([41],{cK0a:function(e,t){},uzy2:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("fZjL"),a=r.n(o),i=r("mvHQ"),s=r.n(i),l=r("woOf"),n=r.n(l),c=r("ZlkZ"),m={data:function(){return{pageNo:1,limit:10,total:0,inputRules:{path:[{required:!0,message:"请输入",trigger:"blur"}],radio:[{required:!0,message:"",trigger:"blur"}],name:[{required:!0,message:"请输入版本名称",trigger:"blur"}],versionNo:[{required:!0,message:"请输入版本号",trigger:"blur"}],fileType:[{required:!0,message:"请输入版本名称",trigger:"blur"}],createTime:[{required:!0,message:"请输入版本名称",trigger:"blur"}],creator:[{required:!0,message:"请输入版本号",trigger:"blur"}]},loading:!1,searchForm:{},tableForm:[],versionForm:{method:"Local"},editForm:{},addVisible:!1,percentageNum:0,editVisible:!1,radio:"",inputFile:"",idx:-1}},computed:{query:function(){return n()({},{pageNo:this.pageNo,limit:this.limit,baseParam:{moType:"Agent",versionNo:this.searchForm.versionNo}})}},created:function(){this.search()},methods:{handleCurrentChange:function(e){this.pageNo=e,this.search()},search:function(e){var t=this;this.loading=!0,this.$axios.post(c.a.coreVersionFind,this.query).then(function(r){"search"===e&&t.$message.success("查询成功"),t.loading=!1;var o=JSON.parse(s()(r.data));t.tableForm=o.data,t.total=o.recordsTotal}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})},handleAdd:function(){this.versionForm={method:"Local",fileType:"FULL",creator:window.localStorage.getItem("userName")},this.inputFile="",this.radio="",this.percentageNum=0,this.addVisible=!0},saveAdd:function(){var e=this,t=this.versionForm,r=t.method,o=t.sourceFile,i=t.name,s=t.fileType,l=t.versionNo,m=t.path,d=t.creator,p=t.remark;if("Local"===r){if(!i||!l||!o)return void this.$message({type:"warning",message:"带*不能为空"})}else if(!i||!l||!m)return void this.$message({type:"warning",message:"带*不能为空"});var u=n()({},{sourceFile:o,name:i,fileType:s,versionNo:l,path:m,creator:d,remark:p});u.moType="Agent";var v=new FormData;a()(u).forEach(function(e){u[e]&&v.append(e,u[e])}),this.loading=!0,this.$axios({method:"post",url:c.a.coreVersionAdd,params:{method:r},data:v,onUploadProgress:function(t){t.lengthComputable&&(e.percentageNum=Math.round(t.loaded/t.total*100))}}).then(function(t){"0000"===t.code&&(e.search(),e.$message.success("添加成功"),e.addVisible=!1)}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})},handleEdit:function(e){var t=e.id,r=e.name,o=e.versionNo,a=e.fileType,i=e.createTime,s=e.creator,l=e.path,n=e.remark;this.editForm={id:t,name:r,versionNo:o,fileType:a,createTime:i,creator:s,path:l,remark:n},this.editVisible=!0},saveEdit:function(){var e=this,t=this.editForm,r=t.id,o=t.name,a=t.remark;if(o){var i=n()({},{id:r,name:o,remark:a});this.loading=!0,this.$axios({method:"post",url:c.a.coreVersionUpdate,data:i}).then(function(t){"0000"===t.code&&(e.search(),e.$message.success("编辑成功"),e.editVisible=!1)}).catch(function(t){e.loading=!1,e.$message.error(t&&t.data&&t.data.message||"ERROR")})}else this.$message({type:"warning",message:"版本名称不能为空"})},cancel:function(e){var t=this;"versionForm"===e?(t.$refs.versionForm.resetFields(),t.inputFile="",t.addVisible=!1):(t.$refs.editForm.resetFields(),t.editVisible=!1)},deleteRow:function(e){var t=this;this.conmmonMethods.makePopBox(this,"删除").then(function(){t.loading=!0;var r=e.id;t.$axios({method:"post",url:c.a.coreVersionDelete,data:{id:r}}).then(function(e){"0000"===e.code&&(t.search(),t.$message.success("删除成功"),t.addVisible=!1)}).catch(function(e){t.loading=!1,t.$message.error(e&&e.data&&e.data.message||"ERROR")})})},download:function(e){var t=this;this.conmmonMethods.makePopBox(this,"下载").then(function(){if(e){t.loading=!0;var r=e.path.split("/"),o=r[r.length-1];t.$axios({method:"get",url:c.a.coreVersionDownload+"?path="+e.path,responseType:"blob"}).then(function(e){t.loading=!1,t.commonFunc.funDownload(e,o)}).catch(function(){t.loading=!1})}})},handleChange:function(e){var t=e.target.files[0].name;t.endsWith(".zip")||t.endsWith(".tar")||t.endsWith(".tar.gz")?(this.versionForm.sourceFile=e.target.files[0],this.radio=e.target.value):this.$message({type:"warning",message:"文件类型不正确,请重新选择文件类型(.tar / .tar.gz / .zip)"})},radioChange:function(e){var t=this;this.versionForm.method=e,this.$nextTick(function(){t.$refs.inputFileValue&&t.$refs.inputFileValue.resetField(),t.$refs.inputFileDom&&t.$refs.inputFileDom.resetField(),t.inputFile="",t.radio="",t.versionForm.sourceFile=""})}}},d={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"button-group"},[r("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))]),e._v(" "),r("el-button",{attrs:{icon:"el-icon-plus",size:"small",type:"warning"},on:{click:function(t){e.handleAdd("add")}}},[e._v(e._s(e.$t("common.add")))])],1),e._v(" "),r("el-form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":"68px",size:"small"}},[r("el-row",{staticClass:"label-first",attrs:{gutter:20}},[r("el-col",{attrs:{xl:4,lg:6}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.versionNum")+"："}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-15位字符",maxlength:"15",clearable:""},model:{value:e.searchForm.versionNo,callback:function(t){e.$set(e.searchForm,"versionNo","string"==typeof t?t.trim():t)},expression:"searchForm.versionNo"}})],1)],1),e._v(" "),r("el-col",{attrs:{xl:4,lg:6}},[r("el-button",{attrs:{type:"primary",size:"small",loading:e.loading,icon:"el-icon-search"},on:{click:function(t){e.search("search")}}},[e._v(e._s(e.$t("common.search")))])],1)],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{stripe:"",data:e.tableForm}},[r("el-table-column",{attrs:{align:"center",prop:"name",label:e.$t("coreApp.tableVersion.versionName"),width:"120"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"versionNo",label:e.$t("coreApp.tableVersion.versionNum"),width:"120"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"fileType",label:e.$t("coreApp.tableVersion.type"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s("FULL"===t.row.fileType?"全量":"增量"))]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"createTime",label:e.$t("coreApp.tableVersion.createTime"),width:"160"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"creator",label:e.$t("coreApp.tableVersion.createPerson"),width:"120"}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"path",label:e.$t("coreApp.tableVersion.path"),"show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"remark",label:e.$t("coreApp.tableVersion.desc"),"show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:e.$t("common.operation"),width:"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-dropdown",{attrs:{trigger:"click"}},[r("el-button",{attrs:{type:"text",size:"mini"}},[e._v("操作\n            "),r("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",[r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-edit"},on:{click:function(r){e.handleEdit(t.row)}}},[e._v(e._s(e.$t("common.edit")))])],1),e._v(" "),r("el-dropdown-item",[r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-download"},on:{click:function(r){e.download(t.row)}}},[e._v(e._s(e.$t("common.download")))])],1),e._v(" "),r("el-dropdown-item",[r("el-button",{staticClass:"btn-text-red",attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(r){e.deleteRow(t.row)}}},[e._v(e._s(e.$t("common.delete")))])],1)],1)],1)]}}])})],1),e._v(" "),r("div",{staticClass:"block"},[r("el-pagination",{attrs:{"current-page":e.pageNo,"page-size":10,layout:"total, prev, pager, next, jumper",background:"",total:e.total},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),r("el-dialog",{attrs:{title:"添加代理版本",visible:e.addVisible,width:"40%",center:""},on:{close:function(t){e.cancel("versionForm")},"update:visible":function(t){e.addVisible=t}}},[r("el-form",{ref:"versionForm",attrs:{model:e.versionForm,rules:e.inputRules,"status-icon":"","label-width":"100px",size:"small"}},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"软件包来源",prop:"method"}},[r("el-radio-group",{on:{change:e.radioChange},model:{value:e.versionForm.method,callback:function(t){e.$set(e.versionForm,"method",t)},expression:"versionForm.method"}},[r("el-radio",{attrs:{label:"Local"}},[e._v(e._s(e.$t("common.local")))]),e._v(" "),r("el-radio",{attrs:{label:"Remote"}},[e._v(e._s(e.$t("common.server")))])],1)],1)],1)],1),e._v(" "),r("el-row",{directives:[{name:"show",rawName:"v-show",value:"Local"===e.versionForm.method,expression:"versionForm.method === 'Local'"}],key:"inputFileValue",attrs:{gutter:10}},[r("el-col",{attrs:{span:19}},[r("el-form-item",{ref:"inputFileValue",attrs:{label:e.$t("coreApp.tableVersion.path"),prop:"radio"}},[r("el-input",{attrs:{placeholder:"请输入文件"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:4}},[r("input",{staticClass:"input-file",attrs:{type:"file",accept:".zip, .tar, .gz"},domProps:{value:e.inputFile},on:{change:function(t){e.handleChange(t)}}}),e._v(" "),r("el-button",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(e.$t("common.viewFile")))])],1)],1),e._v(" "),r("el-row",{directives:[{name:"show",rawName:"v-show",value:"Remote"===e.versionForm.method,expression:"versionForm.method === 'Remote'"}],key:"inputFileDom",attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{ref:"inputFileDom",attrs:{label:e.$t("coreApp.tableVersion.path"),prop:"path"}},[r("el-input",{attrs:{clearable:"",placeholder:"请输入路径(例 D:\\d_pan\\nginx-1.15.3)"},model:{value:e.versionForm.path,callback:function(t){e.$set(e.versionForm,"path","string"==typeof t?t.trim():t)},expression:"versionForm.path"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.type"),prop:"radio"}},[r("el-radio-group",{model:{value:e.versionForm.fileType,callback:function(t){e.$set(e.versionForm,"fileType",t)},expression:"versionForm.fileType"}},[r("el-radio",{attrs:{label:"FULL"}},[e._v("全量")]),e._v(" "),r("el-radio",{attrs:{label:"INCR"}},[e._v("增量")])],1)],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.versionName"),prop:"name"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-15位字符",maxlength:"15",clearable:""},model:{value:e.versionForm.name,callback:function(t){e.$set(e.versionForm,"name","string"==typeof t?t.trim():t)},expression:"versionForm.name"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.versionNum"),prop:"versionNo"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入1-15位字符",maxlength:"15",clearable:""},model:{value:e.versionForm.versionNo,callback:function(t){e.$set(e.versionForm,"versionNo","string"==typeof t?t.trim():t)},expression:"versionForm.versionNo"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.desc")}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入1-100位字符",maxlength:"100"},model:{value:e.versionForm.remark,callback:function(t){e.$set(e.versionForm,"remark","string"==typeof t?t.trim():t)},expression:"versionForm.remark"}})],1)],1)],1),e._v(" "),r("el-row",{staticStyle:{"padding-top":"9px"},attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.readFileProgress")}},[r("el-progress",{staticStyle:{"padding-top":"9px"},attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentageNum,status:"success"}})],1)],1)],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{loading:e.loading,type:"primary",size:"small"},on:{click:e.saveAdd}},[e._v(e._s(e.$t("common.ok")))]),e._v(" "),r("el-button",{attrs:{disabled:e.loading,size:"small"},on:{click:function(t){e.cancel("versionForm")}}},[e._v(e._s(e.$t("common.cancel")))])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"修改代理版本",visible:e.editVisible,width:"40%",center:""},on:{close:function(t){e.cancel("editForm")},"update:visible":function(t){e.editVisible=t}}},[r("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.inputRules,"status-icon":"","label-width":"100px",size:"small"}},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.versionName"),prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入1-50位字符",maxlength:"50",clearable:""},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name","string"==typeof t?t.trim():t)},expression:"editForm.name"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.versionNum"),prop:"versionNo"}},[r("el-input",{attrs:{disabled:""},model:{value:e.editForm.versionNo,callback:function(t){e.$set(e.editForm,"versionNo","string"==typeof t?t.trim():t)},expression:"editForm.versionNo"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.type"),prop:"fileType"}},[r("el-input",{attrs:{value:"FULL"===e.editForm.fileType?"全量":"增量",disabled:""}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.createTime"),prop:"createTime"}},[r("el-input",{attrs:{disabled:""},model:{value:e.editForm.createTime,callback:function(t){e.$set(e.editForm,"createTime","string"==typeof t?t.trim():t)},expression:"editForm.createTime"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.createPerson"),prop:"creator"}},[r("el-input",{attrs:{disabled:""},model:{value:e.editForm.creator,callback:function(t){e.$set(e.editForm,"creator","string"==typeof t?t.trim():t)},expression:"editForm.creator"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.path"),prop:"path"}},[r("el-input",{attrs:{disabled:""},model:{value:e.editForm.path,callback:function(t){e.$set(e.editForm,"path","string"==typeof t?t.trim():t)},expression:"editForm.path"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{span:23}},[r("el-form-item",{attrs:{label:e.$t("coreApp.tableVersion.desc")}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入1-100位字符",maxlength:"100"},model:{value:e.editForm.remark,callback:function(t){e.$set(e.editForm,"remark","string"==typeof t?t.trim():t)},expression:"editForm.remark"}})],1)],1)],1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{loading:e.loading,type:"primary",size:"small"},on:{click:function(t){e.saveEdit()}}},[e._v(e._s(e.$t("common.ok")))]),e._v(" "),r("el-button",{attrs:{disabled:e.loading,size:"small"},on:{click:function(t){e.cancel("editForm")}}},[e._v(e._s(e.$t("common.cancel")))])],1)],1)],1)},staticRenderFns:[]};var p=r("VU/8")(m,d,!1,function(e){r("cK0a")},"data-v-3c028dd4",null);t.default=p.exports}});