webpackJsonp([10],{DSqI:function(e,t,a){e.exports=a.p+"static/img/sync-succ.72f1963.png"},DXp0:function(e,t){},TE4O:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),n=a.n(s),i=a("NYxO"),l={data:function(){return{step:1,myTime:"",hasDiff:!1,namespaceName:"",title:"(第一步选择同步信息)",text:"下一步",navSelects:[],configSelects:[],navTreeFlag:!0}},computed:n()({},Object(i.d)({navTree:function(e){var t=[];return e.synConfig.navTree.forEach(function(e){e.clusters.forEach(function(a){a.env=e.env,a.clusterName=a.name,a.namespaceName=a.namespaceName,t.push(a)})}),t},configList:function(e){return e.synConfig.configList},diffData:function(e){return e.synConfig.diffData}})),mounted:function(){var e=this;e.params=e.$route.query,e.namespaceName=e.params.namespaceName,e.getConfigData(),e.getEnvData()},methods:n()({},Object(i.b)("synConfig",["getConfigList","getNavTree","getSynData","setSynData"]),{checked:function(){var e=this,t=[];e.navTree.forEach(function(a,s){a.clusterName!==e.params.clusterName&&(e.$refs.navTree.toggleRowSelection(e.navTree[s],!0),t.push(e.navTree[s]))}),e.navSelects=t},getConfigData:function(){this.getConfigList(this)},getEnvData:function(){this.getNavTree(this)},handleNext:function(){var e=this;if(1===e.step){if(!e.validateCheck())return!1;e.title="(第二步检查Diff)",e.text="上一步",e.step=2,e.synParam={syncItems:e.configSelects,syncToNamespaces:e.navSelects},e.getSynData(e)}else e.title="(第一步选择同步信息)",e.text="下一步",e.step=1},validateCheck:function(){var e=!1;return this.navSelects.length>0?(e=!0,this.configSelects.length>0?e&&!0:(this.$message.warning("请选择需要同步的配置"),!1)):(this.$message.warning("请选择集群"),!1)},handleNavChange:function(e){this.navSelects=e},handleConfigChange:function(e){this.configSelects=e},handleSyn:function(){this.dealSynData(),this.setSynData(this)},dealSynData:function(){var e=this;e.synParamList=[];var t=e.commonFunc.arrCopy(e.diffData),a=e.commonFunc.arrCopy(e.navSelects);t.map(function(t){var s={};a.map(function(e){e.clusterName===t.namespace.clusterName&&e.appId===t.namespace.appId&&e.env===t.namespace.env&&(t.namespace=e)}),s.syncItems=t.diffs,s.syncToNamespaces=[],s.syncToNamespaces.push(t.namespace),s.syncItems.length>0&&s.syncToNamespaces.length>0&&e.synParamList.push(s)})},goBack:function(){var e=this;e.$router.push({name:"configDetail",query:{appId:e.params.appId},params:{id:e.params.appId}}),e.step=1,e.title="(第一步选择同步信息)",e.text="下一步"},handleDelete:function(e,t){e.splice(t,1)},updateItems:function(e){var t=e.namespace,a="/apollo-portal/apps/"+t.appId+/envs/+t.env+/clusters/+t.clusterName+"/namespaces/"+t.namespaceName+"/items";return this.$axios({method:"get",url:a}).then(function(t){var a=e.updateItems;if(a.length>0){var s={};t.data.forEach(function(e){s[e.key]=e.value}),a.forEach(function(t){t.oldValue=s[t.key],t.type="更新",e.diffs.push(t)})}return[]})}})},c={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"syn-config"},[s("div",{staticClass:"syn-header clearfix"},[s("div",{staticClass:"hd-title"},[e._v("\n      同步配置\n      "),s("span",{staticClass:"sub-title"},[e._v(e._s(e.title))])]),e._v(" "),s("div",{staticClass:"hd-handle"},[3!=e.step?s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleNext}},[e._v(e._s(e.text))]):e._e(),e._v(" "),2===e.step&&e.hasDiff?s("el-button",{attrs:{type:"success",size:"small"},on:{click:e.handleSyn}},[e._v("同步")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.goBack}},[e._v("返回项目首页")])],1)]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:1===e.step,expression:"step===1"}],staticClass:"syn-center"},[e._m(0),e._v(" "),s("div",{staticClass:"syn-des"},[s("el-row",[s("el-col",{attrs:{span:3}},[e._v("同步到哪个集群")]),e._v(" "),s("el-col",{attrs:{span:7}},[s("el-table",{key:"nav-table",ref:"navTree",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.navTree,"tooltip-effect":"dark","max-height":"250"},on:{"selection-change":e.handleNavChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),s("el-table-column",{attrs:{prop:"env",label:"环境"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"集群"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:13,offset:1}},[s("el-table",{key:"config-table",ref:"configList",staticStyle:{width:"100%"},attrs:{stripe:"",data:e.configList,"tooltip-effect":"dark","max-height":"250"},on:{"selection-change":e.handleConfigChange}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),s("el-table-column",{attrs:{label:"Key",prop:"key"}}),e._v(" "),s("el-table-column",{attrs:{prop:"value",label:"Value"}}),e._v(" "),s("el-table-column",{attrs:{label:"Create Time"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e._f("formatDateTime")(t.row.dataChangeCreatedTime))+"\n              ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"Update Time"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e._f("formatDateTime")(t.row.dataChangeLastModifiedTime))+"\n              ")]}}])})],1)],1)],1)],1)]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:2===e.step,expression:"step===2"}],staticClass:"syn-info"},e._l(e.diffData,function(t,a){return s("div",{key:a,staticClass:"info-space"},[s("div",{staticClass:"info-hd"},[e._v("\n        环境："+e._s(t.namespace.env)+" 集群："+e._s(t.namespace.clusterName)+" NameSpace："+e._s(t.namespace.namespaceName)+"\n      ")]),e._v(" "),s("div",{staticClass:"info-tb"},[t.diffs.length>0?s("el-table",{key:"list.namespace.clusterName",staticStyle:{width:"100%"},attrs:{data:t.diffs,stripe:"",size:"small"}},[s("el-table-column",{attrs:{prop:"type",label:"Type",width:"100",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"key",label:"key",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"oldValue",label:"同步前",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"value",label:"同步后",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"comment",label:"Comment"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[s("el-button",{staticClass:"btn-text-red",attrs:{size:"small",type:"text"},on:{click:function(s){e.handleDelete(t.diffs,a.$index)}}},[e._v("删除\n              ")])]}}])})],1):s("div",{staticStyle:{color:"#ccc"}},[e._v("没有更新的配置, 忽略同步")])],1)])})),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:3===e.step,expression:"step===3"}],staticStyle:{"text-align":"center",padding:"20px"}},[s("img",{staticStyle:{height:"100px",width:"100px"},attrs:{src:a("DSqI")}}),e._v(" "),s("div",{staticStyle:{"font-size":"18px","font-weight":"bolder","margin-top":"10px"}},[e._v("同步成功！")])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"syn-tips"},[t("div",{staticClass:"tips-title"},[this._v("Tips：")]),this._v(" "),t("ul",{staticStyle:{"padding-left":"40px","list-style-type":"disc"}},[t("li",{staticClass:"tips-item"},[this._v("通过同步配置功能，可以使多个环境、集群间的配置保持一致")]),this._v(" "),t("li",{staticClass:"tips-item"},[this._v("需要注意的是，同步完之后需要发布后才会对应用生效")])])])}]};var r=a("VU/8")(l,c,!1,function(e){a("DXp0")},"data-v-86fc766a",null);t.default=r.exports}});