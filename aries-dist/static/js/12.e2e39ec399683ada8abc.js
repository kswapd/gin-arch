webpackJsonp([12],{Nz3l:function(e,t,a){"use strict";var i=a("Dd8w"),r=a.n(i),n=a("NYxO"),s={data:function(){return{activeNames:[],spliceForms:[{key:"",value:""}],scopeForm:[{key:"",value:"",scopeValue:""}]}},props:{limiterData:{type:Object,default:function(){}}},computed:r()({},Object(n.d)({limiterOptions:function(e){return e.gateway.limiterOptions},timePredicate:function(e){return e.gateway.timePredicate},headersData:function(e){return e.gateway.headersData}})),methods:{limiterChange:function(e,t){var a=this.limiterOptions.filter(function(t){return t.name===e});t.args=this.commonFunc.deepCopy(a[0].args)},limiterPredicateChange:function(e,t){var a=this.timePredicate.filter(function(t){return t.name===e});t.args=a[0].args},addBaseLimiter:function(){this.limiterData.baseLimiter.push({filter:{name:"",args:[]}})},addTempLimiter:function(){this.limiterData.tempLimiter.push({filter:{name:"",args:[]},predicate:{name:"",args:[]}})},deleteLimiter:function(e,t,a){e||"base"!==a?e||"temp"!==a?this.$emit("deleteLimiter",{id:e,index:t,type:a}):this.limiterData.tempLimiter.splice(t,1):this.limiterData.baseLimiter.splice(t,1)},addSpliceParam:function(){this.spliceForms.push({key:"",value:""})},deleteSpliceParam:function(e){this.spliceForms.splice(e,1)},closeSpliceStr:function(e){e.visible=!1,this.spliceForms=[{key:"",value:""}]},closeSpliceScopeStr:function(e){e.visible=!1,this.scopeForm=[{key:"",value:"",scopeValue:""}]},addSpliceScopeStr:function(e,t){var a=this.scopeForm.map(function(e){return e.key}).join("-"),i=this.scopeForm.map(function(e){return e.value+"-"+e.scopeValue})[0];t.forEach(function(e){e.name.includes(".key")&&(e.value=a),e.name.includes(".value")&&(e.value=i)}),this.closeSpliceScopeStr(e)},addSpliceStr:function(e,t){var a=this.spliceForms.map(function(e){return e.key}).join("-"),i=this.spliceForms.map(function(e){return e.value}).join("-");t.forEach(function(e){e.name.includes(".key")&&(e.value=a),e.name.includes(".value")&&(e.value=i)}),this.closeSpliceStr(e)},showScopeAlert:function(e){var t=this,a=e.filter(function(e){return e.name.includes(".key")})[0].value,i=e.filter(function(e){return e.name.includes(".value")})[0].value;if(a&&i){var r=a.split("-"),n=i.split("-");t.scopeForm=[],r.forEach(function(e,a){t.scopeForm.push({key:r[a],value:n[0],scopeValue:n[1]})})}},showAlert:function(e){var t=this,a=e.filter(function(e){return e.name.includes(".key")})[0].value,i=e.filter(function(e){return e.name.includes(".value")})[0].value;if(a&&i){var r=a.split("-"),n=i.split("-");t.spliceForms=[],r.forEach(function(e,a){t.spliceForms.push({key:r[a]})}),n.forEach(function(e,a){t.spliceForms[a].value=n[a]})}}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"limiter"},[a("div",{staticClass:"limiter-box"},[a("div",{staticClass:"route-box"},[a("h3",[e._v("基础限流")]),e._v(" "),e._l(e.limiterData.baseLimiter,function(t,i){return a("el-form",{key:i,ref:"limiterForm",refInFor:!0,attrs:{model:t,"label-width":"90px",size:"small"}},[a("el-form-item",{attrs:{label:"限流策略："}},[a("el-select",{staticClass:"mb-15",staticStyle:{width:"260px"},on:{change:function(a){e.limiterChange(a,t.filter)}},model:{value:t.filter.name,callback:function(a){e.$set(t.filter,"name",a)},expression:"base.filter.name"}},e._l(e.limiterOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.comment,value:e.name}})})),e._v(" "),a("el-button",{staticClass:"ml-10",attrs:{type:"danger"},on:{click:function(a){e.deleteLimiter(t.id,i,"base")}}},[e._v("删除")]),e._v(" "),e._l(t.filter.args,function(r,n){return a("div",{key:n},[a("el-row",{attrs:{gutter:15}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Key：","label-width":"60px"}},[a("el-input",{attrs:{disabled:""},model:{value:r.name,callback:function(t){e.$set(r,"name",t)},expression:"arg.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},["fixed_splice"===r.type?a("el-form-item",{attrs:{label:"Value：","label-width":"60px"}},[a("el-popover",{attrs:{placement:"top",width:"500"},on:{show:function(a){e.showAlert(t.filter.args)},hide:function(t){e.closeSpliceStr(r)}},model:{value:r.visible,callback:function(t){e.$set(r,"visible",t)},expression:"arg.visible"}},[e._l(e.spliceForms,function(t,i){return a("el-form",{key:i,attrs:{model:t,size:"small","label-width":"55px"}},[a("el-row",{staticClass:"mt-10",attrs:{gutter:10}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"Key: "}},[a("el-select",{model:{value:t.key,callback:function(a){e.$set(t,"key",a)},expression:"item.key"}},e._l(e.headersData,function(e){return a("el-option",{key:e.name,attrs:{label:e.desc,value:e.name}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"Value: "}},[a("el-input",{model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{size:"mini",type:"info",icon:"el-icon-plus",circle:""},on:{click:e.addSpliceParam}}),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:0!==i,expression:"j !== 0"}],attrs:{size:"mini",type:"danger",icon:"el-icon-minus",circle:""},on:{click:function(t){e.deleteSpliceParam(i)}}})],1)],1)],1)}),e._v(" "),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.closeSpliceStr(r)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.addSpliceStr(r,t.filter.args)}}},[e._v("确定")])],1),e._v(" "),a("el-input",{attrs:{slot:"reference",placeholder:r.placeholder,readonly:""},slot:"reference",model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"arg.value"}})],2),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(r.eg))])],1):"splice"===r.type?a("el-form-item",{attrs:{label:"Value：","label-width":"60px"}},[a("el-popover",{attrs:{placement:"top",width:"500"},on:{show:function(a){e.showScopeAlert(t.filter.args)},hide:function(t){e.closeSpliceScopeStr(r)}},model:{value:r.visible,callback:function(t){e.$set(r,"visible",t)},expression:"arg.visible"}},[e._l(e.scopeForm,function(t,r){return a("el-form",{key:r,ref:e.spliceForm+i,refInFor:!0,attrs:{model:t,size:"small","label-width":"55px"}},[a("el-row",{staticClass:"mt-10",attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Key: "}},[a("el-select",{model:{value:t.key,callback:function(a){e.$set(t,"key",a)},expression:"item.key"}},e._l(e.headersData,function(e,t){return a("el-option",{key:t,attrs:{label:e.desc,value:e.name}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Value: "}},[a("el-input",{staticStyle:{width:"45%"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}}),e._v(" - \n                            "),a("el-input",{staticStyle:{width:"45%"},model:{value:t.scopeValue,callback:function(a){e.$set(t,"scopeValue",a)},expression:"item.scopeValue"}})],1)],1)],1)],1)}),e._v(" "),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.closeSpliceScopeStr(r)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.addSpliceScopeStr(r,t.filter.args)}}},[e._v("确定")])],1),e._v(" "),a("el-input",{attrs:{slot:"reference",placeholder:r.placeholder,readonly:""},slot:"reference",model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"arg.value"}})],2),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(r.eg))])],1):a("el-form-item",{attrs:{label:"Value：",prop:"filter.args."+n+".value","label-width":"60px",rules:{required:!0,message:"请输入Value",trigger:["blur","change"]}}},[a("el-input",{attrs:{placeholder:r.placeholder},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"arg.value"}}),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(r.eg))])],1)],1)],1)],1)})],2)],1)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:e.addBaseLimiter}},[e._v("添加基础限流")])],1)],2)])])},staticRenderFns:[]},o=a("VU/8")(s,l,!1,null,null,null);t.a=o.exports},cmmM:function(e,t){},uyiL:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Xxa5"),r=a.n(i),n=a("exGp"),s=a.n(n),l=a("//Fk"),o=a.n(l),c=a("Dd8w"),u=a.n(c),d=a("c/Tr"),p=a.n(d),m=a("NYxO"),f=a("Nz3l"),v=a("0uvK");var b={name:"gatewayTable",data:function(){return{serviceRouteTitle:"添加路由",serviceRouteVisible:!1,serviceTitle:"",serviceVisible:!1,instanceView:{},activeTab:"router",btnLoading:!1,serviceRoutes:[],activeNames:[],expandPlace:0,ordinaryVisible:!1,columns:[{text:"服务名称",prop:"service_name"}],data:[],limiterData:{baseLimiter:[],tempLimiter:[]},fuseVisible:!1,modifyFuseVisible:!1,addOrdinaryArr:[{strip_prefix:!0,hystrix_flag:!1,uriAfter:""}],methodOptions:["get","post","delete","put"],instanceId:"",statusMap:[{text:"上线",value:"UP"},{text:"停止",value:"OUT_OF_SERVICE"},{text:"下线",value:"DOWN"}],fuseOptions:[],loadBalancingOptions:[],balanceVisible:!1,loadForm:{}}},components:{limiter:f.a},computed:u()({},Object(m.d)({filterOptions:function(e){return e.gateway.filterOptions},predicateOptions:function(e){return e.gateway.predicateOptions}})),mounted:function(){this.getTableData()},methods:u()({},Object(m.b)("gateway",["getServiceRoute","getFilters","getPredicates","deleteRouteData","batchAddRoute","addClassicRoute","getLimiters","addLimiter","deleteLimiterData","changeStatus","getOptionsKey","getServiceLoad","setServiceLoad","deleteInstanceData"]),{apiManage:function(e,t,a,i){if(e.instanceId){var r=e;this.$router.push({name:"mapping",query:{uri:r.uri},params:{id:r.instanceId}})}},openUri:function(e,t){t.stopPropagation(),window.open(e,"_target")},serviceOpen:function(e){this.instanceView=e,this.serviceTitle=this.instanceView.hostName,this.serviceVisible=!0},serviceClose:function(){this.serviceVisible=!1},showTr:function(e){var t=!e.row._parent||e.row._parent._expanded&&e.row._parent._show;return e.row._show=t,t?"":"display:none;"},getTableData:function(){var e=this;this.getServiceRoute().then(function(t){e.btnLoading=!1,e.data=function e(t,a,i,r){var n=[];return p()(t).forEach(function(t){void 0===t._expanded&&Vue.set(t,"_expanded",r),a&&Vue.set(t,"_parent",a);var s=0;if(void 0!==i&&null!==i&&(s=i+1),Vue.set(t,"_level",s),n.push(t),t.instance&&t.instance.length>0){var l=e(t.instance,t,s,r);n=n.concat(l)}}),n}(t.data,null,null,!1)})},spaceIconShow:function(e){return e===this.expandPlace},toggleDown:function(e){var t=this.data[e];t._expanded=!t._expanded},toggleIconShow:function(e,t){return!!(e===this.expandPlace&&t.instance&&t.instance.length>0)},routeOpen:function(){this.serviceRouteVisible=!0},addSeniorRoute:function(e){this.serviceRouteTitle=e.service_name,this.serviceRoutes=[{id:"",uri:"",filterParam:[],predicateParam:[]}],this.routeOpen()},routeClose:function(){if(this.activeNames=[],this.serviceRoutes&&this.serviceRoutes.length>0){for(var e=0;e<this.serviceRoutes.length;e++)this.$refs.routeForm[e].clearValidate();if(this.limiterData.baseLimiter&&this.limiterData.baseLimiter.length>0)for(var t=0;t<this.limiterData.baseLimiter.length;t++)this.$refs.limiter.$refs.limiterForm[t].clearValidate()}this.serviceRouteVisible=!1,this.btnLoading=!1,this.activeTab="router",this.serviceRoutes=[],this.limiterData={baseLimiter:[],tempLimiter:[]},this.getTableData()},ordinaryRouteClose:function(){var e=this;e.ordinaryVisible=!1,e.btnLoading=!1,e.addOrdinaryArr.forEach(function(t,a){e.$refs.ordinaryForm[a].resetFields()})},addOrdinaryRoute:function(e){this.serviceRouteTitle=e.service_name;var t=e.uri?e.uri:"lb://"+e.service_name;this.addOrdinaryArr=[{strip_prefix:!0,hystrix_flag:!1,uri:t,uriAfter:""}],this.ordinaryVisible=!0},editRoute:function(e){var t=this;t.serviceId=e.serviceId?e.serviceId:e.service_name,t.serviceRouteTitle=e.service_name?e.service_name:e.instanceId,t.instanceId=e.instanceId?e.instanceId:"",t.serviceRoutes=t.commonFunc.deepCopy(e.route),t.limiterData=e.limiter?t.commonFunc.deepCopy(e.limiter):{baseLimiter:[],tempLimiter:[]},t.routeOpen()},addORdinaryData:function(){var e=this,t=e.currentNode.instance&&e.currentNode.instance.uri?e.currentNode.instance.uri:"lb://"+e.currentNode._name;e.addOrdinaryArr.push({strip_prefix:!0,hystrix_flag:!1,uri:t,uriAfter:""})},ordinaryRouteConfirm:function(){var e,t=this,a=this;new o.a(function(e){var i=!0;a.addOrdinaryArr.forEach(function(e,t){a.$refs.ordinaryForm[t].validate(function(e){e||(i=!1)})}),i&&(t.btnLoading=!0,a.addOrdinaryArr.forEach(function(e){e.uri="/"===e.uriAfter[0]?e.uri+e.uriAfter:e.uri+"/"+e.uriAfter,delete e.uriAfter}),e(a.addOrdinaryArr))}).then((e=s()(r.a.mark(function e(i){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.addClassicRoute(i);case 3:e.sent.code===v.d?(a.$message.success("添加普通路由成功"),a.ordinaryRouteClose(),a.getTableData()):(t.btnLoading=!1,a.$message.error(i.message)),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),t.btnLoading=!1,a.$message.error(e.t0&&e.t0.data&&e.t0.data.message||"添加普通路由失败");case 11:case"end":return e.stop()}},e,t,[[0,7]])})),function(t){return e.apply(this,arguments)}))},deleteFilter:function(e,t,a){a&&1===e.length?this.$message.error("谓词至少添加一个"):e.splice(t,1)},deleteLimiter:function(e){var t=this,a=this;a.$confirm("是否删除限流"+e.id,"删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(s()(r.a.mark(function i(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.deleteLimiterData({serviceId:a.serviceId,instanceId:a.instanceId,limiterId:e.id});case 3:"base"===e.type?a.limiterData.baseLimiter.splice(e.index,1):a.limiterData.tempLimiter.splice(e.index,1),a.$message.success("删除限流成功"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a.$message.error(t.t0&&t.t0.data&&t.t0.data.message||"删除限流失败");case 10:case"end":return t.stop()}},i,t,[[0,7]])}))).catch(function(){})},statusChange:function(e){var t=this,a=this;a.$confirm("是否确定更改实例状态","状态",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(s()(r.a.mark(function i(){var n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.changeStatus({serviceId:a.instanceView.serviceId,instanceId:a.instanceView.instanceId,status:e});case 3:(n=t.sent).code===v.d?(a.serviceClose(),a.getTableData()):a.$message.error(n.message||"更改实例状态失败"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a.$message.error(t.t0&&t.t0.data&&t.t0.data.message||"更改实例状态失败");case 10:case"end":return t.stop()}},i,t,[[0,7]])}))).catch(function(){})},balanceClose:function(){this.balanceVisible=!1},balanceConfirm:function(){var e=this;return s()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.btnLoading=!0,t.next=3,e.setServiceLoad(e.loadForm);case 3:(a=t.sent)&&a.code===v.d?e.$message.success("更新负载均衡策略成功"):e.$message.error("更新负载均衡策略失败"),e.btnLoading=!1,e.balanceClose();case 7:case"end":return t.stop()}},t,e)}))()},deleteInstance:function(){var e=this,t=this;t.$confirm("是否删除该实例","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(s()(r.a.mark(function a(){var i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.deleteInstanceData({serviceId:t.instanceView.serviceId,instanceId:t.instanceView.instanceId});case 2:(i=e.sent)&&i.code===v.d&&(t.$message.success("删除实例成功"),t.serviceClose(),t.getTableData());case 4:case"end":return e.stop()}},a,e)}))).catch(function(){})},getFuse:function(){var e=this;this.getOptionsKey("hystrix").then(function(t){e.fuseOptions=t.data})},addRoute:function(){this.serviceRoutes.push({id:"",uri:"",filterParam:[],predicateParam:[]})},addFilter:function(e){e.push({name:"",args:[]})},filterChange:function(e,t){var a=this;return s()(r.a.mark(function i(){var n;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:n=a.filterOptions.filter(function(t){return t.name===e}),t.args=n[0].args;case 2:case"end":return i.stop()}},i,a)}))()},addPredicate:function(e){e.push({name:"",args:[]})},predicateChange:function(e,t){var a=this.predicateOptions.filter(function(t){return t.name===e});t.args=a[0].args},deleteRoute:function(e,t){var a=this,i=this;e?i.$confirm("是否删除路由"+e,"删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(s()(r.a.mark(function n(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,i.deleteRouteData(e);case 3:i.serviceRoutes.splice(t,1),i.$message.success("删除成功"),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),i.$message.error(a.t0&&a.t0.data&&a.t0.data.message||"删除失败");case 10:case"end":return a.stop()}},n,a,[[0,7]])}))).catch(function(){}):i.serviceRoutes.splice(t,1)},routeConfirm:function(){var e=this;return s()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:"router"===(a=e).activeTab?new o.a(function(t,i){var n=!0;a.serviceRoutes.forEach(function(t,i){var l;a.$refs.routeForm[i].validate((l=s()(r.a.mark(function t(a){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a||(n=!1);case 1:case"end":return e.stop()}},t,e)})),function(e){return l.apply(this,arguments)}))}),n&&(a.btnLoading=!0,t(a.serviceRoutes))}).then(function(){var t=s()(r.a.mark(function t(i){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.batchAddRoute(i);case 3:a.$message.success("更新成功"),a.routeClose(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a.btnLoading=!1,a.$message.error(e.t0&&e.t0.data&&e.t0.data.message||"更新失败");case 11:case"end":return e.stop()}},t,e,[[0,7]])}));return function(e){return t.apply(this,arguments)}}()):new o.a(function(e,t){for(var i=!0,r=0;r<a.limiterData.baseLimiter.length;r++)a.$refs.limiter.$refs.limiterForm[r].validate(function(e){e||(i=!1)});i&&(a.btnLoading=!0,e())}).then(s()(r.a.mark(function t(){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.addLimiter({params:{serviceId:a.serviceId,instanceId:a.instanceId,type:"base"},data:a.limiterData.baseLimiter});case 3:a.$message.success("添加限流成功"),a.routeClose(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a.btnLoading=!1,a.$message.error(e.t0&&e.t0.data&&e.t0.data.message||"添加限流失败");case 11:case"end":return e.stop()}},t,e,[[0,7]])})));case 2:case"end":return t.stop()}},t,e)}))()}})},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"gateway-table"},[a("div",{staticClass:"button-group"},[a("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))]),e._v(" "),a("span",{staticClass:"pull-right"},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"刷新",placement:"top"}},[a("el-button",{staticClass:"icon-loading",attrs:{type:"primary",size:"small",loading:e.btnLoading,icon:"el-icon-refresh"},on:{click:function(t){e.btnLoading=!0,e.getTableData()}}})],1)],1)]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.data,border:"","row-style":e.showTr},on:{"cell-click":e.apiManage}},[e._l(e.columns,function(t,i){return a("el-table-column",{key:t.dataIndex,attrs:{label:t.text,width:t.width,align:t.align,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(r){return[e.spaceIconShow(i)?e._l(r.row._level,function(e){return a("span",{key:e,staticClass:"ms-tree-space"})}):e._e(),e._v(" "),e.toggleIconShow(i,r.row)?a("span",{on:{click:function(t){e.toggleDown(r.$index)}}},[r.row._expanded?e._e():a("i",{staticClass:"fa fa-chevron-right",attrs:{"aria-hidden":"true"}}),e._v(" "),r.row._expanded?a("i",{staticClass:"fa fa-chevron-down",attrs:{"aria-hidden":"true"}}):e._e()]):e._e(),e._v(" "),a("span",["service_name"===t.prop?a("span",[e._v("\n            "+e._s(r.row[t.prop])+"\n          ")]):e._e(),e._v(" "),a("span",[e._v("\n            "+e._s(r.row.instanceId)+"\n            "),a("a",{staticClass:"instance-link pointer",on:{click:function(t){e.openUri(r.row.uri,t)}}},[e._v(e._s(r.row.uri))])])])]}}])})}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.func.isContentArray(t.row.route)?a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){a.stopPropagation(),e.editRoute(t.row)}}},[e._v("修改路由")]):a("span",[a("el-dropdown",{attrs:{placement:"bottom",size:"medium",trigger:"click"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-plus",size:"mini"},on:{click:function(e){e.stopPropagation()}}},[e._v("添加路由")]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[a("div",{on:{click:function(a){e.addOrdinaryRoute(t.row)}}},[e._v("普通模式")])]),e._v(" "),a("el-dropdown-item",[a("div",{on:{click:function(a){e.addSeniorRoute(t.row)}}},[e._v("高级模式")])])],1)],1)],1),e._v(" "),t.row.instanceId?a("el-button",{staticClass:"ml-10",attrs:{size:"mini",type:"text",icon:"el-icon-view"},on:{click:function(a){a.stopPropagation(),e.serviceOpen(t.row)}}},[e._v("实例信息")]):e._e()]}}])})],2),e._v(" "),a("el-dialog",{attrs:{title:e.serviceTitle,visible:e.serviceVisible,width:"35%",center:""},on:{"update:visible":function(t){e.serviceVisible=t},close:e.serviceClose}},[a("el-form",{ref:"instanceView",attrs:{model:e.instanceView,"label-width":"80px",size:"small"}},[a("el-form-item",{attrs:{label:"服务名："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.appName,callback:function(t){e.$set(e.instanceView,"appName",t)},expression:"instanceView.appName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主机："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.host,callback:function(t){e.$set(e.instanceView,"host",t)},expression:"instanceView.host"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主机名："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.hostName,callback:function(t){e.$set(e.instanceView,"hostName",t)},expression:"instanceView.hostName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"端口："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.port,callback:function(t){e.$set(e.instanceView,"port",t)},expression:"instanceView.port"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"URI："}},[a("el-input",{attrs:{disabled:""},model:{value:e.instanceView.uri,callback:function(t){e.$set(e.instanceView,"uri",t)},expression:"instanceView.uri"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态："}},[a("el-select",{attrs:{disabled:""},model:{value:e.instanceView.status,callback:function(t){e.$set(e.instanceView,"status",t)},expression:"instanceView.status"}},e._l(e.statusMap,function(e){return a("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),e._v(" "),a("el-dropdown",{staticClass:"ml-20",attrs:{trigger:"click"},on:{command:e.statusChange}},[a("el-button",{attrs:{type:"text",size:"mini"}},[e._v("\n            更改状态\n            "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"UP"}},[e._v("上线")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"OUT_OF_SERVICE"}},[e._v("停止")])],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["DOWN"===e.instanceView.status?a("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.deleteInstance}},[e._v("删除")]):e._e(),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.serviceClose}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.serviceRouteTitle,visible:e.serviceRouteVisible,top:"5vh",width:"50%",center:""},on:{"update:visible":function(t){e.serviceRouteVisible=t}}},[a("el-tabs",{attrs:{"tab-position":"top",type:"card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"路由信息",name:"router"}},[e._l(e.serviceRoutes,function(t,i){return a("el-form",{key:i,ref:"routeForm",refInFor:!0,staticClass:"route-box",attrs:{model:t,"label-width":"100px",size:"small"}},[a("el-form-item",{attrs:{label:"路由名称：",prop:"id",rules:{required:!0,message:"请输入路由名称",trigger:["blur","change"]}}},[a("el-input",{staticStyle:{width:"85%"},attrs:{disabled:t.order},model:{value:t.id,callback:function(a){e.$set(t,"id",a)},expression:"route.id"}}),e._v(" "),a("el-button",{staticClass:"pull-right",attrs:{type:"danger"},on:{click:function(a){e.deleteRoute(t.id,i)}}},[e._v("删除")])],1),e._v(" "),a("el-form-item",{attrs:{label:"URI：",prop:"uri",rules:{required:!0,message:"请输入URI",trigger:["blur","change"]}}},[a("el-input",{model:{value:t.uri,callback:function(a){e.$set(t,"uri",a)},expression:"route.uri"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"排序："}},[a("el-input",{attrs:{placeholder:"请输入大于等于零的正整数"},model:{value:t.order,callback:function(a){e.$set(t,"order",a)},expression:"route.order"}}),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* 路由执行顺序,越小的越靠前执行,")])],1),e._v(" "),a("el-collapse",{staticClass:"mb-20 ml-10",model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[a("el-collapse-item",{attrs:{title:"过滤器",name:2*i}},[e._l(t.filterParam,function(i,r){return a("el-form-item",{key:r,attrs:{"label-width":"0"}},[a("el-select",{staticClass:"mb-15",on:{change:function(t){e.filterChange(t,i)}},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"filter.name"}},e._l(e.filterOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.comment,value:e.name}})})),e._v(" "),a("el-button",{staticClass:"btn-text-red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){e.deleteFilter(t.filterParam,r)}}},[e._v("删除")]),e._v(" "),e._l(i.args,function(t,i){return a("div",{key:i},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Key：","label-width":"60px"}},[a("el-input",{attrs:{disabled:""},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"arg.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Value：",prop:"filterParam."+r+".args."+i+".value","label-width":"60px",rules:{required:!0,message:"请输入Value",trigger:["blur","change"]}}},["select"!==t.type?a("el-input",{attrs:{placeholder:t.placeholder},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"arg.value"}}):a("el-select",{attrs:{placeholder:t.placeholder},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"arg.value"}},e._l(e.fuseOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(t.eg))])],1)],1)],1)],1)})],2)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:function(a){e.addFilter(t.filterParam)}}},[e._v("添加过滤器")])],1)],2),e._v(" "),a("el-collapse-item",{attrs:{title:"谓词",name:2*i+1}},[e._l(t.predicateParam,function(i,r){return a("el-form-item",{key:r,attrs:{"label-width":"0"}},[a("el-select",{staticClass:"mb-15",on:{change:function(t){e.predicateChange(t,i)}},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"predicate.name"}},e._l(e.predicateOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.comment,value:e.name}})})),e._v(" "),a("el-button",{staticClass:"btn-text-red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){e.deleteFilter(t.predicateParam,r,"predicate")}}},[e._v("删除")]),e._v(" "),e._l(i.args,function(t,i){return a("div",{key:i},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Key：","label-width":"60px"}},[a("el-input",{attrs:{disabled:""},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"arg.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"Value：",prop:"predicateParam."+r+".args."+i+".value","label-width":"60px",rules:{required:!0,message:"请输入Value",trigger:["blur","change"]}}},["date"===t.type?a("el-date-picker",{attrs:{type:"datetime",placeholder:t.placeholder,"value-format":"timestamp","default-time":"12:00:00"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"arg.value"}}):a("el-input",{attrs:{placeholder:t.placeholder},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"arg.value"}}),e._v(" "),a("p",{staticClass:"form-tips"},[e._v("* "+e._s(t.eg))])],1)],1)],1)],1)})],2)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:function(a){e.addPredicate(t.predicateParam)}}},[e._v("添加谓词")])],1)],2)],1),e._v(" "),a("div",{staticClass:"text-left"},[t.limiter?a("el-button",{attrs:{type:"text",size:"small",icon:"fa fa-eye"},on:{click:e.viewLimiter}},[e._v("查看限流")]):e._e()],1)],1)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:e.addRoute}},[e._v("添加路由")])],1)],2),e._v(" "),e.serviceRoutes.length>0&&e.serviceRoutes[0].order?a("el-tab-pane",{attrs:{label:"限流信息",name:"limiter"}},[a("limiter",{ref:"limiter",attrs:{"limiter-data":e.limiterData},on:{deleteLimiter:e.deleteLimiter}})],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.routeConfirm}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{disabled:e.btnLoading,size:"small"},on:{click:e.routeClose}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.serviceRouteTitle,visible:e.ordinaryVisible,width:"35%",center:""},on:{"update:visible":function(t){e.ordinaryVisible=t},close:e.ordinaryRouteClose}},[e._l(e.addOrdinaryArr,function(t,i){return a("el-form",{key:i,ref:"ordinaryForm",refInFor:!0,staticClass:"route-box",attrs:{model:t,size:"small","label-width":"126px"}},[a("el-form-item",{attrs:{label:"路由名称：",prop:"id",rules:{required:!0,message:"路由名称不能为空",trigger:"blur"}}},[a("el-input",{model:{value:t.id,callback:function(a){e.$set(t,"id",a)},expression:"route.id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"匹配路径：",prop:"path",rules:{required:!0,message:"路径不能为空",trigger:"blur"}}},[a("el-input",{model:{value:t.path,callback:function(a){e.$set(t,"path",a)},expression:"route.path"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"URI："}},[a("el-input",{staticStyle:{width:"60%"},attrs:{disabled:""},model:{value:t.uri,callback:function(a){e.$set(t,"uri",a)},expression:"route.uri"}}),e._v(" "),a("el-input",{staticStyle:{width:"38%"},model:{value:t.uriAfter,callback:function(a){e.$set(t,"uriAfter",a)},expression:"route.uriAfter"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否隐藏uri前缀："}},[a("el-switch",{model:{value:t.strip_prefix,callback:function(a){e.$set(t,"strip_prefix",a)},expression:"route.strip_prefix"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启用熔断："}},[a("el-switch",{model:{value:t.hystrix_flag,callback:function(a){e.$set(t,"hystrix_flag",a)},expression:"route.hystrix_flag"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"熔断降级uri："}},[a("el-input",{attrs:{disabled:!t.hystrix_flag},model:{value:t.fallback_uri,callback:function(a){e.$set(t,"fallback_uri",a)},expression:"route.fallback_uri"}})],1)],1)}),e._v(" "),a("div",{staticClass:"text-center"},[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-plus"},on:{click:e.addORdinaryData}},[e._v("添加路由")])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",loading:e.btnLoading,size:"small"},on:{click:e.ordinaryRouteConfirm}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{disabled:e.btnLoading,size:"small"},on:{click:e.ordinaryRouteClose}},[e._v("取消")])],1)],2)],1)},staticRenderFns:[]};var g=a("VU/8")(b,h,!1,function(e){a("cmmM")},"data-v-6f9e2c4a",null);t.default=g.exports}});