webpackJsonp([64],{Ezp5:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("woOf"),r=a.n(n),o=a("Xxa5"),l=a.n(o),i=a("exGp"),s=a.n(i),c=a("Dd8w"),u=a.n(c),p=a("NYxO"),d={data:function(){return{environment:{value:"",options:[]},corporation:{value:"",options:[]},dateForm:{},infoRes:null,currentPage:1,pageSize:10,isLoading:!1}},computed:u()({},Object(p.d)({batchTableData:function(e){return e.processing.batchTableData},batchTotal:function(e){return e.processing.batchTotal}})),methods:u()({},Object(p.b)("processing",["emptyList","getBatchOption","getBatchEvnInfo","getBatchTableData","getBatchDate","updateBatchDate","findBatchEnvIpCombox","findLegalPersonIpCombox"]),{handleAdd:function(){},envChange:function(){var e=this;return s()(l.a.mark(function t(){var a,n,r;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(a=e).isLoading=!0,n=a.environment.value;try{n=JSON.parse(a.environment.value)}catch(e){}return a.getBatchTableData(n).then(function(e){e&&"0000"!==e.code&&a.$message.error(e.message||""),a.isLoading=!1}).catch(function(t){e.$message.error(t&&t.data&&t.data.message||"ERROR"),a.isLoading=!1}),t.next=7,a.getBatchDate(n);case 7:r=t.sent,a.dateForm={RUN_DATE:r.runDate,LAST_RUN_DATE:r.lastRunDate,NEXT_RUN_DATE:r.nextRunDate};case 9:case"end":return t.stop()}},t,e)}))()},updateDate:function(){var e=this;return s()(l.a.mark(function t(){var a,n,o,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((a=e).environment.value){t.next=4;break}return a.$message.warning("请选择应用环境"),t.abrupt("return");case 4:if(!(a.corporation.options.length>0)||a.corporation.value){t.next=7;break}return a.$message.warning("请选择法人"),t.abrupt("return");case 7:n=a.corporation.value.legalPersonCode||"DEFAULT";try{n=JSON.parse(a.corporation.value).legalPersonCode||"DEFAULT"}catch(e){}a.isLoading=!0,o=a.environment.value;try{o=JSON.parse(a.environment.value)}catch(e){}return i=r()({zkUrl:o.zkUrl,appGroup:o.appGroup,legalPersonCode:n},a.dateForm),t.next=15,a.updateBatchDate(i);case 15:a.$message.success("更新日期成功"),a.isLoading=!1;case 17:case"end":return t.stop()}},t,e)}))()},runBatch:function(e){var t=this;if(t.corporation.options.length>0&&!t.corporation.value)t.$message.warning("请选择法人");else{var a=t.environment.value;try{a=JSON.parse(t.environment.value)}catch(e){}var n=t.corporation.value.legalPersonCode||"DEFAULT";try{n=JSON.parse(t.corporation.value).legalPersonCode||"DEFAULT"}catch(e){}var r={batchClass:e.BATCH_CLASS,zk:a.zkUrl,applicationGroup:a.appGroup,legalPersonCode:n};this.$router.push({name:"batchRun",params:{id:e.BATCH_CLASS+"-"+n},query:r})}},handleCurrentChange:function(e){this.currentPage=e},change:function(){this.envChange()}}),mounted:function(){this.findBatchEnvIpCombox(this),this.findLegalPersonIpCombox(this)}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"batch-main"},[a("div",{staticClass:"button-group"},[a("span",{staticClass:"route-name"},[e._v(e._s(e.$route.meta.title))])]),e._v(" "),a("el-form",{attrs:{modal:e.envForm,"label-position":"right",size:"small"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{lg:10,xl:8}},[a("el-form-item",{attrs:{label:"选择批处理环境：",prop:"name"}},[a("el-select",{attrs:{disabled:e.isLoading,clearable:"",size:"small",placeholder:"选择批处理环境"},on:{change:e.change},model:{value:e.environment.value,callback:function(t){e.$set(e.environment,"value",t)},expression:"environment.value"}},e._l(e.environment.options,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-col",{attrs:{lg:10,xl:8}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.corporation.options.length>0,expression:"corporation.options.length > 0"}],attrs:{label:"选择法人：",prop:"name"}},[a("el-select",{attrs:{disabled:e.isLoading,clearable:"",size:"small",placeholder:"选择法人"},model:{value:e.corporation.value,callback:function(t){e.$set(e.corporation,"value",t)},expression:"corporation.value"}},e._l(e.corporation.options,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)],1)],1)],1),e._v(" "),a("el-form",{ref:"dateForm",attrs:{model:e.dateForm,"label-width":"140px","label-position":"right",size:"small"}},[a("el-row",{staticClass:"label-first",attrs:{gutter:20}},[a("el-col",{attrs:{lg:7,xl:6}},[a("el-form-item",{attrs:{label:"LAST_RUN_DATE："}},[a("el-date-picker",{attrs:{title:e.dateForm.LAST_RUN_DATE,disabled:e.isLoading,type:"date","value-format":"yyyyMMdd",format:"yyyyMMdd"},model:{value:e.dateForm.LAST_RUN_DATE,callback:function(t){e.$set(e.dateForm,"LAST_RUN_DATE","string"==typeof t?t.trim():t)},expression:"dateForm.LAST_RUN_DATE"}})],1)],1),e._v(" "),a("el-col",{attrs:{lg:7,xl:4}},[a("el-form-item",{attrs:{label:"RUN_DATE："}},[a("el-date-picker",{attrs:{disabled:e.isLoading,type:"date","value-format":"yyyyMMdd",format:"yyyyMMdd",title:e.dateForm.RUN_DATE},model:{value:e.dateForm.RUN_DATE,callback:function(t){e.$set(e.dateForm,"RUN_DATE","string"==typeof t?t.trim():t)},expression:"dateForm.RUN_DATE"}})],1)],1),e._v(" "),a("el-col",{attrs:{lg:7,xl:4}},[a("el-form-item",{attrs:{label:"NEXT_RUN_DATE："}},[a("el-date-picker",{attrs:{disabled:e.isLoading,type:"date","value-format":"yyyyMMdd",format:"yyyyMMdd",title:e.dateForm.NEXT_RUN_DATE},model:{value:e.dateForm.NEXT_RUN_DATE,callback:function(t){e.$set(e.dateForm,"NEXT_RUN_DATE","string"==typeof t?t.trim():t)},expression:"dateForm.NEXT_RUN_DATE"}})],1)],1),e._v(" "),a("el-col",{attrs:{lg:3,xl:4}},[a("el-button",{attrs:{loading:e.isLoading,type:"primary",icon:"el-icon-search",size:"small"},on:{click:e.updateDate}},[e._v("\n          更新日期\n        ")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{data:e.batchTableData[e.currentPage-1],stripe:""}},[a("el-table-column",{attrs:{align:"center",prop:"BATCH_CLASS",label:"批处理"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"EOD_SOD",label:"EOD/SOD"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"BATCH_DESC",label:"批处理描述"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("common.operation"),align:"center",fixed:"right",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-caret-right"},on:{click:function(a){e.runBatch(t.row)}}},[e._v("运行\n        ")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.batchTotal},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t}}})],1)},staticRenderFns:[]},g=a("VU/8")(d,m,!1,null,null,null);t.default=g.exports}});